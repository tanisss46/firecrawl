{
  "content": "# Query transactional data\n\n## Create custom reports for charges, refunds, transfers, and more.\n\nUse the data in the tables within the\n[schema](https://docs.stripe.com/stripe-data/write-queries) for reporting on\nyour account’s balance activity. The tables in the **Payment Tables** sections\nrepresent funds that flow between your customers and your Stripe account, such\nas charges or refunds. The **Transfer Tables** section has information about\ntransfers of your Stripe account balance to your bank account\n([payouts](https://docs.stripe.com/payouts)).\n\nUse the `balance_transactions` table as a starting point for accounting\npurposes. Unlike using separate tables (such as `charges` or `refunds`), it\nprovides a ledger-style record of every\n[type](https://docs.stripe.com/api#balance_transaction_object-type) of\ntransaction that comes into or flows out of your Stripe account balance. Use\nbalance transactions to generate frequently used reports and to simplify how you\nreport on financial activity. Some common types of balance transactions include:\n\n- `charges`\n- `refunds`\n- `transfers`\n- `payouts`\n- `adjustments`\n- `application_fees`\n\nEach balance transaction row represents an individual\n[balance_transaction](https://docs.stripe.com/api#balance_transaction_object)\nobject that doesn’t change after it’s created. For example, creating a charge\nalso creates a corresponding balance transaction of type `charge`. Refunding\nthis charge creates a separate balance transaction of type `refund`—but it\ndoesn’t modify the original balance transaction. Similarly, receiving a payout\nin your bank account (represented as a transfer) creates a balance transaction.\n\nThe following example query uses this table to retrieve some information about\nthe five most recent balance transactions.\n\n```\nselect\n date_format(created, '%m-%d-%Y') as day,\n id,\n amount,\n currency,\n source_id,\n type\nfrom balance_transactions\norder by day desc\nlimit 5\n```\n\ndayidamountcurrencysource_idtype3/9/2025txn_nGFTGdnLhOwxVNp-1,000usdre_rIQeSzIlxFQqIdorefund3/9/2025txn_LjU2wPLuC5XdCQW1,000usdch_vYzuShCq1Lws7ipcharge3/9/2025txn_WGz3wQibqnsAO4F1,000usdch_dEWj6boZM6GfGbIcharge3/9/2025txn_P8j42okLTIIY8Ma1,000eurch_06g0DRfHlguDOLycharge3/9/2025txn_hEbLuJZAewMLfpS-1,000usdre_UJlGBrqRt60Jubhrefund\nYou can calculate the most common financial summaries by joining the\n`balance_transactions` table with other tables containing the appropriate\ninformation. Some of our query templates (such as the [daily\nbalance](https://dashboard.stripe.com/sigma/queries/templates/Daily%20balance)\nand [monthly summary and\nbalance](https://dashboard.stripe.com/sigma/queries/templates/Monthly%20summary%20and%20balance))\nwork by joining this table to others.\n\n!\n\n## Balance transaction fee details\n\nThe `balance_transaction_fee_details` table provides fee information about each\nindividual balance transaction. Joining this table to `balance_transactions` in\nthe manner below allows you to return fee information for each balance\ntransaction.\n\n!\n\nThe following query joins the `balance_transactions` and\n`balance_transaction_fee_details` tables together. Each balance transaction item\nreturned includes the amount, fee, type of fee applied, and a description of the\nfee.\n\n```\nselect\ndate_format(date_trunc('day', balance_transactions.created), '%m-%d-%Y') as day,\n balance_transactions.id,\n balance_transactions.amount,\n balance_transactions.fee,\n balance_transaction_fee_details.type\nfrom balance_transactions\ninner join balance_transaction_fee_details\non\nbalance_transaction_fee_details.balance_transaction_id=balance_transactions.id\norder by day desc\nlimit 5\n```\n\ndayidamountfeetype3/9/2025txn_Vm07hI7eYdFf3xH1,00059stripe_fee3/9/2025txn_0IPMQng37XykZQ41,00059stripe_fee3/9/2025txn_jTaWzjALykg6d081,00059stripe_fee3/9/2025txn_dvrSvTQyviMIYs71,00059stripe_fee3/9/2025txn_exphJrQYyR39nq11,00059stripe_fee\n## Charges\n\nThe `charges` table contains data about\n[Charge](https://docs.stripe.com/api#charge_object) objects. Use this table for\nqueries that focus on charge-specific information rather than for accounting or\nreconciliatory purposes. It also supplements accounting reports with additional\ncustomer data. For example, the [payment card\nbreakdown](https://dashboard.stripe.com/sigma/queries/templates/Payment%20card%20breakdown)\ntemplate query uses the `charges` table to report on the different types of\ncards your customers have used.\n\nYou can join the `charges` table to a number of others to retrieve more\ninformation with your queries.\n\n!\n\nThe following example uses the `charges` table to report on failed charges,\nreturning the card brand and a failure code and message.\n\n```\nselect\n date_format(date_trunc('day', created), '%m-%d-%Y') as day,\n id,\n card_brand,\n failure_code,\n failure_message\nfrom charges\n where status = 'failed'\norder by day desc\nlimit 5\n```\n\nday\nidcard_brandfailure_codefailure_message3/9/2025ch_gInkfMQ5QIyML6SVisacard_declinedYour\ncard was declined.3/9/2025ch_oucQO3o1vUMniKjMasterCardcard_declinedYour card\ndoesn’t support this type of\npurchase.3/9/2025ch_xc36YCPjmE2v6UkVisacard_declinedYour card has insufficient\nfunds.3/9/2025ch_eOJPhP8K583EZvFVisacard_declinedYour card was\ndeclined.3/9/2025ch_wbaJWY6qJFFuyKuMasterCardcard_declinedYour card was\ndeclined.\n## Customers\n\nThe `customers` table contains data about\n[Customer](https://docs.stripe.com/api#customers) objects (this table isn’t part\nof the **Payment Tables** group). Use it if you’re creating charges using\ncustomers (for example, with saved payment information). It’s also useful if\nyou’re using\n[subscriptions](https://docs.stripe.com/stripe-data/query-billing-data).\n\n!\n\nThe following example retrieves a list of failed charges, with the ID and email\naddress for each customer.\n\n```\nselect\n date_format(date_trunc('day', charges.created), '%m-%d-%Y') as day,\n customers.id,\n customers.email,\n charges.id\nfrom charges\ninner join customers\non customers.id=charges.customer_id\nwhere charges.status = 'failed'\norder by day desc\nlimit 5\n```\n\n## Refunds\n\nCharges and refunds are separate objects within the API. Refunding a charge\ncreates a [Refund](https://docs.stripe.com/api#refund_object). This data is\navailable in the `refunds` table and provides in-depth information about\ncompleted refunds. Similar to reporting on charges, a best practice is to start\nwith information about balance transactions. If necessary, you can then gather\nadditional details using the `refunds` table.\n\nYou can join the `refunds` table to the `balance_transactions` and `charges`\ntables to further explore refund data.\n\n!\n\nThe following example joins the `balance_transactions` and `refunds` tables\ntogether using the `refunds.balance_transaction_id` and\n`balance_transactions.id` columns. Each balance transaction item returned is a\nrefund, displaying the charge ID and amount. Only balance transactions created\nafter a certain date are returned.\n\n```\nselect\ndate_format(date_trunc('day', balance_transactions.created), '%m-%d-%Y') as day,\n balance_transactions.source_id,\n refunds.charge_id,\n balance_transactions.amount\nfrom balance_transactions\ninner join refunds\non refunds.balance_transaction_id=balance_transactions.id\n where balance_transactions.type = 'refund'\norder by day desc\nlimit 5\n```\n\ndaysource_idcharge_idamount3/9/2025re_yoSxBGarxBgxoVJch_5rMNkNWSJkIbWCQ-1,0003/9/2025re_QoS8LoHKuCs3CAech_qLztRLbgcTJq7CR-1,0003/9/2025re_Lk5fVsYshc4Is6gch_HkXnZuTQWkPFHCr-1,0003/9/2025re_XYENhbCOkX0UzyKch_AAA9NRQuQXggQ4a-1,0003/9/2025re_gFsukbxzoxMuJ7gch_dIRSJDkXDxRKXVD-1,000\n## Partial capture refunds\n\nUsing [auth and capture](https://docs.stripe.com/charges/placing-a-hold) and\ncapturing only some of the authorized amount creates both a charge and a refund.\nAn authorized charge creates a `charge` and an associated balance transaction\nfor the full amount. After a partial capture is complete, the uncaptured amount\nis released and a `refund` is created with a `reason` field of `partial_capture`\nalong with an associated balance transaction.\n\nFor example, authorizing a 10 USD charge but only capturing 7 USD creates a\n`charge` for 10 USD. This also creates a `refund` with the reason\n`partial_capture` for the remaining 3 USD.\n\nTake this into account if your business is performing auth and capture charges\nas you’re creating reports to review customer refund rates. Without\nconsideration, auth and capture can misrepresent the number of refunds on your\naccount. Use the refund’s `reason` field to filter out partial capture refunds\nwhen retrieving payment information.\n\n```\nselect\n balance_transactions.id,\n balance_transactions.amount\nfrom balance_transactions\ninner join refunds\non refunds.id=balance_transactions.source_id\nwhere reason != 'partial_capture'\nlimit 5\n```\n\n## Transfers and payouts\n\nThe `transfers` table contains data about\n[payouts](https://docs.stripe.com/payouts) made from your Stripe balance to your\nbank account. You can use this table to reconcile each payout with the specific\ncharges, refunds, and adjustments that comprise it, as long as you’re using\n[automatic payouts](https://docs.stripe.com/payouts).\n\nFor [Connect](https://docs.stripe.com/connect) platforms, this table also\nincludes data about transfers of funds to connected Stripe accounts.\n\n!\n\nIf you’re performing payouts manually, the amount in each payout to your bank\naccount is arbitrary. As such, you can’t reconcile it to specific balance\ntransactions and it only reflects the amount you requested to pay out to your\nbank account.\n\nThe following example joins the `balance_transactions` and `transfers` tables\ntogether. It returns a list of charges and refunds, the payout they relate to,\nand the date that the payout is scheduled to arrive into your bank account.\n\n```\nselect\ndate_format(date_trunc('day', balance_transactions.created), '%m-%d-%Y') as\nbt_created,\n balance_transactions.source_id,\n balance_transactions.type,\n balance_transactions.net as net_amount,\n balance_transactions.automatic_transfer_id as transfer_id,\n date_format(date_trunc('day', transfers.date), '%m-%d-%Y') as transfer_date\nfrom balance_transactions\ninner join transfers\non balance_transactions.automatic_transfer_id=transfers.id\nwhere balance_transactions.type = 'charge'\nand balance_transactions.type != 'refund'\norder by bt_created desc\nlimit 5\n```\n\ndaysource_idtypenet_amounttransfer_idtransfer_date05-22-2017ch_dBtKpDrp1RuAUescharge941po_RLc0x2MGxLQDLzg05-24-201705-22-2017ch_FDJFrA3WASOPsrRcharge941po_yFSL14RSnNDsV7105-24-201705-21-2017ch_bc5On61N6sTt1h7charge941po_8cSawgdEGUL6ndY05-23-201705-21-2017ch_Si50Vfh7Gd0wMMqcharge941po_Sl82Kqt1XeE0nOa05-23-201705-21-2017ch_NNRzDtcK777eF1dcharge941po_QIMfc9Q0AO8KZhb05-23-2017\n#### Caution\n\nPayouts before 04-06-2017 have a TRANSFER_ID with a `tr_` prefix.\n\n## Transfer reversals\n\nYou can reverse a manually created payout (or transfer to a connected Stripe\naccount) if it hasn’t been paid out yet by using funds returned to the available\nbalance in your account. These are represented as\n[Transfer_reversal](https://docs.stripe.com/api#transfer_reversal_object)\nobjects and reside in the `transfer_reversals` table.\n\nTransfer reversals only apply to payouts and transfers that have been created\nmanually—you can’t reverse automatic payouts.\n\n## Links\n\n- [schema](https://docs.stripe.com/stripe-data/write-queries)\n- [payouts](https://docs.stripe.com/payouts)\n- [type](https://docs.stripe.com/api#balance_transaction_object-type)\n- [balance_transaction](https://docs.stripe.com/api#balance_transaction_object)\n- [daily\nbalance](https://dashboard.stripe.com/sigma/queries/templates/Daily%20balance)\n- [monthly summary and\nbalance](https://dashboard.stripe.com/sigma/queries/templates/Monthly%20summary%20and%20balance)\n- [Charge](https://docs.stripe.com/api#charge_object)\n- [payment card\nbreakdown](https://dashboard.stripe.com/sigma/queries/templates/Payment%20card%20breakdown)\n- [Customer](https://docs.stripe.com/api#customers)\n- [subscriptions](https://docs.stripe.com/stripe-data/query-billing-data)\n- [Refund](https://docs.stripe.com/api#refund_object)\n- [auth and capture](https://docs.stripe.com/charges/placing-a-hold)\n- [Connect](https://docs.stripe.com/connect)\n- [Transfer_reversal](https://docs.stripe.com/api#transfer_reversal_object)",
  "metadata": {
    "title": "Query transactional data | Stripe Documentation",
    "description": "Create custom reports for charges, refunds, transfers, and more.",
    "sourceURL": "https://docs.stripe.com/stripe-data/query-transactions"
  }
}