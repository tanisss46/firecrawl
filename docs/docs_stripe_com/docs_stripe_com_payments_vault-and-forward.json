{
  "content": "# Forward card details to third-party API endpoints\n\n## Use the Vault and Forward API to securely share card details across multiple processors.\n\nThe Vault and Forward API allows you to tokenize and store card details in\nStripe’s PCI-compliant vault and route that data to supported processors or\nendpoints. Leverage the API to:\n\n- Use the [Payment Element](https://docs.stripe.com/payments/payment-element)\n[across multiple\nprocessors](https://docs.stripe.com/payments/forwarding-third-party-processors).\n- Use Stripe as your primary vault for card details across processors.\n- Route card details to your own [PCI compliant token\nvault](https://docs.stripe.com/payments/forwarding-token-vault).\n\n#### Request access\n\nTo gain access to use Stripe’s forwarding service, contact [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F).\n\n## Forward requests to destination endpoints and populate card details from Stripe’s vault\n\nServer\n\nStripe\n\nDestination endpoint\n\nCreate a PaymentMethod\n\nStripe returns a PaymentMethod object\n\nCall the Vault and Forward API with the PaymentMethod you provide\n\nStripe forwards the request with card data\n\nDestination endpoint returns a response\n\nStripe redacts identified PCI sensitive data and relays the response\n\nAPI flows for forwarding card details[Collect card details and create a\nPaymentMethod](https://docs.stripe.com/payments/vault-and-forward#collect-card-details)\nTo collect card details, use the Payment Element to create [a\nPaymentMethod](https://docs.stripe.com/payments/finalize-payments-on-the-server-legacy?type=payment#create-pm).\nAfter you create a PaymentMethod, we automatically store card details in\nStripe’s PCI compliant vault. If you have your own frontend, you can still use\nthe Vault and Forward API by [creating a PaymentMethod\ndirectly](https://docs.stripe.com/api/payment_methods/create).\n\nTypically, you can only reuse PaymentMethods by attaching them to a Customer.\nHowever, the Vault and Forward API accepts all PaymentMethod objects, including\nthose not attached to a customer.\n\nSimilarly, the Vault and Forward API doesn’t\n[confirm](https://docs.stripe.com/api/payment_intents/confirm) or\n[capture](https://docs.stripe.com/api/payment_intents/capture) PaymentIntents.\nAs a result, you might unintentionally use them to capture a payment on Stripe\nthat was already captured on another processor.\n\nCVCs expire automatically after a certain time period and also expire when used\nwith the Vault and Forward API. If you require a CVC after either of these\nconditions are met, you must re-collect the card details.\n\n[Create a\nForwardingRequest](https://docs.stripe.com/payments/vault-and-forward#create-fwd-request)\nTo send card details from Stripe’s vault, you must [Create a\nForwardingRequest](https://docs.stripe.com/api/forwarding/forwarding_requests/create)\nand include the following parameters:\n\n- `payment_method`: Object that enables Stripe to identify your customer’s card\ndetails within Stripe’s vault and insert that data into the request body.\n- `url`: The exact destination endpoint of your request.\n- `request.body`: The API request body that you want to send to the destination\nendpoint (for example, the payments request you send to another processor).\nLeave any field where you normally input your customer’s card details blank.\n- `replacements`: Fields that you want Stripe to substitute in the\n`request.body`. The [available\nfields](https://docs.stripe.com/api/forwarding/forwarding_requests/create#forwarding_request_create-replacements)\nthat we recommend always setting are `card_number`, `card_expiry`, `card_cvc`,\nand `cardholder_name`. For example, including `card_number` in the\n`replacements` array replaces the appropriate card number field for your\ndestination endpoint in the `request.body`.\n\n#### Caution\n\nStripe might be more lenient than other processors in validating the cardholder\nname field. If you use the `cardholder_name` replacements field, you’re\nresponsible for making sure that the names you use pass any validation enforced\nby the destination endpoint. For example, if the destination endpoint expects\nall names to only contain the letters A-Z with no accent marks or other writing\nsystems, you must make sure the card details you forward meet this requirement.\nAn alternative is to not use the `cardholder_name` replacements field and\nspecify the cardholder name in your request body directly in your request.\n\nYou must format your request based on the data that the destination endpoint\nexpects. In the example below, the destination endpoint expects an\n`Idempotency-Key` header and accepts a JSON body with the payment details.\n\n```\ncurl https://api.stripe.com/v1/forwarding/requests \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Idempotency-Key: {{IDEMPOTENCY_KEY}}\" \\\n -d payment_method={{PAYMENT_METHOD_ID}} \\\n --data-urlencode url=\"https://endpoint-url/v1/payments\" \\\n -d \"request[headers][0][name]\"=Destination-API-Key \\\n -d \"request[headers][0][value]\"={{DESTINATION_API_KEY}} \\\n -d \"request[headers][1][name]\"=Destination-Idempotency-Key \\\n -d \"request[headers][1][value]\"={{DESTINATION_IDEMPOTENCY_KEY}} \\\n--data-urlencode\n\"request[body]\"=\"{\\\"amount\\\":{\\\"value\\\":1000,\\\"currency\\\":\\\"usd\\\"},\\\"paymentMethod\\\":{\\\"number\\\":\\\"\\\",\\\"expiryMonth\\\":\\\"\\\",\\\"expiryYear\\\":\\\"\\\",\\\"cvc\\\":\\\"\\\",\\\"holderName\\\":\\\"\\\"},\\\"reference\\\":\\\"{{REFERENCE_ID}}\\\"}\"\n\\\n -d \"replacements[0]\"=card_number \\\n -d \"replacements[1]\"=card_expiry \\\n -d \"replacements[2]\"=card_cvc \\\n -d \"replacements[3]\"=cardholder_name\n```\n\n#### Security tip\n\nWe require you to pass API keys for the destination endpoint on each API\nrequest. Stripe forwards the request using the API keys you provide, and only\nretains hashed and encrypted versions of destination endpoint API keys.\n\n#### Caution\n\nYou can provide a `Idempotency-Key` to make sure that requests with the same key\nresult in only one outbound request. Use a different and unique key for Stripe\nand any idempotency keys you provide on the underlying third-party request.\n\nUse a new `Idempotency-Key` every time you make updates to `request.body` or\n`request.header` fields. Passing in the older idempotency key results in the API\nreplaying older responses, including any previous validation errors or\ndestination endpoint errors. We recommend that you use a new idempotency key\nwhen retrying requests that encountered an error reaching the destination\nendpoint to make sure the request is retried at the destination.\n\n[Forward the request with card\ndetails](https://docs.stripe.com/payments/vault-and-forward#forward-request)\nStripe makes a request to the destination endpoint on your behalf by inserting\nthe card details from the PaymentMethod into the `request.body`. Where enabled\nand available, the Card Account Updater (CAU) automatically attempts to update\nand provide the latest available card details for requests.\n\nStripe then forwards the request to the destination endpoint. For example:\n\n- Stripe makes a POST request to the endpoint:\n\n```\nPOST /v1/payments HTTP/1.1\nUser-Agent: Stripe\nAccept: */*\nHost: endpoint-url\nContent-Type: application/json\nContent-Length: 321\n\n```\n- Stripe includes the following headers:\n\n```\nDestination-API-Key: {{DESTINATION_API_KEY}}\nDestination-Idempotency-Key: {{DESTINATION_IDEMPOTENCY_KEY}}\n\n```\n- Stripe includes the following JSON body in the request:\n\n```\n{\n amount: {\n value: 1000,\n currency: 'usd'\n },\n paymentMethod: {\n number: '4242424242424242',\n expiryMonth: '03',\n expiryYear: '2030',\n cvc: '123',\n holderName: 'First Last',\n },\n reference: '{{REFERENCE_ID}}'\n}\n\n```\n\n#### Note\n\nIf you’re using the Vault and the Forward API to make an authorization request,\nyou must handle any post-transaction actions, such as refunds or disputes,\ndirectly with the third-party processor. Contact Stripe support if you require\n3DS authentication across your multiprocessor setup.\n\n[Handle the response from the destination\nendpoint](https://docs.stripe.com/payments/vault-and-forward#return-response)\nWhen you use the Vault and Forward API to forward card details to a third-party\nprocessor, Stripe synchronously waits for a response from the destination\nendpoint. The timeout period for this response is less than a minute. Stripe\nredacts identified PCI-sensitive data, stores the redacted response from the\ndestination endpoint, and returns a\n[ForwardingRequest](https://docs.stripe.com/api/forwarding/request/object)\nobject, which contains data about the request and response.\n\n#### Caution\n\nWhen you use the Vault and Forward API to forward card details to a third-party\nprocessor, Stripe can’t guarantee that the processor will provide any particular\nresponse to your forwarded API requests. If the third-party processor is\nunresponsive, you must reach out directly to that processor to resolve the\nissue.\n\n```\n{\n id: \"fwdreq_123\",\n object: \"forwarding.request\",\n payment_method: \"{{PAYMENT_METHOD}}\",\n request_details: {\n body: '{\n \"amount\": {\n \"value\": 1000,\n \"currency\": \"usd\"\n },\n \"paymentMethod\": {\n \"number\": \"424242******4242\",\n \"expiryMonth\": \"03\",\n \"expiryYear\": \"2030\",\n \"cvc\": \"***\",\n \"holderName\": \"First Last\",\n },\n \"reference\": \"{{REFERENCE_ID}}\"\n }',\n headers: [\n {\n name: \"Content-Type\",\n value: \"application/json\",\n },\n {\n name: \"Destination-API-Key\",\n value: \"{{DESTINATION_API_KEY}}\",\n },\n {\n name: \"Destination-Idempotency-Key\",\n value: \"{{DESTINATION_IDEMPOTENCY_KEY}}\",\n },\n ...\n ]\n },\n request_context: {\n \"destination_duration\": 234,\n \"destination_ip_address\": \"35.190.113.80\"\n },\n response_details: {\n body: '{\n // Response from the third-party endpoint goes here\n ...\n }',\n headers: [\n ...\n ],\n status: 200,\n },\n replacements: [\n \"card_number\",\n \"card_expiry\",\n \"card_cvc\",\n \"cardholder_name\"\n ]\n ...\n}\n```\n\n## Configure your Vault and Forward API endpoint\n\nTo set up your Vault and Forward API endpoint, you must:\n\n- [Confirm that we support the destination\nendpoint](https://docs.stripe.com/payments/vault-and-forward#confirm-endpoint).\n- Provide a test and production account with [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F).\n- [Share the production\ndetails](https://docs.stripe.com/payments/vault-and-forward#share-production-details)\nfor the destination endpoint with [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F).\n\n### Confirm that we support the destination endpoint\n\nStripe supports forwarding API requests to the following endpoints:\n\n- **Adyen**:- `[prefix]-checkout-live.adyenpayments.com/v68/payments`\n- `[prefix]-checkout-live.adyenpayments.com/v68/storedPaymentMethods`\n- `[prefix]-checkout-live.adyenpayments.com/v69/payments`\n- `[prefix]-checkout-live.adyenpayments.com/v69/storedPaymentMethods`\n- `[prefix]-checkout-live.adyenpayments.com/v70/payments`\n- `[prefix]-checkout-live.adyenpayments.com/v70/storedPaymentMethods`\n- `[prefix]-checkout-live.adyenpayments.com/v71/payments`\n- `[prefix]-checkout-live.adyenpayments.com/v71/storedPaymentMethods`\n- **Braintree**:- `payments.braintree-api.com/graphql`\n- **Checkout**:- `api.checkout.com/tokens`\n- `api.checkout.com/payments`\n- **Fat Zebra**:- `gateway.pmnts.io/v1.0/credit_cards`\n- **FlexPay**:- `api.flexpay.io/v1/gateways/charge`\n- **GMO Payment Gateway**:- `p01.mul-pay.jp/payment/ExecTran.json`\n- **PaymentsOS**:- `api.paymentsos.com/tokens`\n- **SoftBank**- `stbfep.sps-system.com/api/xmlapi.do`\n- **Spreedly**:- `core.spreedly.com/v1/payment_methods.json`\n- **TabaPay**:- `[prefix]/v1/clients/[ClientID]/accounts`\n- **Worldpay**:- `access.worldpay.com/api/payments`\n- `access.worldpay.com/cardPayments/customerInitiatedTransactions`\n- `access.worldpay.com/tokens`\n- `secure.worldpay.com/jsp/merchant/xml/paymentService`\n- [Your own PCI-compliant token\nvault](https://docs.stripe.com/payments/forwarding-token-vault)\n\nStripe supports HTTPS-based APIs that accept JSON/XML requests and return\nJSON/XML responses. If your destination endpoint isn’t supported or you require\na different API format, share the endpoint details with [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520Access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F)\nto get support for your specific needs.\n\n### Supported countries\n\nThe Vault and Forward API can only forward requests to the following countries:\n\n### Countries eligible for request forwarding\n\nAdditionally, ensure that your Stripe account is registered in one of these\ncountries:\n\n### Countries eligible for the Vault and Forward API\n\n### Provide test accounts to Stripe support\n\nTo access the Vault and Forward API, share the [account\nIDs](https://dashboard.stripe.com/settings/account) (`acct_xxxx`) for your test\naccounts with [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F).\n\n### Share production details\n\nShare the production details for destination endpoint with [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F).\nThese include the following for destination endpoint: URL, HTTP method,\ndocumentation, fields, request headers, and encryption keys. Stripe then sets up\ndestination endpoint for use with the Vault and Forward API in live mode.\n\nTo share third-party API keys, you must encrypt them by using the Stripe public\nkey that’s specific to the Vault and Forward API. Start by [importing a public\nkey](http://www.gnupg.org/gph/en/manual.html#AEN84) using [the GNU Privacy Guard\n(PGP)](http://gnupg.org/). After you familiarize yourself with the basics of\nPGP, use the following PGP key to encrypt your third-party API keys:\n\n### Vault and Forward API PGP key\n\nTo encrypt your third-party API keys with the Vault and Forward API PGP key:\n\n- Calculate the `SHA256` hash of your private key and hex encode the hash. Treat\nthis hash as a secret.\n\n```\necho -n \"{{THIRD_PARTY_SECRET_KEY}}\" | sha256sum\n```\n- Encrypt the `SHA256` hash with Stripe’s public key, `Base64` encode the\nresult, and set the Stripe key as `trusted`.\n\n```\necho -n \"{{SHA256_HASH}}\" | gpg -e -r AE863ADA1603150856C0A853A7B203177D034588\n--always-trust | base64 > encrypted_base64.txt\n```\n- Verify `encrypted_base64.txt` by running the following command:\n\n```\ncat encrypted_base64.txt | base64 -d | gpg --list-only --list-packets\n```\n\nMake sure that `encrypted_base64.txt` contains the following characteristics:\n\n- **Key ID**: `27E4B9436302901A`\n- **Key type**: RSA\n- **Key size**: 4096 bits\n- **User ID**: `Forward API Secret Encryption Key (Forward API Secret Encryption\nKey) <multiprocessor-ext@stripe.com>`\n\n## Test your integration\n\nTo confirm that your integration works correctly with destination endpoint,\ninitiate a ForwardingRequest using the PaymentMethod you created. This example\nuses `pm_card_visa` as a payment method.\n\n```\ncurl https://api.stripe.com/v1/forwarding/requests \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Idempotency-Key: {{IDEMPOTENCY_KEY}}\" \\\n -d payment_method=pm_card_visa \\\n -d url=\"{{DESTINATION ENDPOINT}}\" \\\n -d \"request[headers][0][name]\"=Destination-API-Key \\\n -d \"request[headers][0][value]\"={{DESTINATION_API_KEY}} \\\n -d \"request[headers][1][name]\"=Destination-Idempotency-Key \\\n -d \"request[headers][1][value]\"={{DESTINATION_IDEMPOTENCY_KEY}} \\\n--data-urlencode\n\"request[body]\"=\"{\\\"amount\\\":{\\\"value\\\":1000,\\\"currency\\\":\\\"usd\\\"},\\\"paymentMethod\\\":{\\\"number\\\":\\\"\\\",\\\"expiryMonth\\\":\\\"\\\",\\\"expiryYear\\\":\\\"\\\",\\\"cvc\\\":\\\"\\\",\\\"holderName\\\":\\\"\\\"},\\\"reference\\\":\\\"{{REFERENCE_ID}}\\\"}\"\n\\\n -d \"replacements[0]\"=card_number \\\n -d \"replacements[1]\"=card_expiry \\\n -d \"replacements[2]\"=card_cvc \\\n -d \"replacements[3]\"=cardholder_name\n```\n\n#### Caution\n\nThe Vault and Forward API treats any response from the destination endpoint as a\n`success` and returns a `200`, along with the destination endpoint’s response\ncode in the `response.body`. For example, when the destination endpoint returns\na status code of `400` to Stripe, the Vault and Forward API responds with a\nstatus code of `200`. The `response.body` includes the destination endpoint’s\n`400` response and error message. Separately test the API request that you send\nto your destination endpoint to make sure that you don’t have any errors.\n\n### View your request logs in the Dashboard\n\nYou can view request logs and errors related to the Vault and Forward API in\n[Workbench](https://docs.stripe.com/workbench#request-logs). Additionally, you\ncan use the [List\nAPI](https://docs.stripe.com/api/forwarding/forwarding_requests/list) to fetch\nthe logs from Stripe.\n\n#### Security tip\n\nThe `request.headers` and `request.body` in the incoming request are encrypted\nand appear as `encrypted_request` in the Dashboard.\n\n## Links\n\n- [Payment Element](https://docs.stripe.com/payments/payment-element)\n- [across multiple\nprocessors](https://docs.stripe.com/payments/forwarding-third-party-processors)\n- [PCI compliant token\nvault](https://docs.stripe.com/payments/forwarding-token-vault)\n- [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F)\n- [a\nPaymentMethod](https://docs.stripe.com/payments/finalize-payments-on-the-server-legacy?type=payment#create-pm)\n- [creating a PaymentMethod\ndirectly](https://docs.stripe.com/api/payment_methods/create)\n- [confirm](https://docs.stripe.com/api/payment_intents/confirm)\n- [capture](https://docs.stripe.com/api/payment_intents/capture)\n- [Create a\nForwardingRequest](https://docs.stripe.com/api/forwarding/forwarding_requests/create)\n- [available\nfields](https://docs.stripe.com/api/forwarding/forwarding_requests/create#forwarding_request_create-replacements)\n- [ForwardingRequest](https://docs.stripe.com/api/forwarding/request/object)\n- [Stripe\nsupport](https://dashboard.stripe.com/login?redirect=https%3A%2F%2Fsupport.stripe.com%2Fcontact%2Femail%3Fquestion%3Dother%26topic%3Dpayment_apis%26subject%3DHow%2520can%2520I%2520Access%2520the%2520Vault%2520and%2520Forward%2520API%3F%26body%3DWhat%2520endpoint%28s%29%2520would%2520you%2520like%2520to%2520forward%2520card%2520details%2520to%3F)\n- [account IDs](https://dashboard.stripe.com/settings/account)\n- [importing a public key](http://www.gnupg.org/gph/en/manual.html#AEN84)\n- [the GNU Privacy Guard (PGP)](http://gnupg.org)\n- [Workbench](https://docs.stripe.com/workbench#request-logs)\n- [List API](https://docs.stripe.com/api/forwarding/forwarding_requests/list)",
  "metadata": {
    "title": "Forward card details to third-party API endpoints | Stripe Documentation",
    "description": "Use the Vault and Forward API to securely share card details across multiple processors.",
    "sourceURL": "https://docs.stripe.com/payments/vault-and-forward"
  }
}