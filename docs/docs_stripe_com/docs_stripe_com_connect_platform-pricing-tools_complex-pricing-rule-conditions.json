{
  "content": "# Complex pricing rule conditions\n\n## Create pricing rule conditions based on complex data sources.\n\nMost pricing rules are based on simple logical conditions, such as segmenting\npricing by payment method. You can also write rule conditions based on complex\nvariables, such as your custom metadata values. This guide explains the\nadditional steps required for these cases.\n\n## Payment Metadata\n\nAs a platform, you can add [custom\nmetadata](https://docs.stripe.com/api/metadata) to payments and reference it in\nyour pricing rules. First, add a metadata key-value pair to your\n[PaymentIntent](https://docs.stripe.com/api/payment_intents) or\n[Charge](https://docs.stripe.com/api/charges). Then, create pricing rules\nreferencing this metadata value.\n\nPricing rule conditions based on payment metadata observe the following\nbehavior:\n\n- Pricing rule conditions can evaluate metadata defined in both PaymentIntents\nand Charges.\n- A rule condition can only evaluate one key-value pair from the metadata\nparameter.\n- If you include multiple metadata key-value conditions, the pricing tool only\nevaluates the first key-value condition.\n- The pricing tool only evaluates metadata that’s available before payment is\ncaptured. Make sure you apply any updates before this point for accurate fee\ncalculation.\n- Use the API to update metadata in the\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/update#update_payment_intent-metadata)\nor [Charge](https://docs.stripe.com/api/charges/update#update_charge-metadata).\nThe pricing tool can’t evaluate updates made through the Dashboard.\n\n## See also\n\n[Complete list of supported pricing rule\nconditions](https://docs.stripe.com/connect/platform-pricing-tools/pricing-schemes#supported-rule-conditions-by-payment-type)\n\n## Links\n\n- [custom metadata](https://docs.stripe.com/api/metadata)\n- [PaymentIntent](https://docs.stripe.com/api/payment_intents)\n- [Charge](https://docs.stripe.com/api/charges)\n-\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/update#update_payment_intent-metadata)\n- [Charge](https://docs.stripe.com/api/charges/update#update_charge-metadata)\n- [Complete list of supported pricing rule\nconditions](https://docs.stripe.com/connect/platform-pricing-tools/pricing-schemes#supported-rule-conditions-by-payment-type)",
  "metadata": {
    "title": "Complex pricing rule conditions | Stripe Documentation",
    "description": "Stripe supports applying your platform application fees according to pricing rule logic based on complex and custom data.",
    "sourceURL": "https://docs.stripe.com/connect/platform-pricing-tools/complex-pricing-rule-conditions"
  }
}