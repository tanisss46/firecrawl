{
  "content": "# Query tax data\n\n## Use Sigma or Data Pipeline to retrieve tax information.\n\nStripe Tax data includes various components that work together to provide a\ncomprehensive view of your tax liability through automated calculations with\n[Payment Links](https://docs.stripe.com/tax/payment-links),\n[Checkout](https://docs.stripe.com/tax/checkout),\n[Subscriptions](https://docs.stripe.com/tax/subscriptions),\n[Invoices](https://docs.stripe.com/tax/invoicing), [Custom\nintegrations](https://docs.stripe.com/tax/custom) and [as a\nplatform](https://docs.stripe.com/tax/connect). All tax-specific data is\navailable in the **Tax** section of the schema, and the primary table is\n`tax_transactions`.\n\nTo explore tax data further, you can use additional tables that represent the\ncomponents of a `tax_transaction`, such as `tax_transaction_line_items`,\n`tax_transaction_shipping_costs`, and `tax_transaction_jurisdiction_details`.\n\nThis diagram represents all components created during an automated tax\ncalculation and how it relates to the original object that triggered\ncalculation. Amounts in the examples below appear in minor\n[currency](https://docs.stripe.com/currencies) units (for example, cents instead\nof dollars).\n\nhide sample argumentsid in_02ae51766c844635 hide sample argumentsid\ntax_6ac9561b8d634d41 source_idin_02ae51766c844635 source_type`invoice`hide\nsample argumentsid tax_li_f47e3fd32b384914\ntax_transaction_idtax_6ac9561b8d634d41 hide sample argumentsid\ntax_li_8d87a750a4d340dc tax_transaction_idtax_6ac9561b8d634d41 hide sample\nargumentstax_transaction_idtax_6ac9561b8d634d41 tax_transaction_item_id\ntax_li_f47e3fd32b384914 tax_transaction_item_type`tax_transaction_line_item`hide\nsample argumentstax_transaction_idtax_6ac9561b8d634d41\ntax_transaction_item_idtax_li_8d87a750a4d340dc\ntax_transaction_item_type`tax_transaction_shipping_cost`\n## Tax transactions\n\nEach row in the `tax_transactions` table represents a single\n[tax_transaction](https://docs.stripe.com/api/tax/transactions/object) object.\nTax transactions record the assumed or reduced tax liability for a transaction\nor reversal. You can report on every tax transaction created with automated tax\ncalculations.\n\nThis table is our recommended starting point for creating reports on your tax\nliability. You need to join on the other tax tables below for your tax liability\namounts, but this table joins your data to other products like invoices and\ncheckout sessions. Joining to non-tax tables by `source_id` and `source_type`\nprovides the object that triggers the creation of the tax transaction.\n\nTax transactions have a one-to-one relationship with their original source\nobject. The following example retrieves a list of reportable tax transactions\nwith their original source of invoices, which you can then expand on with [query\nbilling data](https://docs.stripe.com/stripe-data/query-billing-data).\n\n```\nselect\n tx.id as tax_transaction_id,\n tx.posted_at as tax_transaction_posted_at,\n inv.id as invoice_id,\n inv.total as invoice_total\nfrom\n tax_transactions tx\n inner join invoices inv on inv.id = tx.source_id\nlimit\n 5\n```\n\ntax_transaction_idtax_transaction_posted_atinvoice_idinvoice_totaltax_f4X7iVeuZxh2aos2024-06-18\n16:40:16 +0000in_oXCl9MLgDjbMiL520,000tax_r7yjOkhUupQgfei2021-06-28 00:01:21\n+0000in_0ByyEJJVFdLRu1L189tax_hw7JNLccDoXELs92024-06-23 23:35:40\n+0000in_PmSAYKFlMPnrjOq219tax_ita7SUjbHDJnDdq2024-06-23 23:35:40\n+0000in_QcpXQ8WomRlbCRz10,475tax_pxd81rnNtqninUe2023-07-23 04:03:06\n+0000in_7EBeKqBBSj6NAJk200\n### Tax transactions metadata\n\nTax transactions might have metadata set with your [custom\nintegrations](https://docs.stripe.com/tax/custom). Each row in\n`tax_transactions_metadata` returns one key-value pair.\n\ntax_transactions\n\ntax_transactions_metadata[0]\n\ntax_transactions_metadata[1]\n\ntax_transactions_metadata[2]\n\nTax Transactions Metadata overview\n## Tax transaction items\n\nTax line items and tax shipping costs make up the total amounts and tax\nliability for tax transactions. Tax line items and tax shipping costs are in\ntheir own tables, but they both contribute to amounts and total tax liability.\n\n### Tax line items\n\nTax line items represent line items that contribute to the sale of goods for the\ntransaction. Each row in `tax_transaction_line_items` represents a single tax\nline item associated to the `tax_transaction`.\n\n### Tax shipping costs\n\nTax shipping costs represent shipping items that contribute to the shipment of\ngoods for the transaction. Each row in `tax_transaction_shipping_costs`\nrepresents a single shipping cost associated to the `tax_transaction`.\n\n#### Note\n\nThese tables provide high level information based on each item. A single tax\ntransaction can have multiple line items and one shipping cost which make up the\namounts for a tax transaction.\n\n**amount**: This is the gross amount of the line item. When `tax_behavior` is\n`inclusive`, it includes tax liability amounts. When `tax_behavior` is\n`exclusive` (the default), it excludes tax liability amounts.\n\n**amount_tax**: This is the amount of tax liability for the line item.\n\n**currency**: This is the [presentment\ncurrency](https://docs.stripe.com/currencies) that defines `amount` and\n`amount_tax`. Summing across different currencies yields unexpected results.\n\ntax_transactions\n\ntax_transaction_line_items[0]\n\ntax_transaction_line_items[1]\n\ntax_transaction_line_items[2]\n\ntax_transaction_line_items[3]\n\ntax_transaction_shipping_costs[0]\n\nTax Transaction Items Overview\nThe following example retrieves a list of all amounts and tax liability for a\ngiven `tax_transaction`.\n\n```\nwith tax_amounts as (\n select\n li.tax_transaction_id,\n li.id,\n li.amount,\n li.amount_tax,\n li.tax_behavior,\n li.currency,\n 'line_item' as item_type\n from\n tax_transaction_line_items li\n union all\n select\n sc.tax_transaction_id,\n sc.id,\n sc.amount,\n sc.amount_tax,\n sc.tax_behavior,\n sc.currency,\n 'shipping_cost' as item_type\n from\n tax_transaction_shipping_costs sc\n)\nselect\n id,\n amount,\n amount_tax,\n tax_behavior,\n currency,\n item_type\nfrom\n tax_amounts\nwhere\n tax_transaction_id = 'tax_d2e5470dC63u'\n```\n\nidamountamount_taxtax_behaviorcurrencyitem_typetax_li_NCgbmTtmU3aIHH93,1000exclusiveusdline_itemtax_li_T09OHN6pMa66j3k1,999190exclusiveusdline_itemtax_li_FYgUdAppdbgV38X3,500304inclusiveusdline_itemtax_li_BzbrFuAGd4OxQNI4,242242exclusiveusdline_itemtax_li_zDGi30Kox0fGOTW7990exclusiveusdshipping_cost\n### Tax transaction line items metadata\n\nTax transaction line items might have metadata set with your [custom\nintegrations](https://docs.stripe.com/tax/custom). Each row in\n`tax_transaction_line_items_metadata` returns one key-value pair.\n\ntax_transaction_line_items\n\ntax_transaction_line_items_metadata[0]\n\ntax_transaction_line_items_metadata[1]\n\ntax_transaction_line_items_metadata[2]\n\nTax Transactions Metadata\n## Tax transaction jurisdiction details\n\nEach row in the `tax_transaction_jurisdiction_details` table represents a\njurisdiction which makes up the liability for the tax transaction item\n(`tax_transaction_line_item` or `tax_transaction_shipping_cost`).\n\n### Understanding jurisdiction details\n\nThis table provides more in-depth information based on each jurisdiction. A\nsingle tax transaction item can have multiple jurisdictions which make up the\namounts for a tax transaction item.\n\nSumming `amount_taxable` or `amount_non_taxable` across all jurisdiction details\ndoesn’t always equal the tax transaction item’s `amount`.\n\n**amount_taxable**: This is the amount up to the tax transaction item’s `amount`\nthat is taxable. Multiple jurisdictions can have the same taxable amount.\n\n**amount_non_taxable**: This is the amount up to the tax transaction item\n`amount` that is non-taxable. Multiple jurisdictions can have the same\nnon-taxable amount.\n\n**amount_tax**: This is part of the tax transaction item `amount_tax`. Summing\nthis across all jurisdiction details equals the transaction item’s `amount_tax`.\n\n**currency**: This is the [presentment\ncurrency](https://docs.stripe.com/currencies) that defines `amount_taxable`,\n`amount_non_taxable` and `amount_tax`. Summing across different currencies\nyields unexpected results.\n\n**filing_currency**: This is the [filing\ncurrency](https://docs.stripe.com/currencies) used by the applicable tax\nauthority which defines `filing_amount_taxable`, `filing_amount_non_taxable` and\n`filing_amount_tax`. Summing across different filing currencies yields\nunexpected results.\n\nhide sample argumentsidtax_li_6836762dd869439famount`100`amount_tax`15`hide\nsample arguments tax_transaction_item_id\ntax_li_6836762dd869439fjurisdiction_level`state`amount_taxable`100`amount_non_taxable`0`amount_tax`10`hide\nsample arguments tax_transaction_item_id\ntax_li_6836762dd869439fjurisdiction_level`country`amount_taxable`0`amount_non_taxable`100`amount_tax`0`hide\nsample arguments tax_transaction_item_id\ntax_li_6836762dd869439fjurisdiction_level`district`amount_taxable`50`amount_non_taxable`50`amount_tax`5`\nThe following example retrieves all jurisdiction details for a given tax\ntransaction item.\n\n```\nselect\n jd.amount_taxable,\n jd.amount_non_taxable,\n jd.amount_tax,\n jd.taxability_reason,\n jd.jurisdiction_level,\n jd.jurisdiction_name,\nconcat(jd.jurisdiction_country, '-', jd.jurisdiction_state) as\njurisdiction_location\nfrom\n tax_transaction_jurisdiction_details jd\nwhere\n li.id = 'tax_li_52d37cdd6f7'\n```\n\namount_taxableamount_non_taxableamount_taxtaxability_reasonjurisdiction_leveljurisdiction_namejurisdiction_location01,2990not_subject_to_taxcountryUnited\nStates1,299077standard_ratedstateCaliforniaUS-CA1,299016standard_ratedcountySan\nDiegoUS-CA1,29907standard_rateddistrictTransactions and Use Tax\n(CLVT)US-CA1,29907standard_rateddistrictTransactions and Use Tax\n(CVGT)US-CA1,29907standard_rateddistrictRegional Transportation Commission\n(SDCT)US-CA\n## Example queries\n\nFor additional examples, please reference the [Tax section of query template\nlibrary in Sigma sidebar](https://dashboard.stripe.com/sigma/queries).\n\n### Tax liability by month\n\nThis example summarizes the tax liability imposed on line items and shipping\ncosts grouped by month and [currency](https://docs.stripe.com/currencies).\n\n```\nwith tax_amounts as (\n select\n li.tax_transaction_id,\n li.amount,\n li.amount_tax,\n li.tax_behavior,\n li.currency\n from\n tax_transaction_line_items li\n union all\n select\n sc.tax_transaction_id,\n sc.amount,\n sc.amount_tax,\n sc.tax_behavior,\n sc.currency\n from\n tax_transaction_shipping_costs sc\n),\ntax_liability as (\n select\n date_format(date_trunc('month', posted_at), '%Y-%m-%d') as month,\n currency as presentment_currency,\n sum(\n (\n```\n\nSee all 49\nlinesmonthpresentment_currencytotal_sales_excluding_taxtotal_tax2025-03-01usd286,60043,5222025-03-01eur30,898562025-02-01usd79,7762,5652025-02-01eur55,4343,954\n### Tax itemized jurisdiction details\n\nThis template itemizes tax transaction jurisdiction details for the previous\nmonth to produce a customizable version of the [Tax itemized\nexport](https://docs.stripe.com/tax/reports#itemized-exports). Review the\ncomments throughout the template to learn more about how it is customizable for\nyour needs.\n\n```\nwith tax_amounts as (\n select\n li.id,\n li.source_line_item_id,\n li.amount,\n li.amount_tax,\n li.tax_behavior,\n li.tax_code,\n li.currency,\n li.quantity_decimal\n from\n tax_transaction_line_items li\n union all\n select\n sc.id,\n -- Shipping costs do not have source line item IDs\n '' as source_line_item_id,\n sc.amount,\n sc.amount_tax,\n sc.tax_behavior,\n sc.tax_code,\n sc.currency,\n -- Shipping costs do not have a quantity\n '' as quantity_decimal\n from\n```\n\nSee all 85\nlinessource_idsource_typepresentment_currencyposted_attax_date,transaction_source_item_idtransaction_item_idamountamount_taxtax_behaviortax_codejurisdiction_namejurisdiction_level…in_FmrxdLcUBDvzRWJinvoiceeur2025-02-152025-02-15il_7Mp6RmTqO7ZwLmWtax_il_Upjn1v8h2plDTHh-199-20exclusivetxcd_99999999Irelandcountry…in_mnDZm2m8Ec64qpNinvoiceusd2025-02-152025-02-15il_dTuKeHjncroFiyLtax_il_NZc5R4aaerHsopS10,0001,000exclusivetxcd_99999999Rhode\nIslandstate…in_rkXBn1odpDKcLGPinvoiceusd2025-02-092025-02-09il_vlooRsmcYhdFgp7tax_il_Nx5GA7lVrqDfBJO2,999371exclusivetxcd_99999999Fire\nDistrict 17district…\n\n## Links\n\n- [Payment Links](https://docs.stripe.com/tax/payment-links)\n- [Checkout](https://docs.stripe.com/tax/checkout)\n- [Subscriptions](https://docs.stripe.com/tax/subscriptions)\n- [Invoices](https://docs.stripe.com/tax/invoicing)\n- [Custom integrations](https://docs.stripe.com/tax/custom)\n- [as a platform](https://docs.stripe.com/tax/connect)\n- [currency](https://docs.stripe.com/currencies)\n- [Invoice](https://docs.stripe.com/api/invoices/object)\n- [tax_transactions](https://docs.stripe.com/api/tax/transactions/object)\n- [query billing data](https://docs.stripe.com/stripe-data/query-billing-data)\n- [Tax section of query template library in Sigma\nsidebar](https://dashboard.stripe.com/sigma/queries)\n- [Tax itemized export](https://docs.stripe.com/tax/reports#itemized-exports)",
  "metadata": {
    "title": "Query tax data | Stripe Documentation",
    "description": "Use Sigma or Data Pipeline to retrieve tax information.",
    "sourceURL": "https://docs.stripe.com/stripe-data/query-tax-data"
  }
}