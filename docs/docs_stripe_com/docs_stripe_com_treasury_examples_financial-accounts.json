{
  "content": "# Use Treasury and Issuing to set up financial accounts and cards\n\n## Follow a sample Treasury and Issuing integration that sets up a financial account and creates cards.\n\nHomebox is a fictitious vertical SaaS that builds software for home-services\ncompanies like HVAC technicians, cleaners, and plumbers. Homebox begins its\nTreasury integration by setting up a Treasury financial account and creating\npayment cards. To see how Homebox moves money to and from external bank\naccounts, see the [Using Treasury to move\nmoney](https://docs.stripe.com/treasury/examples/moving-money) example\nintegration.\n\n## Platform onboarding\n\nHomebox is already a Stripe platform with\n[Payments](https://docs.stripe.com/payments) and\n[Connect](https://docs.stripe.com/connect) enabled. Homebox uses [Custom\nconnected accounts](https://docs.stripe.com/connect/accounts), and those\nconnected accounts already have the `card_payments` capability enabled.\n\n## Add capabilities\n\nTo use Treasury and Issuing services, Homebox needs to request the additional\n`treasury` and `card_issuing` capabilities for the platform’s connected\naccounts. Each connected account must then onboard before Stripe can create a\nTreasury financial account for it.\n\nTo use ACH transfers with Treasury, Homebox also needs to request the\n`us_bank_account_ach_payments` capability.\n\nTo request the `treasury`, `card_issuing`, and `us_bank_account_ach_payments`\ncapabilities, Homebox makes a request to the [Accounts\nAPI](https://docs.stripe.com/api/accounts).\n\n```\ncurl https://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"capabilities[treasury][requested]\"=true \\\n -d \"capabilities[card_issuing][requested]\"=true \\\n -d \"capabilities[us_bank_account_ach_payments][requested]\"=true\n```\n\nTo use Hosted Onboarding, Homebox makes a call to [Account\nLinks](https://docs.stripe.com/api/account_links) to retrieve a URL that their\nconnected account can use to submit onboarding information for the Treasury\nfinancial account.\n\n```\ncurl https://api.stripe.com/v1/account_links \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d account={{CONNECTED_ACCOUNT_ID}} \\\n --data-urlencode refresh_url=\"https://example.com/reauth\" \\\n --data-urlencode return_url=\"https://example.com/return\" \\\n -d type=account_onboarding\n```\n\nThe response includes a URL the connected account uses to access the\napplication, which must be done before the link expires.\n\n```\n{\n \"object\": \"account_link\",\n \"created\": 1612927106,\n \"expires_at\": 1612927406,\n \"url\": \"https://connect.stripe.com/setup/s/iCtLfmYb2tEU\"\n}\n```\n\nHomebox listens for the `account.updated` webhook to confirm the following\nfields and capabilities on the connected account:\n\n```\n{\n \"object\": {\n \"id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"object\": \"account\",\n \"capabilities\": {\n \"card_payments\": \"active\",\n \"treasury\": \"active\",\n\"card_issuing\": \"active\", // Only appears if requesting the `card_issuing`\ncapability.\n\"us_bank_account_ach_payments\": \"active\", // Only appears if requesting the\n`us_bank_account_ach_payments` capability.\n },\n ...\n }\n}\n```\n\n## Create a FinancialAccount\n\nAfter Stripe adds the `treasury` capability to an account, Homebox can create\nthe `FinancialAccount` object for the account. To do so, Homebox calls\n`FinancialAccounts` and requests the `Features` the company wants to provide.\n\n```\ncurl https://api.stripe.com/v1/treasury/financial_accounts \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Stripe-Account: {{CONNECTED_ACCOUNT_ID}}\" \\\n -d \"supported_currencies[]\"=usd \\\n -d \"features[card_issuing][requested]\"=true \\\n -d \"features[deposit_insurance][requested]\"=true \\\n -d \"features[financial_addresses][aba][requested]\"=true \\\n -d \"features[inbound_transfers][ach][requested]\"=true \\\n -d \"features[intra_stripe_flows][requested]\"=true \\\n -d \"features[outbound_payments][ach][requested]\"=true \\\n -d \"features[outbound_payments][us_domestic_wire][requested]\"=true \\\n -d \"features[outbound_transfers][ach][requested]\"=true \\\n -d \"features[outbound_transfers][us_domestic_wire][requested]\"=true\n```\n\nThe response confirms the account is processing. After processing completes and\nall relevant features are active, Homebox gets a confirmation from their\n`treasury.financial_account.features_status_updated` webhook listener.\n\n```\n{\n \"object\": \"treasury.financial_account\",\n \"created\": 1612927106,\n \"id\": \"{{FINANCIAL_ACCOUNT_ID}}\",\n \"country\": \"US\",\n \"supported_currencies\": [\"usd\"],\n\"financial_addresses\": [ // This field is empty until the\n\"financial_addresses.aba\" feature becomes active\n {\n \"type\": \"aba\",\n \"supported_networks\": [\"ach\", \"us_domestic_wire\"],\n \"aba\": {\n \"account_number_last4\": \"7890\",\n// Use the expand[] parameter to view the `account_number` field hidden by\ndefault\n \"account_number\": \"1234567890\",\n \"routing_number\": \"000000001\",\n \"bank_name\": \"Bank of Earth\"\n }\n }\n ],\n \"livemode\": true,\n\n // State machine:\n // open - the account is ready to be used\n // closed - the account is closed\n \"status\": \"open\",\n \"status_details\": {\n // `closed` is null if financial account is not closed\n \"closed\": {\n // List of one or more reasons why the FinancialAccount was closed:\n // - account_rejected\n // - closed_by_platform\n // - other\n \"reasons\": [],\n }\n },\n\n active_features: [\"card_issuing\"],\npending_features: [\"deposit_insurance\", \"financial_addresses.aba\",\n\"outbound_payments.ach\", \"us_domestic_wire\", \"inbound_transfers.ach\",\n\"outbound_transfers.ach\", \"outbound_transfers.us_domestic_wire\"],\n restricted_features: [],\n\n \"features\": {\n \"object\": \"treasury.financial_account_features\",\n \"card_issuing\": {\n \"status\": \"active\",\n \"status_details\": [],\n \"access\": \"active\",\n },\n \"deposit_insurance\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n \"financial_addresses\": {\n \"aba\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"outbound_payments\": {\n \"ach\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"us_domestic_wire\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n \"inbound_transfers\": {\n \"ach\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"outbound_transfers\": {\n \"ach\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"outbound_payments\": {\n \"ach\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"outbound_transfers\": {\n \"us_domestic_wire\": {\n \"requested\": true,\n\"status\": \"pending\", // Becomes \"active\" once the Treasury financial account is\nset up\n \"status_details\": [{\"code\": \"activating\", \"resolution\": nil}],\n },\n },\n \"platform_restrictions\": {\n \"inbound_flows\": \"unrestricted\",\n \"outbound_flows\": \"unrestricted\"\n },\n \"metadata\": {},\n ...\n}\n```\n\n## Create a payment cardholder\n\nBefore Homebox can create cards for Treasury financial accounts, it needs to\ncreate cardholders. The cardholders in this example are plumbers who use Homebox\nservices and own the connected accounts on the platform.\n\n```\ncurl https://api.stripe.com/v1/issuing/cardholders \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Stripe-Account: {{CONNECTED_ACCOUNT_ID}}\" \\\n -d name=\"Jenny Bath Remodeling\" \\\n -d type=company \\\n --data-urlencode email=\"jenny@example.com\" \\\n --data-urlencode phone_number=\"+18008675309\" \\\n -d status=active \\\n -d \"billing[address][line1]\"=\"1234 Main Street\" \\\n -d \"billing[address][city]\"=\"San Francisco\" \\\n -d \"billing[address][state]\"=CA \\\n -d \"billing[address][postal_code]\"=94111 \\\n -d \"billing[address][country]\"=US\n```\n\nThe response confirms the cardholder is created.\n\n```\n{\n \"id\": \"{{CARDHOLDER_ID}}\",\n \"object\": \"issuing.cardholder\",\n \"billing\": {\n \"address\": {\n \"city\": \"\\\"San Francisco\\\"\",\n \"country\": \"US\",\n \"line1\": \"\\\"1234 Main Street\\\"\",\n \"postal_code\": \"94111\",\n \"state\": \"CA\"\n }\n },\n \"created\": 1623803705,\n \"email\": \"jenny@example.com\",\n \"livemode\": false,\n \"metadata\": {},\n \"name\": \"Jenny Bath Remodeling\",\n \"phone_number\": \"+18008675309\",\n \"requirements\": {\n \"disabled_reason\": \"under_review\",\n \"past_due\": []\n },\n \"spending_controls\": {\n \"allowed_categories\": [],\n \"blocked_categories\": [],\n \"spending_limits\": [],\n },\n \"status\": \"active\",\n \"type\": \"company\"\n}\n```\n\n## Create payment cards\n\nNow that the connected account has a `FinancialAccount` object associated with\nit and an available cardholder, Homebox can create a payment card using the\n`FinancialAccount` balance as the card’s available balance.\n\n```\ncurl https://api.stripe.com/v1/issuing/cards \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Stripe-Account: {{CONNECTED_ACCOUNT_ID}}\" \\\n -d currency=usd \\\n -d type=virtual \\\n -d cardholder={{CARDHOLDER_ID}} \\\n -d financial_account={{FINANCIAL_ACCOUNT_ID}}\n```\n\nThe response confirms the card is issued.\n\n```\n{\n \"id\": \"{{CARD_ID}}\",\n \"object\": \"issuing.card\",\n \"cardholder\": {\n \"id\": \"{{CARDHOLDER_ID}}\",\n \"object\": \"issuing.cardholder\",\n \"billing\": {\n \"address\": {\n \"city\": \"San Francisco\",\n \"country\": \"US\",\n \"line1\": \"123 Main Street\",\n \"line2\": null,\n \"postal_code\": \"94111\",\n \"state\": \"CA\"\n }\n },\n ...\n },\n \"created\": 1643293629,\n \"currency\": \"usd\",\n \"exp_month\": 12,\n \"exp_year\": 2024,\n \"last4\": \"0930\",\n \"livemode\": false,\n ...\n}\n```\n\n## See also\n\n- [Using Treasury to move\nmoney](https://docs.stripe.com/treasury/examples/moving-money)\n- [API reference](https://docs.stripe.com/api/treasury/financial_accounts)\n\n## Links\n\n- [Using Treasury to move\nmoney](https://docs.stripe.com/treasury/examples/moving-money)\n- [Payments](https://docs.stripe.com/payments)\n- [Connect](https://docs.stripe.com/connect)\n- [Custom connected accounts](https://docs.stripe.com/connect/accounts)\n- [Accounts API](https://docs.stripe.com/api/accounts)\n- [Account Links](https://docs.stripe.com/api/account_links)\n- [https://example.com/reauth](https://example.com/reauth)\n- [https://example.com/return](https://example.com/return)\n-\n[https://connect.stripe.com/setup/s/iCtLfmYb2tEU](https://connect.stripe.com/setup/s/iCtLfmYb2tEU)\n- [API reference](https://docs.stripe.com/api/treasury/financial_accounts)",
  "metadata": {
    "title": "Use Treasury and Issuing to set up financial accounts and cards | Stripe Documentation",
    "description": "Follow a sample Treasury and Issuing integration that sets up a financial account and creates cards.",
    "sourceURL": "https://docs.stripe.com/treasury/examples/financial-accounts"
  }
}