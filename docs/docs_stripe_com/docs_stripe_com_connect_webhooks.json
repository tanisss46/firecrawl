{
  "content": "# Connect webhooks\n\n## Learn how to use webhooks with Connect to be notified of Stripe activity.\n\nStripe uses [webhooks](https://docs.stripe.com/webhooks) to notify your\napplication when an event happens in your account. All\n[Connect](https://docs.stripe.com/connect) integrations should establish a\n[webhook endpoint](https://dashboard.stripe.com/account/webhooks) to listen for\nConnect events.\n\n## Connect webhooks\n\nThere are a few types of webhooks:\n\n- *Account* webhooks are for activity on your own account (for example, most\nrequests made using your API keys and without [authenticating as another Stripe\naccount](https://docs.stripe.com/connect/authentication)). This includes all\ntypes of charges, except those made directly on a connected account.\n- *Connect* webhooks are for activity on any connected account. All events on\nthe connected account are sent to the Connect webhooks. This includes the\nimportant `account.updated` event for any connected account and direct charges.\n\nWhen creating your webhook, ensure it is correctly configured to receive Connect\nwebhook events. You can do this with the API by setting the [connect\nparameter](https://docs.stripe.com/api/webhook_endpoints/create#create_webhook_endpoint-connect)\nto `true` when creating the webhook endpoint, or [through the\nDashboard](https://dashboard.stripe.com/test/webhooks).\n\n![Webhook settings in the Stripe\nDashboard](https://b.stripecdn.com/docs-statics-srv/assets/webhooks.ac3d6c19a5281fbbd2b85a335cd887b3.png)\n\nFor Connect webhooks, only test webhooks are sent to your development webhook\nURLs, but *both live and test* webhooks are sent to your production webhook\nURLs. This is because you can perform both live and test transactions under a\nproduction application. For this reason, we recommend that you check the\n`livemode` value when receiving an event webhook to know what action, if any,\nusers should take.\n\nAs we state in the [event object\nreference](https://docs.stripe.com/api/events/object), each event for a\nconnected account also contains a top-level `account` property. It identifies\nthe account that the webhook is sent to and the `data[object]` it belongs to.\nBecause these objects belong to other accounts, you must make the API requests\n[as the corresponding connected\naccount](https://docs.stripe.com/connect/authentication) to access them.\n\n```\n{\n \"id\": \"{{EVENT_ID}}\",\n \"livemode\": true,\n \"object\": \"event\",\n \"type\": \"customer.created\",\n \"account\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"pending_webhooks\": 2,\n \"created\": 1349654313,\n \"data\": {...}\n}\n```\n\nThere are several events related to accounts that Stripe recommends listening\nfor:\n\nEventdata.object\ntypeDescription`account.application.deauthorized``application`Occurs when a\nconnected account disconnects from your platform. You can use it to trigger\ncleanup on your server. Available for connected accounts with access to the\nStripe Dashboard, which includes [Standard\naccounts](https://docs.stripe.com/connect/standard-accounts).`account.external_account.updated`An\nexternal account, such as `card` or `bank_account`Occurs when [a bank account or\ndebit card attached to a connected account is\nupdated](https://docs.stripe.com/connect/payouts-bank-accounts), which can\nimpact payouts. Available for connected accounts that your platform controls,\nwhich includes Custom and Express accounts, and Standard accounts with [platform\ncontrols](https://docs.stripe.com/connect/platform-controls-for-stripe-dashboard-accounts)\nenabled.`account.updated``account`Allows you to monitor changes to connected\naccount requirements and status changes. Available for all connected\naccounts.`balance.available``balance`Occurs when your Stripe balance has been\nupdated (for example, when [funds you’ve added from your bank\naccount](https://docs.stripe.com/connect/add-and-pay-out-guide#add-funds) are\navailable for transfer to your connected\naccount).`payment_intent.succeeded``payment_intent`Occurs when a payment intent\nresults in a successful charge. Available for all payments, including\n[destination](https://docs.stripe.com/connect/collect-then-transfer-guide#fulfillment)\nand [direct](https://docs.stripe.com/connect/enable-payment-acceptance-guide)\ncharges.`payout.failed``payout`Occurs when [a payout\nfails](https://docs.stripe.com/connect/payouts-connected-accounts#webhooks).\nWhen a payout fails, the external account involved is disabled, and no automatic\nor manual payouts can be processed until the external account is\nupdated.`person.updated``person`If you [use the Persons\nAPI](https://docs.stripe.com/connect/handling-api-verification#verification-process),\nallows you to monitor changes to requirements and status changes for\nindividuals. Available for connected accounts that your platform controls, which\nincludes Custom and Express accounts, and Standard accounts with [platform\ncontrols](https://docs.stripe.com/connect/platform-controls-for-stripe-dashboard-accounts)\nenabled.Event:account.application.deauthorizedaccount.updatedperson.updatedpayment_intent.succeeded,\ndirect chargepayment_intent.succeeded, non-direct\nchargebalance.availableaccount.external_account.updatedpayout.failed\n```\n# Using Sinatra.\nrequire 'sinatra'\nrequire 'stripe'\n\nset :port, 4242\n\n# Set your secret key. Remember to switch to your live secret key in production.\n# See your keys here: https://dashboard.stripe.com/apikeys\nStripe.api_key = 'sk_test_BQokikJOvBiI2HlWgH4olfQ2'\n\n# If you are testing your webhook locally with the Stripe CLI you\n# can find the endpoint's secret by running `stripe listen`\n# Otherwise, find your endpoint's secret in your webhook settings in\n# the Developer Dashboard\nendpoint_secret = 'whsec_...'\n\npost '/webhook' do\n payload = request.body.read\n sig_header = request.env['HTTP_STRIPE_SIGNATURE']\n\n event = nil\n\n # Verify webhook signature and extract the event.\n # See https://stripe.com/docs/webhooks#verify-events for more information.\n begin\n event = Stripe::Webhook.construct_event(\n payload, sig_header, endpoint_secret\n )\n rescue JSON::ParserError => e\n # Invalid payload.\n status 400\n return\n rescue Stripe::SignatureVerificationError => e\n # Invalid Signature.\n status 400\n return\n end\n\n if event['type'] == 'account.application.deauthorized'\n application = event['data']['object']\n connected_account_id = event['account']\n handle_deauthorization(connected_account_id, application)\n end\n\n status 200\nend\n\ndef handle_deauthorization(connected_account_id, application)\n # Clean up account state.\n puts 'Connected account ID: ' + connected_account_id\n puts application.to_s\nend\n```\n\nThe events listed above are the ones we typically recommend Connect integrations\nlisten for, but there are [many other event\ntypes](https://docs.stripe.com/api/events/types) you may be interested in.\n\n## Test webhooks locally\n\nYou can test webhooks locally with the Stripe CLI.\n\n- If you haven’t already, [install the Stripe\nCLI](https://docs.stripe.com/stripe-cli#install) on your machine.\n- Log in to your Stripe account and set up the CLI by running `stripe login` on\nthe command line.\n- Allow your local host to receive a simulated event on your connected account\nby running `stripe listen --forward-to localhost:{PORT}/webhook` in one terminal\nwindow, and running `stripe trigger {{EVENT_NAME}}` in another.\n\n#### Note\n\nFor Connect webhooks, use\n[–forward-connect-to](https://docs.stripe.com/cli/listen#listen-forward-connect-to)\nwith `stripe listen` and\n[–stripe-account](https://docs.stripe.com/cli/trigger#trigger-stripe_account)\nwith `stripe trigger`.\n\n## See also\n\n- [Webhook documentation](https://docs.stripe.com/webhooks)\n- [Event object reference](https://docs.stripe.com/api#events)\n\n## Links\n\n- [webhooks](https://docs.stripe.com/webhooks)\n- [Connect](https://docs.stripe.com/connect)\n- [webhook endpoint](https://dashboard.stripe.com/account/webhooks)\n- [authenticating as another Stripe\naccount](https://docs.stripe.com/connect/authentication)\n- [connect\nparameter](https://docs.stripe.com/api/webhook_endpoints/create#create_webhook_endpoint-connect)\n- [through the Dashboard](https://dashboard.stripe.com/test/webhooks)\n- [event object reference](https://docs.stripe.com/api/events/object)\n- [Standard accounts](https://docs.stripe.com/connect/standard-accounts)\n- [a bank account or debit card attached to a connected account is\nupdated](https://docs.stripe.com/connect/payouts-bank-accounts)\n- [platform\ncontrols](https://docs.stripe.com/connect/platform-controls-for-stripe-dashboard-accounts)\n- [funds you’ve added from your bank\naccount](https://docs.stripe.com/connect/add-and-pay-out-guide#add-funds)\n-\n[destination](https://docs.stripe.com/connect/collect-then-transfer-guide#fulfillment)\n- [direct](https://docs.stripe.com/connect/enable-payment-acceptance-guide)\n- [a payout\nfails](https://docs.stripe.com/connect/payouts-connected-accounts#webhooks)\n- [use the Persons\nAPI](https://docs.stripe.com/connect/handling-api-verification#verification-process)\n- [https://dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)\n-\n[https://stripe.com/docs/webhooks#verify-events](https://stripe.com/docs/webhooks#verify-events)\n- [many other event types](https://docs.stripe.com/api/events/types)\n- [install the Stripe CLI](https://docs.stripe.com/stripe-cli#install)\n-\n[–forward-connect-to](https://docs.stripe.com/cli/listen#listen-forward-connect-to)\n- [–stripe-account](https://docs.stripe.com/cli/trigger#trigger-stripe_account)\n- [Event object reference](https://docs.stripe.com/api#events)",
  "metadata": {
    "title": "Connect webhooks | Stripe Documentation",
    "description": "Learn how to use webhooks with Connect to be notified of Stripe activity.",
    "sourceURL": "https://docs.stripe.com/connect/webhooks"
  }
}