{
  "content": "# Testing account verification during API onboarding\n\n## A walk-through of testing different verification states for connected accounts during API onboarding using your test API key.\n\nThis document assumes you’re familiar with [API\nonboarding](https://docs.stripe.com/connect/api-onboarding), how to [update\naccounts](https://docs.stripe.com/connect/updating-service-agreements), and\n[identity verification](https://docs.stripe.com/connect/identity-verification).\n\nTest your verification flows to make sure they can handle changes in account\nstate (for example, when you enable or disable charges). Account states\ngenerally change after fulfilling requirements or when reaching processing or\ntime thresholds. The sections below describe these changes and how to test your\nverification flows.\n\n## Testing initial requirements\n\nStart by creating a new connected account in test mode, adding a bank account,\nand showing that the account holder accepted the Stripe Services Agreement.\nStripe requires that the connected account explicitly accepts [Stripe’s service\nagreement](https://docs.stripe.com/connect/updating-service-agreements#tos-acceptance)\nbefore making payouts. For this example, the `business_type` is set to `company`\nto illustrate a more complex scenario, and the `external_account` uses a\ntokenized Stripe test account as a reminder to avoid exposing sensitive\ninformation in API calls.\n\n#### Note\n\nYou must provide a test API key from a Stripe account which has begun Connect\nplatform onboarding. The auto-filled Stripe test API key causes these sample\nrequests to fail.\n\nYou can create a connected account using either controller properties or by\nsetting the account type. In either case, you must set country and request the\n`card_payments` and `transfers` capabilities.\n\nWith controller propertiesWith account type\n```\ncurl https://api.stripe.com/v1/accounts \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d country=US \\\n -d \"controller[losses][payments]\"=application \\\n -d \"controller[fees][payer]\"=application \\\n -d \"controller[stripe_dashboard][type]\"=none \\\n -d \"controller[requirement_collection]\"=application \\\n -d business_type=company \\\n -d \"capabilities[card_payments][requested]\"=true \\\n -d \"capabilities[transfers][requested]\"=true \\\n -d external_account=btok_us \\\n -d \"tos_acceptance[date]\"=1547923073 \\\n -d \"tos_acceptance[ip]\"=\"172.18.80.19\"\n```\n\nAt this point, the account is created but charges and\n[payouts](https://docs.stripe.com/payouts) are still disabled. In the response,\ncheck the `requirements.currently_due` array to determine what information you\nneed to collect:\n\n```\n{\n \"id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"object\": \"account\",\n \"requirements\": {\n \"currently_due\": [\n \"business_profile.mcc\",\n \"business_profile.url\",\n \"company.address.city\",\n \"company.address.line1\",\n \"company.address.postal_code\",\n \"company.address.state\",\n \"company.name\",\n \"company.phone\",\n \"company.tax_id\",\n \"relationship.representative\",\n \"relationship.owner\"\n ],\n ...\n },\n ...\n}\n```\n\nThen, use the external account `id` returned in the response to update the\naccount with the additional required information about the account:\n\n```\ncurl https://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"business_profile[mcc]\"=5045 \\\n --data-urlencode \"business_profile[url]\"=\"https://bestcookieco.com\" \\\n -d \"company[address][city]\"=Schenectady \\\n -d \"company[address][line1]\"=\"123 State St\" \\\n -d \"company[address][postal_code]\"=12345 \\\n -d \"company[address][state]\"=NY \\\n -d \"company[tax_id]\"=000000000 \\\n -d \"company[name]\"=\"The Best Cookie Co\" \\\n -d \"company[phone]\"=8888675309\n```\n\nAfter successfully updating the company details, checking\n`requirements.currently_due` shows the `relationship` requirements are still\nrequired:\n\n```\n{\n \"id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"object\": \"account\",\n \"requirements\": {\n \"currently_due\": [\n \"relationship.representative\",\n \"relationship.owner\",\n ],\n ...\n },\n ...\n}\n```\n\nUse the [Persons](https://docs.stripe.com/api/persons) API to create a profile\nfor the person representing the relationship to the account. For this example,\nwe create a profile for Jenny Rosen, and identify her as the `representative`.\nFor this example, we also populate the optional `title` attribute.\n\n```\ncurl https://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}}/persons \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d first_name=Jenny \\\n -d last_name=Rosen \\\n -d \"relationship[representative]\"=true \\\n -d \"relationship[title]\"=CEO\n```\n\n#### Note\n\nFor accounts with\n[business_type](https://docs.stripe.com/api/accounts/object#account_object-business_type)\nset to `individual`, provide at least one `individual` property (for example,\n`individual.first_name`) and a\n[Person](https://docs.stripe.com/api/persons/object) object is created\nautomatically. If you don’t, or for accounts with the `business_type` set to\n`company`, you need to [create each\nPerson](https://docs.stripe.com/api/persons/create) for the account.\n\nWhen you create a `Person`, the response includes a `requirements` hash listing\nthe required verification information for that person.\n\n```\n{\n \"id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"object\": \"account\",\n \"requirements\": {\n \"currently_due\": [\n \"address.city\",\n \"address.line1\",\n \"address.postal_code\",\n \"address.state\",\n \"dob.day\",\n \"dob.month\",\n \"dob.year\",\n \"phone\",\n \"email\",\n \"relationship.executive\",\n \"ssn_last_4\"\n ],\n ...\n },\n ...\n}\n```\n\nAfter you create a `Person` for your external account, checking the `Account`\nobject shows that the required verification information for the newly created\n`Person` has been added to the `requirements.currently_due` list:\n\n```\n{\n \"id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"object\": \"account\",\n \"requirements\": {\n \"currently_due\": [\n \"person.person_xxx.address.city\",\n \"person.person_xxx.address.line1\",\n \"person.person_xxx.address.postal_code\",\n \"person.person_xxx.address.state\",\n \"person.person_xxx.dob.day\",\n \"person.person_xxx.dob.month\",\n \"person.person_xxx.dob.year\",\n \"person.person_xxx.phone\",\n \"person.person_xxx.email\",\n \"person.person_xxx.relationship.executive\",\n \"person.person_xxx.ssn_last_4\",\n \"relationship.owner\"\n ],\n ...\n },\n ...\n}\n```\n\nUse the [Update a Person](https://docs.stripe.com/api/persons/update) API to\nprovide the requested verification information for Jenny Rosen:\n\n```\ncurl\nhttps://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}}/persons/{{PERSON_ID}}\n\\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"address[city]\"=Schenectady \\\n -d \"address[line1]\"=\"123 State St\" \\\n -d \"address[postal_code]\"=12345 \\\n -d \"address[state]\"=NY \\\n -d \"dob[day]\"=10 \\\n -d \"dob[month]\"=11 \\\n -d \"dob[year]\"=1980 \\\n -d ssn_last_4=0000 \\\n -d phone=8888675309 \\\n --data-urlencode email=\"jenny@bestcookieco.com\" \\\n -d \"relationship[executive]\"=true\n```\n\nSetting `relationship[executive]=true` confirms to Stripe that the\nrepresentative is someone with significant control in the organization. [US\nrequired verification\ninformation](https://docs.stripe.com/connect/required-verification-information#additional-company-card-representative-us)\nhas more information about company representative verification details for US\nbusinesses.\n\nAfter providing the `representative` information, we still need to identify the\n`owner` for the account. In this example, Kathleen Banks owns 80% of The Best\nCookie Co.\n\n```\ncurl https://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}}/persons \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d first_name=Kathleen \\\n -d last_name=Banks \\\n --data-urlencode email=\"kathleen@bestcookieco.com\" \\\n -d \"relationship[owner]\"=true \\\n -d \"relationship[percent_ownership]\"=80\n```\n\nIn our example, Kathleen Banks owns less than 100% of The Best Cookie Co. Since\nyou haven’t defined another owner to make the ownership total 100%, Stripe\nrequires you to confirm that you’ve provided information on all required owners.\n\n```\ncurl https://api.stripe.com/v1/accounts/{{CONNECTED_ACCOUNT_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"company[owners_provided]\"=true\n```\n\nSuccessful completion of your connected account at this stage means:\n\n- You’ve completed all required information (`requirements.currently_due=null`).\n- Charges are enabled for the account (`charges_enabled=true`).\n- You received an `account.updated` [webhook](https://docs.stripe.com/webhooks)\nfrom Stripe.\n\n## Testing thresholds\n\nWhether you use upfront onboarding or incremental onboarding, Stripe might\nrequest more information about connected accounts as different thresholds are\nreached. Sometimes these thresholds are triggered by verification failures or\n[OFAC](https://www.treasury.gov/about/organizational-structure/offices/Pages/Office-of-Foreign-Assets-Control.aspx)\nchecks. Other times, they’re triggered by a processing or time component. For\nexample, more information might be required after 1,500 USD in charges or 30\ndays after an account is created (whichever comes first). To find out what\ninformation is required and by when, you can check the\n`requirements.eventually_due` array and the `requirements.current_deadline`\ntimestamp.\n\nIn some cases, if the you don’t collect new information by a certain date,\ncharges and payouts might be disabled until you collect it. You can trigger\nthese scenarios so that you can test these thresholds, and then collect the\nrequired information.\n\n### Triggering thresholds\n\nYou can create a charge with the\n[verification](https://docs.stripe.com/connect/testing#trigger-cards) token\n(`tok_visa_triggerVerification`) to trigger a generic verification threshold.\nThis doesn’t block charges or payouts, but it does trigger the request for\nadditional information. If you’re listening to the `account.updated` webhook,\nyou can check:\n\n- `requirements.currently_due` to find out what information is needed.\n- `requirements.current_deadline` to find out when the information is needed.\n\nIf the information isn’t collected by the `current_deadline`, charges and\npayouts might be disabled. To test scenarios like this, see the blocking\n[charges](https://docs.stripe.com/connect/testing-verification#blocked-charges)\nand\n[payouts](https://docs.stripe.com/connect/testing-verification#blocked-payouts)\nsections below.\n\nYou can also trigger more specific verification thresholds, like when there’s an\n[identity\nmismatch](https://docs.stripe.com/connect/testing#test-personal-id-numbers) or\nwhen an [OFAC threshold](https://docs.stripe.com/connect/testing#test-dobs) is\nreached. Testing these thresholds is beneficial because they often happen when\nverification fails.\n\n### Testing blocked charges\n\nYou can block charges by creating a test charge with the [charge\nblock](https://docs.stripe.com/connect/testing#trigger-cards) token\n(`tok_visa_triggerChargeBlock`). After doing this, you should receive an\n`account.updated` webhook that shows:\n\n- `charges_enabled=false`.\n- The required information in the `requirements.currently_due` array.\n- An empty `requirements.eventually_due` array.\n\nYou can then [update the account](https://docs.stripe.com/api/accounts/update)\nwith the new information. That triggers another webhook, which indicates that\ncharges are enabled and that the `requirements.currently_due` and\n`requirements.eventually_due` arrays are both empty.\n\n### Testing blocked payouts\n\nYou can block payouts by creating a test charge with the [block\ntransfer](https://docs.stripe.com/connect/testing#trigger-cards) token\n(`tok_visa_triggerTransferBlock`). After doing this, you should receive an\n`account.updated` webhook that shows:\n\n- `payouts_enabled=false`.\n- The required information in the `requirements.currently_due` array.\n- An empty `requirements.eventually_due` array.\n\nYou can then [update the account](https://docs.stripe.com/api/accounts/update)\nwith the new information. That triggers another webhook, which indicates that\npayouts are enabled and that the `requirements.currently_due` and\n`requirements.eventually_due` arrays are both empty.\n\n## Links\n\n- [configured with\nproperties](https://docs.stripe.com/connect/update-to-typeless-connect)\n- [API onboarding](https://docs.stripe.com/connect/api-onboarding)\n- [update accounts](https://docs.stripe.com/connect/updating-service-agreements)\n- [identity verification](https://docs.stripe.com/connect/identity-verification)\n- [Stripe’s service\nagreement](https://docs.stripe.com/connect/updating-service-agreements#tos-acceptance)\n- [payouts](https://docs.stripe.com/payouts)\n- [https://bestcookieco.com](https://bestcookieco.com)\n- [Persons](https://docs.stripe.com/api/persons)\n-\n[business_type](https://docs.stripe.com/api/accounts/object#account_object-business_type)\n- [Person](https://docs.stripe.com/api/persons/object)\n- [create each Person](https://docs.stripe.com/api/persons/create)\n- [Update a Person](https://docs.stripe.com/api/persons/update)\n- [US required verification\ninformation](https://docs.stripe.com/connect/required-verification-information#additional-company-card-representative-us)\n- [webhook](https://docs.stripe.com/webhooks)\n-\n[OFAC](https://www.treasury.gov/about/organizational-structure/offices/Pages/Office-of-Foreign-Assets-Control.aspx)\n- [verification](https://docs.stripe.com/connect/testing#trigger-cards)\n- [identity\nmismatch](https://docs.stripe.com/connect/testing#test-personal-id-numbers)\n- [OFAC threshold](https://docs.stripe.com/connect/testing#test-dobs)\n- [update the account](https://docs.stripe.com/api/accounts/update)",
  "metadata": {
    "title": "Testing account verification during API onboarding | Stripe Documentation",
    "description": "A walk-through of testing different verification states for connected accounts during API onboarding using your test API key.",
    "sourceURL": "https://docs.stripe.com/connect/testing-verification"
  }
}