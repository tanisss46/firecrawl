{
  "content": "# Stripe Connector for Salesforce Platform AgnosticInvocable Example\n\nThis guide hands you actionable code examples, showing you step-by-step how to\ncreate Stripe customers and payment intents directly within Salesforce. If\nyou’re a Salesforce administrator, a developer, or simply someone aiming to link\nStripe and Salesforce for smooth data flow and transaction handling, you’ve come\nto the right place.\n\nThe examples here leverage custom Apex classes to enable generic, agnostic calls\nto Stripe’s RESTful API. These examples come in handy if you aim to establish a\nlayer of abstraction between your Salesforce platform and the Stripe API, making\nyour system more flexible and easier to manage.\n\n## Create a Customer in Stripe\n\nThe following code example creates a Stripe\n[Customer](https://docs.stripe.com/api/customers) with a `name`, `email`, and\n`metadata` set.\n\n```\n// Step 1: Create an instance of the stripeGC.RawInvocableParameters class. This\nclass is used to set the parameters for the Stripe API call.\nstripeGC.RawInvocableParameters parameters = new\nstripeGC.RawInvocableParameters();\n\n// Step 2: Set the HTTP method to 'POST' as you are creating a new customer.\nparameters.method = 'POST';\n\n// Step 3: Set the endpoint to '/v1/customers'. This is the Stripe API endpoint\nfor creating a new customer.\nparameters.endpoint = '/v1/customers';\n\n//Step 4: Set the Stripe Account ID from Salesforce and set it to the accountId\nfield of the parameters object.\nparameters.accountId = 'a028B0000029RhlQAE';\n\n//Step 5: Set the request body with the customer details.\nList<String> postCustomerParameters = new List<String>{\n 'email=' + 'customerEmail@example.com',\n 'name=' + 'Tim Smith',\n 'metadata[AccountId]=' + 'abc123'\n};\nparameters.requestBody = String.join(postCustomerParameters, '&');\n\n//Step 6: Add the parameters object to a list and call the callStripeEndpoint\nmethod of the stripeGC.AgnosticInvocable class.\nList<stripeGC.RawInvocableParameters> paramsCollection = new\nList<stripeGC.RawInvocableParameters>{\n parameters\n};\nList<String> results =\nstripeGC.AgnosticInvocable.callStripeEndpoint(paramsCollection);\n\n//Step 7: The callStripeEndpoint method will return a list of strings. If the\ncustomer was created successfully, the first string in the list will be the ID\nof the new customer.\nSystem.debug(results[0]);\n```\n\n### Create a PaymentIntent\n\nThis code example creates a paymentIntent in Stripe.\n\n```\npublic class stripePayment {\n @AuraEnabled(cacheable=true)\npublic static String paymentIntent(String StripeAccountID, String amount, String\nstripecurrency, String orderID, String onBehalfOf, String customerId) {\n // Create Call for invocable\nstripeGC.RawInvocableParameters parameters = new\nstripeGC.RawInvocableParameters();\n // Add HTTP Method\n parameters.method = 'POST';\n\n // Add endpoint\n parameters.endpoint = '/v1/payment_intents';\n\n // Get the Stripe Account ID from Salesforce\n// This assumes you already have the Stripe Account ID and will pass it in as a\nparameter\n// Alternately, you could use a SOQL query to obtain the Stripe Account ID as\nper previous examples\n parameters.accountId = StripeAccountID;\n parameters.connectAccount = onBehalfOf;\n\n // Prepare the request body\n List<String> postPaymentIntentParameters = new List<String>{\n'amount=' + amount, // Pass in the amount to be charged for this payment intent\nin the minimum currency unit (for example, cents for USD)\n'currency=' + stripecurrency, // Pass in the currency for this payment intent\n(for example, 'usd' for USD)\n 'customer=' + customerId, // Pass in customer to payment intent\n'automatic_payment_methods[enabled]=true', //Turning on automatic payment\nmethods\n 'metadata[order_id]=' + orderID\n };\n\n parameters.requestBody = String.join(postPaymentIntentParameters, '&');\n\nList<stripeGC.RawInvocableParameters> paramsCollection = new\nList<stripeGC.RawInvocableParameters>{ parameters };\n\nList<String> results =\nstripeGC.AgnosticInvocable.callStripeEndpoint(paramsCollection);\n\n return (results != null && results.size() > 0) ? results[0] : null;\n }\n}\n```\n\n## See also\n\n- [Installation\nguide](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/installation-guide)\n- [Enablement\nvideos](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/videos)\n- [Configure\nevents](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/configure-events)\n\n## Links\n\n- [Customer](https://docs.stripe.com/api/customers)\n- [Installation\nguide](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/installation-guide)\n- [Enablement\nvideos](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/videos)\n- [Configure\nevents](https://docs.stripe.com/plugins/stripe-connector-for-salesforce/configure-events)",
  "metadata": {
    "title": "Stripe Connector for Salesforce Platform AgnosticInvocable Example | Stripe Documentation",
    "description": "",
    "sourceURL": "https://docs.stripe.com/connectors/stripe-connector-for-salesforce/enablement/code-examples-agnostic"
  }
}