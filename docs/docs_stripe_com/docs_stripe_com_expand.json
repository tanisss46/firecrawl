{
  "content": "# Expanding responses\n\n## Learn how to reduce the number of requests you make to the Stripe API by expanding objects in responses.\n\nThis guide describes how to request additional properties from the API. You will\nlearn to modify your requests to include:\n\n- properties from related objects\n- properties from distantly related objects\n- additional properties on all objects in a list\n- properties that aren’t included by default in a response\n\n## How it works\n\nThe Stripe API is organized into resources represented by objects with state,\nconfiguration, and contextual properties. These objects all have unique IDs that\nyou can use to retrieve, update, and delete them. The API also uses these IDs to\nlink related objects together. A [Checkout\nSession](https://docs.stripe.com/api/checkout/sessions/object), for example,\nlinks to a [Customer](https://docs.stripe.com/api/customers/object) by the\n[Customer\nID](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-customer).\n\n```\n{\n \"id\": \"cs_test_KdjLtDPfAjT1gq374DMZ3rHmZ9OoSlGRhyz8yTypH76KpN4JXkQpD2G0\",\n \"object\": \"checkout.session\",\n ...\n \"customer\": \"cus_HQmikpKnGHkNwW\",\n ...\n}\n```\n\nIn cases where you need information from a linked object, you can retrieve the\nlinked object in a new call using its ID. However, this approach requires two\nAPI requests to access just one value. If you need information from multiple\nlinked objects, each would also require separate requests, which all adds to the\nlatency and complexity of your application.\n\nThe API has an Expand feature that allows you to retrieve linked objects in a\nsingle call, effectively replacing the object ID with all its properties and\nvalues. For example, say you wanted to access details on a customer tied to a\ngiven Checkout Session. You would retrieve the Checkout Session and pass the\n`customer` property to the `expand` array, which tells Stripe to include the\nentire Customer object in the response:\n\n```\ncurl -G https://api.stripe.com/v1/checkout/sessions/{{SESSION_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"expand[]\"=customer\n```\n\nWhich returns the Checkout Session with the full Customer object instead of its\nID:\n\n```\n{\n \"id\": \"cs_test_KdjLtDPfAjT1gq374DMZ3rHmZ9OoSlGRhyz8yTypH76KpN4JXkQpD2G0\",\n \"object\": \"checkout.session\",\n ...\n \"customer\": {\n \"id\": \"cus_HQmikpKnGHkNwW\",\n \"object\": \"customer\",\n ...\n \"metadata\": {\n \"user_id\": \"user_xyz\"\n },\n ...\n }\n}\n```\n\n#### Note\n\nNot all properties can be expanded. The API reference marks expandable\nproperties with the “Expandable” label.\n\n## Expanding multiple properties\n\nTo expand multiple properties in one call, add additional items to the expand\narray. For example, if you want to expand both the\n[customer](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-customer)\nand the\n[payment_intent](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-payment_intent)\nfor a given Checkout Session, you would pass `expand` an array with both the\n`customer` and `payment_intent` strings:\n\n```\ncurl -G https://api.stripe.com/v1/checkout/sessions/{{SESSION_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"expand[]\"=customer \\\n -d \"expand[]\"=payment_intent\n```\n\n## Expanding multiple levels\n\nIf the value you want is nested deeply across multiple linked resources, you can\nreach it by recursively expanding using dot notation. For instance, if you\nneeded to know the type of payment method that was used for a given Checkout\nSession, you would first retrieve the Checkout Session’s payment intent, then\nretrieve the payment intent’s linked payment method to get its type. With\n`expand`, you can do this in one call:\n\n```\ncurl -G https://api.stripe.com/v1/checkout/sessions/{{SESSION_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"expand[]\"=\"payment_intent.payment_method\"\n```\n\nWhich returns the Checkout Session with the full\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/object) and\n[PaymentMethod](https://docs.stripe.com/api/payment_methods/object) objects\ninstead of their IDs:\n\n```\n{\n \"id\": \"cs_test_KdjLtDPfAjT1gq374DMZ3rHmZ9OoSlGRhyz8yTypH76KpN4JXkQpD2G0\",\n \"object\": \"checkout.session\",\n ...\n \"mode\": \"payment\",\n \"payment_intent\": {\n \"id\": \"pi_1GkXXDLHughnNhxyLlsnvUuY\",\n \"object\": \"payment_intent\",\n \"amount\": 100,\n ...\n \"charges\": {...},\n\"client_secret\": \"pi_1GkXXDLHughnNhxyLlsnvUuY_secret_oLbwpm0ME0ieJ9Aykz2SwKzj5\",\n ...\n \"payment_method\": {\n \"id\": \"pm_1GkXXuLHughnNhxy8xpAdGtf\",\n \"object\": \"payment_method\",\n \"billing_details\": {...},\n \"card\": {...},\n```\n\nSee all 49 lines\n#### Note\n\nExpansions have a maximum depth of four levels. Meaning that an `expand` string\ncan contain no more than four properties:\n`property1.property2.property3.property4`.\n\n## Expanding properties in lists\n\nWhen the API returns a list of objects, you can use the `data` keyword to expand\na given property on each object in that list. For example, say you need\ninformation about the payment methods used by one of your customers. To get this\ninformation, you would [list the customer’s\nPaymentIntents](https://docs.stripe.com/api/payment_intents/list#list_payment_intents-customer),\nwhich returns an object with the following structure:\n\n```\n{\n \"object\": \"list\",\n \"data\": [\n {\n \"id\": \"pi_1GrvBKLHughnNhxy6N28q8gt\",\n \"object\": \"payment_intent\",\n \"amount\": 1000,\n ...\n \"payment_method\": \"pm_1GrvBxLHughnNhxyJjtBtHcc\",\n ...\n },\n```\n\nSee all 23 lines\n#### Note\n\nAll lists returned in the API have the above structure, where the `data`\nproperty contains the array of objects being listed. You can use the `data`\nkeyword in any position in an expand string to move the expand cursor into the\nlist.\n\nRather than looping through each payment intent in the list and retrieving the\nlinked payment methods in separate calls, you can expand all the payment methods\nat once using the `data` keyword:\n\n```\ncurl -G https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d customer={{CUSTOMER_ID}} \\\n -d \"expand[]\"=\"data.payment_method\"\n```\n\nThe list then includes the full payment method object on each payment intent:\n\n```\n{\n \"object\": \"list\",\n \"data\": [\n {\n \"id\": \"pi_1GrvBKLHughnNhxy6N28q8gt\",\n \"object\": \"payment_intent\",\n \"amount\": 1000,\n ...\n \"payment_method\": {\n \"id\": \"pm_1GrvBxLHughnNhxyJjtBtHcc\",\n \"object\": \"payment_method\",\n \"billing_details\": {...},\n \"card\": {\n \"brand\": \"visa\",\n ...\n```\n\nSee all 65 lines\n#### Note\n\nExpanding responses has performance implications. To keep requests fast, try to\nlimit many nested expansions on list requests.\n\n## Using expansion to request includable properties\n\nIn some cases, resources have properties that aren’t included by default. One\nexample is the Checkout Session’s\n[line_items](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-line_items)\nproperty, which is only included in responses if requested using the `expand`\nparameter, for example:\n\n```\ncurl -G https://api.stripe.com/v1/checkout/sessions/{{SESSION_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"expand[]\"=line_items\n```\n\n#### Note\n\nLike other expandable properties, the API reference marks properties that are\nincludable with the “Expandable” label.\n\n## Using expansion with webhooks\n\nYou can’t receive [webhook](https://docs.stripe.com/webhooks) events with\nproperties auto-expanded. Objects sent in events are always in their minimal\nform. To access nested values in expandable properties, you must retrieve the\nobject in a separate call within your webhook handler.\n\n## Links\n\n- [Checkout Session](https://docs.stripe.com/api/checkout/sessions/object)\n- [Customer](https://docs.stripe.com/api/customers/object)\n- [Customer\nID](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-customer)\n-\n[payment_intent](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-payment_intent)\n- [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\n- [PaymentMethod](https://docs.stripe.com/api/payment_methods/object)\n- [list the customer’s\nPaymentIntents](https://docs.stripe.com/api/payment_intents/list#list_payment_intents-customer)\n-\n[line_items](https://docs.stripe.com/api/checkout/sessions/object#checkout_session_object-line_items)\n- [webhook](https://docs.stripe.com/webhooks)",
  "metadata": {
    "title": "Expanding responses | Stripe Documentation",
    "description": "Learn how to reduce the number of requests you make to the Stripe API by expanding objects in responses.",
    "sourceURL": "https://docs.stripe.com/expand"
  }
}