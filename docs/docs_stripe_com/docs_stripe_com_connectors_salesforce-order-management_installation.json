{
  "content": "# Install the Stripe Connector for Salesforce Order Management\n\n## Set up and configure the Stripe Connector.\n\n## Before installing the Salesforce Order Management Connector\n\n- Identify the organization and B2C Commerce store in your Salesforce instance\nwhere you want to install and map the connector.\n- Review the entitlements and\n[prerequisites](https://docs.stripe.com/connectors/salesforce-order-management)\nbefore starting the installation process.\n- Note the integration limitations:- Supports only a single B2C storefront\n- Supports one time manual capture only\n- Doesn’t support complex scenarios like over-capture and multi-capture\n\n## Installation\n\nTo learn more about integrating with Salesforce Order Management, contact\n[Stripe support](https://support.stripe.com/).\n\nMake sure **Install for Admins Only** is selected, then click **Install**.\n\n!\n\nApprove access to and from third-party websites. Check the grant access checkbox\nand click **Continue**.\n\n!\n\nIf the installation takes time, you will receive an email telling you the\npackage is installed.\n\nTo verify, navigate to **Setup > Apps > Packaging > Installed Packages** and\nmake sure the package is installed.\n\n## Configuration\n\nInstructions in the following sections detail how to configure your integration.\n\n### Configure a Stripe Synchronous Payment Gateway Adapter\n\n- Follow the instructions in step 3 of [Set Up a Synchronous Payment Gateway\nAdapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_sync_adapter_setup.htm)\nto create a payment gateway provider. Here’s the set of values we recommend for\nthe payload:\n\n```\n{\n\"ApexAdapterId\": \"Output of this Query: SELECT Id FROM ApexClass WHERE Name IN\n('StripeAdapter')\",\n\"DeveloperName\": \"StripeProvider\",\n\"MasterLabel\": \" StripeProvider\",\n\"IdempotencySupported\": \"No\",\n\"Comments\": \"Stripe Synchronous Payment Gateway Adapter\"\n}\n```\n- Follow the instructions in step 4 of [Set Up a Synchronous Payment Gateway\nAdapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_sync_adapter_setup.htm)\nto create a payment gateway record.\n\nRecommended values:\n\nField LabelValueNameSALESFORCE_PAYMENTSMerchant Credential IDOutput of this\nquery: `SELECT Id FROM NamedCredential WHERE DeveloperName = 'StripeAPI'\n`Payment Gateway ProviderOutput of the query (modify the query accordingly if\nyour Stripe Synchronous Payment Gateway Provider is different than\n‘StripeProvider’): `SELECT Id FROM PaymentGatewayProvider WHERE DeveloperName\n='StripeProvider'`StatusActive\n\n### Configure a Stripe Asynchronous Payment Gateway Adapter\n\n- Follow the instructions in [Set Up an Asynchronous Payment Gateway Adapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_async_adapter_setup.htm)\nto configure the Stripe Asynchronous Payment Gateway Adapter (skip step 2 and 3\nif you’ve already executed the same for the Stripe Synchronous Payment Gateway\nAdapter). To create an asynchronous Payment Gateway Provider (follow step 4 from\nthe previously linked instruction). Here is the recommended set of values for\nthe payload:\n\n```\n{\n\"ApexAdapterId\": \"Output of this Query: SELECT Id FROM ApexClass WHERE Name IN\n(‘StripeAsyncAdapter’)\",\n \"DeveloperName\": \"StripeAsyncAdapter\",\n \"MasterLabel\": \" StripeAsyncAdapterProvider \",\n \"IdempotencySupported\": \"No\",\n \"Comments\": \"Stripe Asynchronous Payment Gateway Adapter\"\n }\n```\n- Follow the instruction from step 5 (Create a payment gateway record) in [Set\nUp an Asynchronous Payment Gateway Adapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_async_adapter_setup.htm)\nto register the Stripe Asynchronous Payment Gateway record in Salesforce.\n\nHere are the recommended values for the fields to be inserted (if you’re\ncreating a gateway record for the first time) or updated (if you have already\ncreated a gateway record while setting up the synchronous payment gateway\nadapter)\n\nField LabelValueNameSALESFORCE_PAYMENTSMerchant Credential IDOutput of this\nquery: `SELECT Id FROM NamedCredential WHERE DeveloperName = 'StripeAPI'\n`Payment Gateway ProviderOutput of the query (modify the query accordingly if\nyour Stripe Synchronous Payment Gateway Provider is different than\n‘StripeProvider’): `SELECT Id FROM PaymentGatewayProvider WHERE DeveloperName\n='StripeAsyncAdapter'.`StatusActive\n- Follow the instructions in step 6 to configure the webhook URL for Stripe. The\ntypical format of the webhook URL is a publicly accessible, HTTPS URL. For\nexample:\nhttps://mydomainname.my.salesforce-sites.com/subdomain/services/data/v[Replace_ME_version]/commerce/payments/notify%20?provider=<ID>\n\n```\nSELECT Id FROM PaymentGatewayProvider WHERE DeveloperName = ‘StripeAsyncAdapter’\n```\n\n[Replace_ME_version] with the API version of your org 49.0 and later\n- Follow these steps to register your webhooks URL in Stripe:\n\n- Log in to the [Stripe Dashboard](https://dashboard.stripe.com/dashboard).\n- Go to the [Webhooks](https://dashboard.stripe.com/webhooks) tab in Workbench.\n- Click **Create new endpoint**.\n- Add the following event types: `charge.refunded`, `charge.succeeded`,\n`charge.captured`, then click **Continue**.\n- Enter your webhooks URL, then click **Create destination**.\n- your webhook signing secret and save it for later use.\n\n!\n\n## Complete the configurations using Stripe OM Setup\n\nInstructions in the following sections detail how to complete the configuration\nof your integration.\n\n### Authorize the Stripe OMS Connector with your Stripe Account\n\nIn your Salesforce Order Management org, go through the Stripe Setup Assistant\nto connect your org to your Stripe account.\n\n- Click the App Launcher, then click **View All**.\n\n!\n- Click **Stripe OM Setup**.\n\n!\n- Click **Get Started**.\n- Toggle live mode. We recommend leaving live mode disabled to test your Stripe\nintegration without affecting your live data, and activating live mode when\nyou’re ready to start processing real transactions with the Stripe Payment\nGateway. Come back to this step and reauthorize your connection to switch\nbetween test mode and live mode. If you’re in live mode and you want to switch\nback to test mode, you don’t need to re-authorize.\n- Click **Authorize**.\n\n!\n\nThis allows Salesforce to access your Stripe data so you can capture and refund\npayments. The Stripe website opens to complete the authorization process, which\nmight require you to enter login information or activate your Stripe account.\nWhen done, you’re redirected to this page to finish the setup process. After\nauthorization is complete and successful, the following message displays:\n\n!\n\nStore the webhook signing secret for Stripe asynchronous payment processing.\n\n!\n\n- Add the webhook signing secret value in **Signing secret**.\n- Click **Update**.\n- A message appears on top to confirm successful insertion. Click **Finish**.\n\n### Modify existing order management flows\n\nThe authentication with Stripe is using OAuth, where Stripe is the OAuth\nprovider. Salesforce doesn’t support Stripe as an OAuth provider, therefore the\nOAuth token is obtained using a custom integration, leveraging an invocable\naction **getAccesToken**. This is packaged as part of the Stripe OM Connector\nManaged Package.\n\nIdentify the flow that initiates the payment or refund to Stripe and include the\n**getAccessToken** invocable method in an action just before the **Ensure\nFunds** action in the flow (as shown in the following example). The flows that\nyou need to modify varies from the one shown in the following example.\n\n- Navigate to **Setup > Process Automation > Flows**.\n- Select the active **Flow** to use to capture funds.\n- Create a new **Action** that calls the `getAccessToken` invocable method.\n\n!\n\n- Make sure that the **Get Access Token** action occurs before the **Capture\nFunds** action. After it completes, save a new version of this **Flow** to make\nsure that your processes use the new version.\n\n!\n\n- You can now use Stripe Payment as a payment method in your Order Management\norg. You can now place orders from Salesforce B2C Commerce Cloud and complete\ntransactions, such as capture and refund transactions for payment methods that\nare associated with Salesforce commerce payments.\n\n## Next steps\n\n- [Operations and\nMaintenance](https://docs.stripe.com/connectors/salesforce-order-management/operations-and-maintenance)\n-\n[Testing](https://docs.stripe.com/connectors/salesforce-order-management/testing)\n\n## Links\n\n-\n[prerequisites](https://docs.stripe.com/connectors/salesforce-order-management)\n- [Stripe support](https://support.stripe.com/)\n- [Set Up a Synchronous Payment Gateway Adapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_sync_adapter_setup.htm)\n- [Set Up an Asynchronous Payment Gateway Adapter in\nSalesforce](https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_commercepayments_async_adapter_setup.htm)\n- [Stripe Dashboard](https://dashboard.stripe.com/dashboard)\n- [Webhooks](https://dashboard.stripe.com/webhooks)\n- [Operations and\nMaintenance](https://docs.stripe.com/connectors/salesforce-order-management/operations-and-maintenance)\n-\n[Testing](https://docs.stripe.com/connectors/salesforce-order-management/testing)",
  "metadata": {
    "title": "Install the Stripe Connector for Salesforce Order Management | Stripe Documentation",
    "description": "Set up and configure the Stripe Connector.",
    "sourceURL": "https://docs.stripe.com/connectors/salesforce-order-management/installation"
  }
}