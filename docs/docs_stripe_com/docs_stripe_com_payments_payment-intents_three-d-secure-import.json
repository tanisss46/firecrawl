{
  "content": "# Import 3D Secure results\n\n## Process payments when 3D Secure runs outside of Stripe.\n\nImporting 3DS results is an advanced payment flow that allows you to incorporate\nyour external 3DS authentication into your Stripe payment by importing the\nauthentication result. You need to import 3DS results if you:\n\n- Are in the travel industry and receive card numbers and cryptograms from a\ntravel aggregator, such as Expedia or Sabre\n- Use a third-party provider to perform 3DS\n\nIn these situations, you can pass the card details and cryptogram directly to\nthe Payment Intents API instead of using Stripe Elements to collect payment\ndetails and run 3DS.\n\nImporting 3DS results is available in the following countries:\n\nAustraliaCanadaEUHong KongMexicoNew ZealandSingaporeSwitzerlandUnited\nKingdomUnited States\nBeta All other countries in which Stripe supports card payments.\n\nImporting 3DS results isn’t available in the following countries:\n\nIndiaMalaysiaThailand\n#### Warning\n\nIn all the following code samples, the parameters set in the `three_d_secure`\nobject must identically match the values returned by your 3DS provider.\n\n## Process a payment with card details\n\nIf you handle card details on your server:\n\n- Create and confirm a PaymentIntent with the card details and 3DS details in\none API call.\n- When creating the PaymentIntent, set\n[confirm](https://docs.stripe.com/api/setup_intents/create#create_setup_intent-confirm)\nto `true`.\n- Set\n[error_on_requires_action](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-error_on_requires_action)\nto `true` when you confirm the PaymentIntent to prevent Stripe from performing a\n3DS request during a soft decline.\n\n```\ncurl https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d amount=2000 \\\n -d currency=eur \\\n -d \"payment_method_types[]\"=card \\\n -d \"payment_method_data[type]\"=card \\\n -d \"payment_method_data[card][number]\"=4000002760003184 \\\n -d \"payment_method_data[card][exp_month]\"=12 \\\n -d \"payment_method_data[card][exp_year]\"=23 \\\n -d \"payment_method_data[card][cvc]\"=123 \\\n -d \"payment_method_options[card][three_d_secure][version]\"=\"2.1.0\" \\\n-d\n\"payment_method_options[card][three_d_secure][electronic_commerce_indicator]\"=05\n\\\n--data-urlencode\n\"payment_method_options[card][three_d_secure][cryptogram]\"=\"CJSJbzXT6TRQlvZDX+ZdOG4QriE=\"\n\\\n-d\n\"payment_method_options[card][three_d_secure][transaction_id]\"=aaa65c7b-b0fc-4e71-bd6c-29c87acad489\n\\\n -d confirm=true \\\n -d error_on_requires_action=true\n```\n\n## Process a payment with a PaymentMethod\n\nIf you tokenize card details with the [Payment Methods\nAPI](https://docs.stripe.com/api/payment_methods):\n\n- Create and confirm a PaymentIntent with the PaymentMethod ID and 3DS details\nin one API call.\n- When creating the PaymentIntent, set\n[confirm](https://docs.stripe.com/api/setup_intents/create#create_setup_intent-confirm)\nto `true`.\n- Set\n[error_on_requires_action](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-error_on_requires_action)\nto `true` when you confirm the PaymentIntent to prevent Stripe from performing a\n3DS request during a soft decline.\n\n```\ncurl https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d amount=2000 \\\n -d currency=eur \\\n -d \"payment_method_types[]\"=card \\\n -d customer={{CUSTOMER_ID}} \\\n -d payment_method={{PAYMENT_METHOD_ID}} \\\n -d \"payment_method_options[card][three_d_secure][version]\"=\"2.2.0\" \\\n-d\n\"payment_method_options[card][three_d_secure][electronic_commerce_indicator]\"=02\n\\\n--data-urlencode\n\"payment_method_options[card][three_d_secure][cryptogram]\"=\"M6+990I6FLD8Y6rZz9d5QbfrMNY=\"\n\\\n-d\n\"payment_method_options[card][three_d_secure][transaction_id]\"=f879ea1c-aa2c-4441-806d-e30406466d79\n\\\n -d confirm=true \\\n -d error_on_requires_action=true\n```\n\n#### Caution\n\nIf you intend to process a payment with a PaymentMethod shortly after tokenizing\nthe card details, use raw card data instead.\n\n## Set up future payments\n\nThe 3DS protocol supports two message categories:\n\n- **Payment Authentication**: used for authenticating cardholders during\ntransactions.\n- **Non-Payment Authentication**: used for identity verification and account\nconfirmation.\n\nIf you want to onboard customers for future payments, include the non-payment\nauthentication cryptogram and either the card details or PaymentMethod ID when\ncreating and confirming a\n[SetupIntent](https://docs.stripe.com/api/setup_intents).\n\n```\ncurl https://api.stripe.com/v1/setup_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"payment_method_types[]\"=card \\\n -d customer={{CUSTOMER_ID}} \\\n -d payment_method={{PAYMENT_METHOD_ID}} \\\n -d \"payment_method_options[card][three_d_secure][version]\"=\"2.2.0\" \\\n-d\n\"payment_method_options[card][three_d_secure][electronic_commerce_indicator]\"=05\n\\\n--data-urlencode\n\"payment_method_options[card][three_d_secure][cryptogram]\"=4BQwsg4yuKt0S1LI1nDZTcO9vUM=\n\\\n-d\n\"payment_method_options[card][three_d_secure][transaction_id]\"=f879ea1c-aa2c-4441-806d-e30406466d79\n\\\n -d confirm=true \\\n -d \"expand[]\"=latest_attempt\n```\n\n## Import 3DS exempted outcomes\n\nIf you obtain a 3DS result outside of Stripe that contains a ‘low-risk’\n[SCA](https://docs.stripe.com/strong-customer-authentication) exemption, you can\nflag the exemption-based nature of the 3DS result to Stripe by using the\n[exemption_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-exemption_indicator)\nparameter.\n\nIf Stripe’s real-time transaction risk analysis determines that it’s\nappropriate, Stripe requests the [low-risk\nexemption](https://stripe.com/guides/strong-customer-authentication#low-risk-transactions)\nfrom the issuer and communicates this action to you by returning\n[exemption_indicator_applied](https://docs.stripe.com/api/charges/object#charge_object-payment_method_details-card-three_d_secure-exemption_indicator_applied)\nin to the authorization request response.\n\n```\ncurl https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d amount=2000 \\\n -d currency=eur \\\n -d \"payment_method_types[]\"=card \\\n -d payment_method={{PAYMENT_METHOD_ID}} \\\n -d \"payment_method_options[card][three_d_secure][version]\"=\"2.2.0\" \\\n-d\n\"payment_method_options[card][three_d_secure][electronic_commerce_indicator]\"=07\n\\\n--data-urlencode\n\"payment_method_options[card][three_d_secure][cryptogram]\"=\"CJSJbzXT6TRQlvZDX+ZdOG4QriE=\"\n\\\n-d\n\"payment_method_options[card][three_d_secure][transaction_id]\"=aaa65c7b-b0fc-4e71-bd6c-29c87acad489\n\\\n-d \"payment_method_options[card][three_d_secure][exemption_indicator]\"=low_risk\n\\\n -d confirm=true \\\n -d error_on_requires_action=true \\\n -d \"expand[]\"=latest_charge\n```\n\nTo see whether Stripe requested the low-risk exemption,\n[expand](https://docs.stripe.com/api/expanding_objects) the `latest_charge` and\ninspect the\n[three_d_secure](https://docs.stripe.com/api/charges/object#charge_object-payment_method_details-card-three_d_secure)\nattribute.\n\n```\n{\n \"id\": \"pi_3aTnU0Aif3fLhNTb0le1BSXI\",\n \"object\": \"payment_intent\",\n // ...\n \"latest_charge\": {\n \"id\": \"ch_3aTnU1AifffLhNTb0tUoEZcd\",\n \"object\": \"charge\",\n // ...\n \"payment_method_details\": {\n \"card\": {\n```\n\nSee all 29 lines\n## Importing Cartes Bancaires outcomes\n\nTo use 3DS import for transactions that process on the Cartes Bancaires network,\nyou need to explicitly pass the authenticated network in your request using the\n[network](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-network)\nparameter.\n\nTo import Cartes Bancaires cryptograms, you also need additional data from your\nexternal 3DS server. The table below specifies the details of these additional\nrequired and recommended fields. These recommendations apply when you import 3DS\noutcomes using both PaymentIntents and SetupIntents.\n\nFieldDescriptionOptionality[electronic_commerce_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-electronic_commerce_indicator)The\nElectronic Commerce Indicator (ECI) is returned by your 3DS provider and\nindicates what degree of authentication was performed.Optional. Include this if\nit’s available.\n\n[cb_avalgo](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_avalgo)\n\nThe cryptogram calculation algorithm used by the card Issuer’s ACS to calculate\nthe Authentication cryptogram. Also known as cavvAlgorithm.\n\nARes/RReq messageExtension: `CB-AVALGO`\n\nRequired.\n\n[cb_exemption](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_exemption)\n\nThe exemption indicator returned from Cartes Bancaires in the ARes. This is a 3\nbyte bitmap (lowest significant byte first and most significant bit first) that\nhas been Base64 encoded. String (4 characters).\n\nARes message extension: `CB-EXEMPTION`\n\nOptional. Include this if it’s available.\n\n[cb_score](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_score)\n\nThe risk score returned from Cartes Bancaires in the ARes. Numeric value 0-99.\n\nARes/RReq message extension: `CB-SCORE`\n\nOptional. Include this if it’s available.\n\n[ares_trans_status](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-ares_trans_status)\n\nThe `transStatus` returned from the card Issuer’s ACS in the ARes.\n\nOptional. Include this if it’s available.\n\n[requestor_challenge_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-requestor_challenge_indicator)The\nchallenge indicator (`threeDSRequestorChallengeInd`) which was requested in the\nAReq sent to the card Issuer’s ACS. A string containing 2 digits from\n01-99.Optional. Include this if it’s available.\nProvide as many of these additional fields as possible to increase the chances\nof a successful authorization.\n\n```\ncurl https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d amount=2000 \\\n -d currency=eur \\\n -d \"payment_method_types[]\"=card \\\n -d payment_method={{PAYMENT_METHOD_ID}} \\\n -d \"payment_method_options[card][network]\"=cartes_bancaires \\\n -d \"payment_method_options[card][three_d_secure][version]\"=\"2.2.0\" \\\n-d\n\"payment_method_options[card][three_d_secure][electronic_commerce_indicator]\"=05\n\\\n--data-urlencode\n\"payment_method_options[card][three_d_secure][cryptogram]\"=\"CJSJbzXT6TRQlvZDX+ZdOG4QriE=\"\n\\\n-d\n\"payment_method_options[card][three_d_secure][transaction_id]\"=aaa65c7b-b0fc-4e71-bd6c-29c87acad489\n\\\n-d\n\"payment_method_options[card][three_d_secure][requestor_challenge_indicator]\"=02\n\\\n -d \"payment_method_options[card][three_d_secure][ares_trans_status]\"=Y \\\n-d\n\"payment_method_options[card][three_d_secure][network_options][cartes_bancaires][cb_avalgo]\"=1\n\\\n-d\n\"payment_method_options[card][three_d_secure][network_options][cartes_bancaires][cb_score]\"=9\n\\\n-d\n\"payment_method_options[card][three_d_secure][network_options][cartes_bancaires][cb_exemption]\"=BAAA\n\\\n -d confirm=true \\\n -d error_on_requires_action=true\n```\n\n### Exemptions with Cartes Bancaires\n\nIf you have been granted an\n[SCA](https://docs.stripe.com/strong-customer-authentication) exemption over\n3DS, you must submit either the `cb_exemption` parameter, the\n`exemption_indicator` parameter, or both. If either of these parameters\nindicates that the exemption is low risk due to acquirer transaction risk\nanalysis, Stripe reassesses the transaction, as described in [Import 3DS\nexempted\noutcomes](https://docs.stripe.com/payments/payment-intents/three-d-secure-import#import-exempted-outcomes).\n\n- If you have access to `cb_exemption`, pass that value and don’t populate\n`exemption_indicator`. Stripe infers the appropriate exemption indicator based\non `cb_exemption`.\n- If you pass both the `cb_exemption` parameter and `exemption_indicator`\nparameter, make sure that they both correctly indicate the exempted status.\n- If there’s a mismatch where `exemption_indicator=none` and the bitmap in\n`cb_exemption` indicates that the applied exemption is a low risk exemption,\nStripe rejects the request.\n\n## Testing\n\nYou can validate your integration in a sandbox using either the authentication\nrequired test card: `4000 0027 6000 3184` or `pm_card_authenticationRequired`.\n\nThe simulation accepts any correctly-formatted 3DS result. For example:\n\n- Version: `2.1.0`\n- Electronic Commerce Indicator: `02`\n- Cryptogram: `M6+990I6FLD8Y6rZz9d5QbfrMNY=`\n- Transaction ID: `5f5d08f2-8c36-4f72-99d1-57b4fb70b7d5`\n\nOr:\n\n- Version: `2.2.0`\n- Electronic Commerce Indicator: `05`\n- Cryptogram: `4BQwsg4yuKt0S1LI1nDZTcO9vUM=`\n- Transaction ID: `f879ea1c-aa2c-4441-806d-e30406466d79`\n\n### Exemptions granted through 3DS\n\nIn a testing environment, all cards that include `exemption_indicator` return\n`exemption_indicator_applied` as true. To test a PaymentIntent creation that\ndoesn’t pass the internal TRA check, and that returns false, use card number\n`4000 0000 0001 6123` and set `exemption_indicator=low_risk`.\n\n### Cartes Bancaires\n\nYou can use the following co-badged cards to test importing Cartes Bancaires\noutcomes:\n\nCard numbersTokensPaymentMethodsNumberBrandCVCDate4000002500001001Cartes\nBancaires / VisaAny 3 digitsAny future date5555552500001001Cartes Bancaires /\nMastercardAny 3 digitsAny future date4000000000016123Cartes Bancaires / VisaAny\n3 digitsAny future date\nYou can use any valid `cb_exemption` value in your tests. For example:\n\n- `AAAA` - No exemption granted\n- `BAAA` - Low risk exemption granted\n\nLike [the standard exemptions\nflow](https://docs.stripe.com/payments/payment-intents/three-d-secure-import#exemptions-granted-through-3ds),\nwhen the value of `cb_exemption` corresponds to low risk, only the test card\n`4000 0000 0001 6123` returns false for\n[exemption_indicator_applied](https://docs.stripe.com/api/charges/object#charge_object-payment_method_details-card-three_d_secure-exemption_indicator_applied).\n\n## Raw PAN usage\n\nStripe requires users to validate that cardholder data is handled securely and\nin compliance with the Payment Card Industry Data Security Standard (PCI DSS)\nbefore granting access to raw card data APIs.\n\nFor businesses that require this functionality, Stripe imposes strict\nrequirements, including:\n\n- Validation of PCI DSS compliance\n- Submission to the Stripe review process\n- Agreement to maintain additional controls on top of Stripe’s default security\nsettings\n\nSee [Enabling access to raw card data\nAPIs](https://support.stripe.com/questions/enabling-access-to-raw-card-data-apis)\nsupport article for enablement details.\n\n#### Note\n\nFor accounts with custom pricing, if you specify Stripe as your acquirer in the\n3D Secure request, Stripe passes network costs applicable to 3DS through, per\nyour agreement with Stripe.\n\n## See also\n\n- [3D Secure options on\nPaymentIntents](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure)\n\n## Links\n\n-\n[confirm](https://docs.stripe.com/api/setup_intents/create#create_setup_intent-confirm)\n-\n[error_on_requires_action](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-error_on_requires_action)\n- [Payment Methods API](https://docs.stripe.com/api/payment_methods)\n- [SetupIntent](https://docs.stripe.com/api/setup_intents)\n- [SCA](https://docs.stripe.com/strong-customer-authentication)\n-\n[exemption_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-exemption_indicator)\n- [low-risk\nexemption](https://stripe.com/guides/strong-customer-authentication#low-risk-transactions)\n-\n[exemption_indicator_applied](https://docs.stripe.com/api/charges/object#charge_object-payment_method_details-card-three_d_secure-exemption_indicator_applied)\n- [expand](https://docs.stripe.com/api/expanding_objects)\n-\n[three_d_secure](https://docs.stripe.com/api/charges/object#charge_object-payment_method_details-card-three_d_secure)\n-\n[network](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-network)\n-\n[electronic_commerce_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-electronic_commerce_indicator)\n-\n[cb_avalgo](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_avalgo)\n-\n[cb_exemption](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_exemption)\n-\n[cb_score](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-network_options-cartes_bancaires-cb_score)\n-\n[ares_trans_status](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-ares_trans_status)\n-\n[requestor_challenge_indicator](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure-requestor_challenge_indicator)\n- [Enabling access to raw card data\nAPIs](https://support.stripe.com/questions/enabling-access-to-raw-card-data-apis)\n- [3D Secure options on\nPaymentIntents](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-payment_method_options-card-three_d_secure)",
  "metadata": {
    "title": "Import 3D Secure results | Stripe Documentation",
    "description": "Process payments when 3D Secure runs outside of Stripe.",
    "sourceURL": "https://docs.stripe.com/payments/payment-intents/three-d-secure-import"
  }
}