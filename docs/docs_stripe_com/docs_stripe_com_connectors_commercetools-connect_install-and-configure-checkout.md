# Install and configure the Stripe Payment Connector for Commercetools Checkout

## Learn how to set up your Commercetools merchant center to install the checkout connector.

Integrate Stripe payments with the Commercetools Checkout, which provides a
pre-built checkout experience for secure payments.

!

Checkout Connector listing in Commercetools Merchant Center

## Before you begin

Before you install the Stripe Payment Connector:

- Provide your Stripe account details to establish connectivity.
- Identify the organization and project in your Commercetools instance where you
want to install the connector.
- Enable Commercetools Checkout in the composable commerce project.
- Prepare to install and configure the connector directly from your
Commercetools instance.

## Install the connector

- From the Connect marketplace in your Commercetools instance, select **Stripe
Payment for Checkout**.
- On the Commercetools configuration page, select the region, organization, and
projects in which to install the connector.
- Next, provide your environment variables and configuration details.
- On the Commercetools Checkout configuration page, click **Add Payments** to
enable payment methods.
- On the **Add payments** page, do the following:- For **Payment connector**,
select **Stripe Payment for Checkout**.
- For **Drop-in payment integration name**, enter the integration name to
display.
- For **Payment integration key**, enter a key between 2 and 256 alphanumeric
characters, underscores, and hyphens.
- Toggle the status to enable it.

## Configure the Stripe Payment Connector

Use the following installation variables to configure the connector.

VariableDescription`CTP_API_URL`The URL for the Commercetools composable
commerce API. The default value is
`https://api.europe-west1.gcp.commercetools.com`.`CTP_AUTH_URL`The URL for
authentication in the Commercetools platform that’s used to generate an OAuth
2.0 token. Every API call to the Commercetools composable commerce requires an
OAuth 2.0 token. The default value is
`https://auth.europewest1.gcp.commercetools.com`.`CTP_CLIENT_ID`The client ID of
the Commercetools composable commerce user account. The Commercetools client
uses the client ID to communicate with the Commercetools composable commerce
through the SDK.`CTP_CLIENT_SECRET`The client secret of the Commercetools
composable commerce user account. The Commercetools client uses the client
secret to communicate with the Commercetools composable commerce through the
SDK.`CTP_JWKS_URL`The URL that provides the JSON Web Key Set.`CTP_JWT_ISSUER`The
issuer in the JSON Web Token that’s required for the JWT validation
process.`CTP_PROJECT_KEY`The key for the Commercetools composable commerce
project.`CTP_SCOPE`The scope defines which endpoints the Commercetools client
can access and has read and write access to.`CTP_SESSION_URL`The URL for session
creation in the Commercetools platform. Connectors rely on the created session
to share information between the enabler and the processor. The default value is
`https://session.europewest1.gcp.commercetools.com`.`STRIPE_APPEARANCE_EXPRESS_CHECKOUT`[Stripe
Elements](https://docs.stripe.com/payments/elements) supports visual
customization, allowing you to use the appearance option to match the design of
your site. This value defines the appearance of the Express Checkout
Element.`STRIPE_APPEARANCE_PAYMENT_ELEMENT`Stripe Elements supports visual
customization, allowing you to use the appearance option to match the design of
your site. This value defines the appearance of the Payment
Element.`STRIPE_CAPTURE_METHOD`The Stripe capture method (manual or automatic).
The default value is `automatic`.`STRIPE_SECRET_KEY`Stripe authenticates API
requests using your account’s API keys. We recommend creating a [restricted
access key](https://docs.stripe.com/keys), instead of using the default secret
API key.`STRIPE_WEBHOOK_ID`The Stripe unique identifier for webhook
endpoints.`STRIPE_WEBHOOK_SIGNING_SECRET`The Stripe secret key that’s used with
official libraries to verify webhook signatures. This key is created in the
Stripe Dashboard.
## General settings

You can modify the capture mode (manual or automatic) of components generated by
the Payment Connector Enabler in the connector configuration. The enabler
manages the payment components connected to the Payment Connector Processor. The
processor creates the Payment Intent in Stripe with the respective metadata, and
converts webhook events into payment transactions in commercetools.

You can modify the appearance of the Stripe Payment Element and Express Checkout
Element from the Stripe Payment Connector configuration.

## Webhooks

Stripe uses [webhooks](https://docs.stripe.com/webhooks) to notify your
application when an event occurs in your account. Webhooks are useful for
updating payment transactions when a customer’s bank confirms or declines a
payment, or when the payment is canceled or refunded.

Stripe supports the following webhooks:

Event TypeDescription`charge.refunded`If `charge.captured` is true, add a
`Refund:Success` transaction to the payment in
Commercetools.`charge.succeeded`If the payment hasn’t been captured, create a
payment in Commercetools. If the payment was made, add an
`Authorization:Success` transaction to the payment in
Commercetools.`payment_intent.canceled`Add a `CancelAuthorization:Success`
transaction to the payment in Commercetools.`payment_intent.payment_failed`Logs
the information in the processor logs in the connector
app.`payment_intent.requires_action`Logs the information in the processor logs
in the connector app.`payment_intent.succeeded`You can handle this event using
one of the following capture methods:- Automatic: If
`paymentIntent.capture_method` is automatic, create a payment in Commercetools,
and add a `Charge:Success` transaction to it.
- Manual: If `paymentIntent.capture_method` is manual, add a `Charge:Success`
transaction to the payment in Commercetools.

## Changelog and accessing code

You can monitor changes and upgrades to the connector from the [Github
repo](https://github.com/stripe/stripe-commercetools-checkout-app).

## Links

- [Stripe Elements](https://docs.stripe.com/payments/elements)
- [restricted access key](https://docs.stripe.com/keys)
- [webhooks](https://docs.stripe.com/webhooks)
- [Github repo](https://github.com/stripe/stripe-commercetools-checkout-app)