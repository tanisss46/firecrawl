{
  "content": "# Calculate tax in your custom payment flowsPrivate preview\n\n## Learn how to integrate taxes with the Stripe Tax and Payment Intents APIs.\n\nThe Stripe Tax API enables you to calculate tax in your custom payment flows. If\nyou use the Payment Intents API, Stripe can submit tax transactions in the\npayment lifecycle.\n\nClient\n\nServer\n\nStripe\n\nCalculate tax with API\n\nTotal amount and tax breakdown\n\nAdjust total amount and display tax information\n\nSubmit payment\n\nSubmit payment with Tax Calculation\n\nRecord Tax Transaction\n\nRequest a refund\n\nRequest a refund\n\nRecord a Tax Reversal\n\nReport for filing taxes with all recorded transactions and refunds\n\nA diagram providing a high level overview of the tax api integration outlined in\nthis doc\n#### Private preview\n\nThis feature is currently in Private preview. Users without preview access can\nuse the [Tax API](https://docs.stripe.com/tax/custom) to integrate Stripe Tax\nwith payment intents.\n\n[Calculate tax](https://docs.stripe.com/tax/payment_intent#calculate-tax)\nYou can integrate the [Tax API](https://docs.stripe.com/tax/custom) with a\nPaymentIntent by associating it with a Tax `Calculation` object. Use [calculate\ntax](https://docs.stripe.com/api/tax/calculations/create) to get a new Tax\n`Calculation` object with information about how much tax to collect.\n\n```\ncurl https://api.stripe.com/v1/tax/calculations \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d currency=usd \\\n -d \"line_items[0][amount]\"=1000 \\\n -d \"line_items[0][reference]\"=L1 \\\n -d \"line_items[0][tax_code]\"=txcd_99999999 \\\n -d \"customer_details[address][line1]\"=\"920 5th Ave\" \\\n -d \"customer_details[address][city]\"=Seattle \\\n -d \"customer_details[address][state]\"=WA \\\n -d \"customer_details[address][postal_code]\"=98104 \\\n -d \"customer_details[address][country]\"=US \\\n -d \"customer_details[address_source]\"=shipping\n```\n\n[Link tax calculation to the\nPaymentIntent](https://docs.stripe.com/tax/payment_intent#link-calculation-to-payment)\n#### Private preview\n\nThis feature is currently in Private preview. Users without preview access can\nuse the [Tax API](https://docs.stripe.com/tax/custom) to integrate Stripe Tax\nwith payment intents.\n\nWhen [creating or modifying a\nPaymentIntent](https://docs.stripe.com/payments/quickstart), include the Tax\n`Calculation` ID and set the `amount` to the `amount_total` of the Tax\n[Calculation](https://docs.stripe.com/api/tax/calculations/object) object.\n\n```\ncurl https://api.stripe.com/v1/payment_intents \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -H \"Stripe-Version: 2025-02-24.acacia; payment_intent_with_tax_api_beta=v1;\" \\\n -d amount=1000 \\\n -d currency=usd \\\n -d \"automatic_payment_methods[enabled]\"=true \\\n -d \"async_workflows[inputs][tax][calculation]\"={{CALCULATION_ID}}\n```\n\n### Supported endpoints\n\nThe following endpoints support setting a calculation on a PaymentIntent.\n\n- Create:\n[/v1/payment_intents](https://docs.stripe.com/api/payment_intents/create)\n- Update:\n[/v1/payment_intents/:id](https://docs.stripe.com/api/payment_intents/update)\n- Confirm:\n[/v1/payment_intents/:id/confirm](https://docs.stripe.com/api/payment_intents/confirm)\n- Capture:\n[/v1/payment_intents/:id/capture](https://docs.stripe.com/api/payment_intents/capture)\n\n### Limitations\n\n- You can only link new calculations to a PaymentIntent until it transitions to\na `succeeded` state.\n- A tax calculation can transition to only one tax `Transaction`. If multiple\nPaymentIntents transition to a `succeeded` state with the same linked\ncalculation, accounting reflects only the first one.\n\n## Resulting Stripe actions\n\nIf the PaymentIntent is correctly linked to the Tax `Calculation` object, Stripe\nautomatically:\n\n- Creates a tax transaction from the calculation after the PaymentIntent\ntransitions to a `succeeded` state\n- Performs a tax reversal of a tax transaction for any refunds (created with API\nor Dashboard) for the PaymentIntent\n- Creates a tax reversal for a reversal, if a refund has failed\n- Includes the total tax information in `PaymentIntent` receipts\n\nStripe wonâ€™t:\n\n- Change the PaymentIntent amount based on the linked tax calculation\n- Alter the tax transaction amount based on the PaymentIntent captured amount\n- Automatically create a tax reversal for disputes\n\n## Integrate taxes for your Connect platform with the Stripe Tax and Payment Intents APIs\n\nThe Payment Intents API works with connected accounts on your Connect platform.\nThis means that if you calculate tax using a connected account, you can link the\ntax calculation to a Payment Intent created using that connected account.\n\n[OptionalRetrieve automatically committed tax\ntransactions](https://docs.stripe.com/tax/payment_intent#get-transaction-attempts)\n## See also\n\n- [Tax API for Sales Tax, GST, and VAT](https://docs.stripe.com/tax/custom)\n- [Custom payment flow guide](https://docs.stripe.com/payments/quickstart)\n- [Reporting and filing](https://docs.stripe.com/tax/reports)\n- [Use Stripe Tax with Connect](https://docs.stripe.com/tax/connect)\n\n## Links\n\n- [Tax API](https://docs.stripe.com/tax/custom)\n- [calculate tax](https://docs.stripe.com/api/tax/calculations/create)\n- [creating or modifying a\nPaymentIntent](https://docs.stripe.com/payments/quickstart)\n- [Calculation](https://docs.stripe.com/api/tax/calculations/object)\n- [/v1/payment_intents](https://docs.stripe.com/api/payment_intents/create)\n- [/v1/payment_intents/:id](https://docs.stripe.com/api/payment_intents/update)\n-\n[/v1/payment_intents/:id/confirm](https://docs.stripe.com/api/payment_intents/confirm)\n-\n[/v1/payment_intents/:id/capture](https://docs.stripe.com/api/payment_intents/capture)\n- [Reporting and filing](https://docs.stripe.com/tax/reports)\n- [Use Stripe Tax with Connect](https://docs.stripe.com/tax/connect)",
  "metadata": {
    "title": "Calculate tax in your custom payment flows | Stripe Documentation",
    "description": "Integrate Stripe Tax into your custom payment flows to automatically calculate, collect, and manage taxes. Link tax calculations to payment intents, handle tax transactions and reversals, and streamline tax compliance in your payment processes.",
    "sourceURL": "https://docs.stripe.com/tax/payment_intent"
  }
}