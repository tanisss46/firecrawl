{
  "content": "# Use tax amounts calculated outside of Stripe with Stripe Billing\n\n## Use taxes calculated from an external system with Stripe Invoices.\n\nTo accommodate a wide range of billing scenarios, Stripe allows tax amounts to\nbe set directly on invoices, which helps you to integrate with other tax\ncalculation systems (such as a third-party tax tool such as Avalara or your own\ntax engine). This guide goes through various billing scenarios to show how to\nuse the\n[tax_amounts](https://docs.stripe.com/api/invoices/update_line#update_lines-tax_amounts)\nfield.\n\n## Create an invoice with manual tax amounts\n\nThis section describes adding manual tax amounts to invoice line items.\n\n### Create an invoice with an invoice item\n\nThe first step is to create an invoice. We assume you already have a customer\ncreated, but if you don’t, please reference the\n[customers](https://docs.stripe.com/invoicing/customer) guide.\n\n```\ncurl https://api.stripe.com/v1/invoices \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d customer={{CUSTOMER_ID}}\n```\n\nManual tax amounts can only be added to invoice line items, so add an invoice\nitem to the invoice.\n\n```\ncurl https://api.stripe.com/v1/invoiceitems \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d customer={{CUSTOMER_ID}} \\\n -d invoice={{INVOICE_ID}} \\\n -d amount=100 \\\n -d currency=usd\n```\n\n### Update the invoice line item with tax_amounts\n\nThe [update invoice line item\nendpoint](https://docs.stripe.com/api/invoices/update_line) accepts the\n[tax_amounts](https://docs.stripe.com/api/invoices/update_line#update_lines-tax_amounts)\nparameter. This field gives merchants the ability to directly set the tax\namounts on invoice line items. The field also requires tax rate data to make\nsure relevant information is displayed to the customer. The example below\nupdates an invoice line item with the `tax_amounts` field.\n\n```\ncurl\nhttps://api.stripe.com/v1/invoices/{{INVOICE_ID}}/lines/il_0O4tNe589O8KAxCGYD7OyXPP\n\\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"tax_amounts[0][amount]\"=10 \\\n -d \"tax_amounts[0][taxable_amount]\"=100 \\\n -d \"tax_amounts[0][tax_rate_data][percentage]\"=10 \\\n -d \"tax_amounts[0][tax_rate_data][inclusive]\"=false \\\n -d \"tax_amounts[0][tax_rate_data][tax_type]\"=sales_tax \\\n -d \"tax_amounts[0][tax_rate_data][display_name]\"=\"Sales Tax\" \\\n -d \"tax_amounts[0][tax_rate_data][description]\"=\"Texas Sales Tax\" \\\n -d \"tax_amounts[0][tax_rate_data][jurisdiction]\"=Texas \\\n -d \"tax_amounts[0][tax_rate_data][country]\"=US \\\n -d \"tax_amounts[0][tax_rate_data][state]\"=TX\n```\n\nAll of the fields under `tax_amounts` are required except for `description`,\n`jurisdiction`, `country`, `state`, and `tax_type`. The [invoice line item\nobject](https://docs.stripe.com/api/invoices/line_item) returns a `tax_amounts`\nfield.\n\n```\n{\n id: \"il_0O4tNe589O8KAxCGYD7OyXPP\",\n object: \"line_item\",\n amount: 100,\n amount_excluding_tax: 100,\n currency: \"usd\",\n ...\n tax_amounts: [\n {\n amount: 10,\n inclusive: false,\n tax_rate: \"txr_0Ns7kW589O8KAxCGXoi7EAuS\",\n taxability_reason: null,\n taxable_amount: 100\n }\n ],\n tax_rates: [],\n ...\n}\n```\n\n#### Note\n\nStripe automatically creates or reuses an existing tax rate based on\n`tax_rate_data`. However, Stripe calculates tax amounts on the invoice based\nonly on the amount parameter. Other values, such as tax rate, are only used for\nrendering purposes to be shown on the invoice. No validations are run on these\nfields to make sure they’re consistent with the tax amounts specified.\n\n### Finalize the invoice\n\nAfter all of the invoice line items are updated with tax amounts, you need to\nfinalize the invoice. Tax amounts can’t change after the invoice is finalized.\nRefer to the [edit invoice](https://docs.stripe.com/invoicing/invoice-edits)\nguide if you need to modify the invoice after finalization.\n\n```\ncurl -X POST https://api.stripe.com/v1/invoices/{{INVOICE_ID}}/finalize \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\"\n```\n\n## Stripe automatically creates tax-rates\n\nFor manual tax amounts, Stripe requires information about the corresponding tax\nrate. The tax rate is only used to display information to customers. It isn’t\nused in any calculations.\n\nStripe automatically creates tax rate objects in the background based on\n`tax_rate_data`. If the same tax rate data is passed in multiple times, Stripe\nreferences the existing tax rate object instead of creating another one. The\nfollowing fields are used to deduplicate the tax rate: `percentage`,\n`inclusive`, `display_name`, `jurisdiction`, `country`, `state`, and `tax_type`.\nIn this example, assume a second invoice line item was updated on the invoice\nfrom the previous section with the same `tax_rate_data`.\n\n```\ncurl\nhttps://api.stripe.com/v1/invoices/{{INVOICE_ID}}/lines/il_0P6nbg589O8KAxCGRWBJAdNV\n\\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"tax_amounts[0][amount]\"=50 \\\n -d \"tax_amounts[0][taxable_amount]\"=500 \\\n -d \"tax_amounts[0][tax_rate_data][percentage]\"=10 \\\n -d \"tax_amounts[0][tax_rate_data][inclusive]\"=false \\\n -d \"tax_amounts[0][tax_rate_data][tax_type]\"=sales_tax \\\n -d \"tax_amounts[0][tax_rate_data][display_name]\"=\"Sales Tax\" \\\n -d \"tax_amounts[0][tax_rate_data][description]\"=\"Texas Sales Tax\" \\\n -d \"tax_amounts[0][tax_rate_data][jurisdiction]\"=Texas \\\n -d \"tax_amounts[0][tax_rate_data][country]\"=US \\\n -d \"tax_amounts[0][tax_rate_data][state]\"=TX\n```\n\n```\n{\n id: \"il_0P6nbg589O8KAxCGRWBJAdNV\",\n object: \"line_item\",\n amount: 100,\n amount_excluding_tax: 100,\n currency: \"usd\",\n ...\n tax_amounts: [\n {\n amount: 10,\n inclusive: false,\n tax_rate: \"txr_0Ny6QR589O8KAxCGo6MKGPxM\",\n taxability_reason: null,\n taxable_amount: 100\n }\n ],\n tax_rates: [],\n ...\n}\n```\n\nBoth invoice line items have the same `tax_rate` ID under the `tax_amount`.\nStripe handles the tax rate creation and deduplication to minimize the burden on\nmerchants. While the `tax_rate` ID maps to a valid tax rate object, the IDs\nmapped to automatically created tax rates can’t be passed into the `tax_rates`\nfield on the API. The only exception to that rule is the create credit notes\nendpoint.\n\n## Issue a credit note\n\nCredit notes allow for adjustments on invoices without needing to void an\ninvoice. When issuing a credit note for an invoice line item with manual tax\namounts, the API requires additional information to accurately create it.\n\n### Create credit note\n\nThe create credit note endpoint also accepts the `tax_amounts` parameter. The\nfield is required when the corresponding invoice line item has manual tax\namounts. This ensures accurate accounting of the credit note and maintains\nconsistency with your invoices.\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d reason=duplicate \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"=il_0O4tNe589O8KAxCGYD7OyXPP \\\n -d \"lines[0][tax_amounts][0][amount]\"=10 \\\n -d \"lines[0][tax_amounts][0][taxable_amount]\"=100 \\\n -d \"lines[0][tax_amounts][0][tax_rate]\"=txr_0Ns7kW589O8KAxCGXoi7EAuS\n```\n\n## Limitations\n\nKeep in mind the following constraints when working with manual tax amounts.\n\n### Invoice items don’t have tax amounts\n\nManual tax amounts can only be added to invoice line items.\n\n### taxable_amount and tax_rates are not validated\n\nThe taxable amount and tax rate data passed in the request are only used for\nrendering purposes. They’re not validated against the tax amount in the request.\n\n### Can’t mix tax_amounts and tax_rates\n\nAn invoice line item can’t have manual tax amounts if it also has a tax rate,\nand vice versa. Invoice line items also can’t have manual tax amounts if the\ninvoice has a default tax rate or if any of the other invoice line items on the\ninvoice has a tax rate.\n\n### tax_amounts can grow stale when updating other fields\n\nExisting manual tax amounts persist on the invoice line item unless directly\nedited. This can lead to stale tax amounts when [updating the invoice\nitem](https://docs.stripe.com/api/invoiceitems/update) with fields relating to\nits amount, such as `amount`, `discounts`, or `price`.\n\n### Automatically created tax rates can’t be directly used\n\nStripe automatically creates tax rate objects for manual tax amounts. These tax\nrates can’t be directly referenced on invoice or payment-related endpoints,\nexcept the credit note endpoint. They also can’t be directly updated and won’t\nbe included on the all tax rates endpoint. However, the tax rate’s data is\naccessible by calling the retrieve tax rate endpoint with its token.\n\n## Links\n\n-\n[tax_amounts](https://docs.stripe.com/api/invoices/update_line#update_lines-tax_amounts)\n- [customers](https://docs.stripe.com/invoicing/customer)\n- [update invoice line item\nendpoint](https://docs.stripe.com/api/invoices/update_line)\n- [invoice line item object](https://docs.stripe.com/api/invoices/line_item)\n- [edit invoice](https://docs.stripe.com/invoicing/invoice-edits)\n- [updating the invoice item](https://docs.stripe.com/api/invoiceitems/update)",
  "metadata": {
    "title": "Use tax amounts calculated outside of Stripe with Stripe Billing | Stripe Documentation",
    "description": "Use taxes calculated from an external system with Stripe Invoices.",
    "sourceURL": "https://docs.stripe.com/invoicing/taxes/manual-tax-amounts"
  }
}