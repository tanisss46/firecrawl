{
  "content": "# OAuth 2.0\n\n## Use the industry standard OAuth 2.0 to authenticate requests to the Stripe API on behalf of your users.\n\nA user authenticating with OAuth follows these steps.\n\n- On your site, the user clicks a link that redirects them to Stripe.\n- On Stripe, the user selects the appropriate account and accepts permissions\nfor installing the app.\n- After the app is installed, authentication is complete and the user is\nredirected to a defined URI.\n\n![Installing an app with\nOAuth](https://b.stripecdn.com/docs-statics-srv/assets/oauth-user-journey.0fd6041638a1cbb305dc88690354a462.png)\n\n[Develop your\napp](https://docs.stripe.com/stripe-apps/api-authentication/oauth#develop-app)-\n[Create your Stripe\nApp](https://docs.stripe.com/stripe-apps/create-app#create-app) by running\n`stripe apps create <app-name>` in the CLI.\n- Edit the following fields in the [app\nmanifest](https://docs.stripe.com/stripe-apps/reference/app-manifest):\n\n- Set `stripe_api_access_type` to `oauth`.\n- Set `distribution_type` to `public`.\n- Set your `allowed_redirect_uris`. These are the URLs that users are redirected\nto after installing your app using OAuth. The first one in the list is used as\nthe default redirect.\n\nYour app manifest should look like this:\n\n```\n{\n \"id\": \"com.example.my-app\",\n \"version\": \"0.0.1\",\n \"name\": \"Your Stripe App\",\n \"icon\": \"./[YOUR_APP]_icon_32.png\",\n \"permissions\": [\n // Your app permissions here\n ],\n \"stripe_api_access_type\": \"oauth\",\n \"distribution_type\": \"public\",\n \"allowed_redirect_uris\": [\n // Your redirect URIs here\n ]\n}\n```\n- Add all the\n[permissions](https://docs.stripe.com/stripe-apps/reference/permissions) that\nyour app requires.\n- *(Optional)* Add [UI extensions](https://docs.stripe.com/stripe-apps/build-ui)\nto your app. We recommend adding a [settings\nview](https://docs.stripe.com/stripe-apps/app-settings) to allow your users to\nconfigure settings or to link to your app’s documentation.\n- [Upload](https://docs.stripe.com/stripe-apps/upload-install-app) your app to\nStripe.\n\n```\nstripe apps upload\n```\n[Test your\napp](https://docs.stripe.com/stripe-apps/api-authentication/oauth#test-app)-\nNavigate to your app’s details page.\n- Open the **External test** tab and click **Get started** to set up an\n[external test](https://docs.stripe.com/stripe-apps/test-app).\n- Access the authorize links in the **Test OAuth** section. You can use this\nlink to test with different accounts.\n[Create your OAuth install\nlink](https://docs.stripe.com/stripe-apps/api-authentication/oauth#create-install-link)\nFrom your webpage, redirect to your OAuth install link with the following\nparameters:\n`https://marketplace.stripe.com/oauth/v2/authorize?client_id=${clientId}&redirect_uri=${redirectUrl}&state=${state}`.\n\nStripe generates separate links for both live and test modes. You can find the\nlinks in the **External test** tab.\n\n![The location of test OAuth links within the Stripe\nDashboard](https://b.stripecdn.com/docs-statics-srv/assets/test-oauth-links.20f52db339e45b4ebe7f3a5061e9f335.png)\n\n#### Security tip\n\nTo prevent CSRF attacks, add the recommended `state` parameter and pass along a\nunique token as the value. We include the `state` you provide when redirecting\nusers to your site. Your site can confirm that the `state` parameter hasn’t been\nmodified. See [URL\nparameters](https://docs.stripe.com/stripe-apps/api-authentication/oauth#url-parameters)\nfor more information.\n\n[Publish your\napp](https://docs.stripe.com/stripe-apps/api-authentication/oauth#publish-app)\n[Submit your app for\nreview](https://docs.stripe.com/stripe-apps/publish-app#submit-app-for-review)\nwhen you are ready to publish it to the Stripe App Marketplace\n\nWhen submitting an OAuth app for review, you need to provide the Marketplace\ninstall URL. This URL must link to a page that can initiate the onboarding and\ninstallation process with clear instructions using OAuth install links from the\nprevious step.\n\nMake sure the install URL provided to App Review uses the public OAuth links\navailable within the “Settings” tab.\n\n![The location of public OAuth links within the Stripe\nDashboard](https://b.stripecdn.com/docs-statics-srv/assets/public-oauth-links.bef9bbbf32bcac8e16ff9515fc4169e4.png)\n\n#### Note\n\nThe public OAuth install links don’t work until the app is published. However,\nour app review team can install and test your app through this link.\n\n[Install your app and\nauthorize](https://docs.stripe.com/stripe-apps/api-authentication/oauth#install-app)-\nIn your browser, open your OAuth install link. You can adjust the query\nparameters to change the redirect URL to one supported by the app.\n- View and accept the permissions to install the app. When the installation is\ncomplete, the user is redirected to the first callback URL you’ve defined in the\napp manifest, unless you’ve specified a [URL\nparameter](https://docs.stripe.com/stripe-apps/api-authentication/oauth#url-parameters).\n[Exchange the authorization code for an access\ntoken](https://docs.stripe.com/stripe-apps/api-authentication/oauth#obtain-access-token)\nYour callback URL receives an OAuth [authorization\ncode](https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1) parameter\nthat your backend needs to exchange for an API access token and the refresh\ntoken. This authorization code is one-time use only and valid only for 5\nminutes, in which your backend needs to exchange the code for the access token.\nBelow is the command that your backend code needs to implement using an OAuth\n[client library](https://oauth.net/code/).\n\n```\ncurl -X POST https://api.stripe.com/v1/oauth/token \\\n -u sk_live_***: \\\n -d code=ac_*** \\\n -d grant_type=authorization_code\n```\n\n#### Note\n\nYou’ll need to use the app developer API Key for the relevant mode. To enable\nthis, pass the relevant mode within the `state`.\n\nHere’s an example response for the above `curl` command.\n\n```\n{\n \"access_token\": \"{{ ACCESS_TOKEN }}\",\n \"livemode\": true,\n \"refresh_token\": \"{{ REFRESH_TOKEN }}\",\n \"scope\": \"stripe_apps\",\n \"stripe_publishable_key\": \"pk_live_***\",\n \"stripe_user_id\": \"acct_***\",\n \"token_type\": \"bearer\"\n}\n```\n\n[Refresh your access\ntoken](https://docs.stripe.com/stripe-apps/api-authentication/oauth#refresh-access-token)\nAccess tokens expire in 1 hour, and refresh tokens expire after 1 year. Refresh\ntokens are also rolled on every exchange, so the expiration time for the new\nrefresh tokens is always a year from the date that it was generated or rolled.\nIf you exchange a refresh token for an access token within one year, you should\nnever hit the refresh token expiration date.\n\nHere is the equivalent `curl` command to exchange the access token for a refresh\ntoken using your secret key:\n\n```\ncurl -X POST https://api.stripe.com/v1/oauth/token \\\n -u sk_live_***: \\\n -d refresh_token={{ REFRESH_TOKEN }} \\\n -d grant_type=refresh_token\n```\n\nHere’s an example response.\n\n```\n{\n \"access_token\": \"{{ ACCESS_TOKEN }}\",\n \"livemode\": true,\n \"refresh_token\": \"{{ REFRESH_TOKEN }}\",\n \"scope\": \"stripe_apps\",\n \"stripe_publishable_key\": \"pk_live_***\",\n \"stripe_user_id\": \"acct_***\",\n \"token_type\": \"bearer\"\n}\n```\n\nYou’ll get a new refresh token and the previous refresh token expires. You must\nsecurely store the refresh token in your backend and use the refresh token to\nobtain a fresh access token anytime you want to access the Stripe API on behalf\nof the Stripe User.\n\n#### Common mistake\n\nWhen you refresh the access token you may see an error that says you do not have\nthe required permissions. If you see this, confirm that you’re using the secret\nkey for your account to authorize the API call and that you’re not accidentally\nusing a refresh token, access token, or a restricted key.\n\nYou can verify the access token by making a request to the Stripe API. For\nexample:\n\n```\ncurl https://api.stripe.com/v1/customers \\\n -u \"{{ ACCESS_TOKEN }}\"\n```\n\n[OptionalCustomize links with URL\nparameters](https://docs.stripe.com/stripe-apps/api-authentication/oauth#url-parameters)\n\n## Links\n\n- [Create your Stripe\nApp](https://docs.stripe.com/stripe-apps/create-app#create-app)\n- [app manifest](https://docs.stripe.com/stripe-apps/reference/app-manifest)\n- [permissions](https://docs.stripe.com/stripe-apps/reference/permissions)\n- [UI extensions](https://docs.stripe.com/stripe-apps/build-ui)\n- [settings view](https://docs.stripe.com/stripe-apps/app-settings)\n- [Upload](https://docs.stripe.com/stripe-apps/upload-install-app)\n- [external test](https://docs.stripe.com/stripe-apps/test-app)\n- [Submit your app for\nreview](https://docs.stripe.com/stripe-apps/publish-app#submit-app-for-review)\n- [authorization\ncode](https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1)\n- [client library](https://oauth.net/code/)",
  "metadata": {
    "title": "OAuth 2.0 | Stripe Documentation",
    "description": "Use the industry standard OAuth 2.0 to authenticate requests to the Stripe API on behalf of your users.",
    "sourceURL": "https://docs.stripe.com/stripe-apps/api-authentication/oauth"
  }
}