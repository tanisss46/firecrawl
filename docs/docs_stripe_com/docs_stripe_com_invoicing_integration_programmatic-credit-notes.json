{
  "content": "# Generate credit notes programmatically\n\n## Use the Invoicing API to adjust or refund finalized invoices with credit notes.\n\nTo adjust the balance of an `open` or `paid`\n[invoice](https://docs.stripe.com/api/invoices), generate a [credit\nnote](https://docs.stripe.com/api/credit_notes).\n\n#### Note\n\nFor information about working with credit notes using the Dashboard, see [Issue\ncredit notes](https://docs.stripe.com/invoicing/dashboard/credit-notes).\n\nWhen you create a credit note, you can apply credit amounts in three ways:\n\n- Discount a fixed amount from an invoice line item.\n- Discount a quantity from an invoice line item. The total discount is the\ndiscount quantity times the unit price of that line item.\n- Apply a discount to the total invoice amount by adding a custom discount line\nitem with a description, quantity, and unit price. The total discount is the\nquantity times the unit price.\n\nWe recommend discounting invoice line items when possible, since it associates\neach credit with a line item. Adding a custom discount line item can make\nreporting and tracking difficult, because the credit isn’t associated with a\nreal invoice line item.\n\n#### Note\n\nYou can’t combine discount types on an invoice line item. For example, if you\ndiscount a line item quantity, then a future credit note can only discount that\nline item by quantity, not by amount. If you discount a line item amount, then a\nfuture credit note can only discount that line item by amount, not by quantity.\n\n## Credit notes for open invoices\n\nWhen you create a custom line item on a credit note for an `open` invoice, the\n`amount_due` on the invoice decreases based on the `custom_line_items` in the\ncredit note. This is in addition to any adjustments you make to existing\n`invoice_line_items`. For example, if the amount due on an `open` invoice is 100\nUSD and you create a `custom_line_item` with `quantity=1` and\n`unit_amount=2000`, the new amount due on the invoice is 80 USD.\n\nOn an invoice, credit notes appear as items after applying discounts and\ntaxes—so they’re a post-tax adjusted amount. We calculate the invoice amount due\nusing the following order:\n\n- Sum of invoice line items\n- Discounts\n- Pre-tax invoice total\n- Taxes\n- Customer credit balance\n- Credit notes applied (to gross amount due)\n- New amount due\n\nIf applying a credit note to an invoice changes the amount due to zero, the\ninvoice automatically transitions into the `paid` state. If you want to change\nthe quantity or amount of an existing line item, pass the invoice ID, the line\nitem ID, and the new quantity or amount. When a line item has a quantity and an\namount, you can only update the quantity. Otherwise, you can only change the\namount. The example below adjusts the quantity to two:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{INVOICE_LINE_ITEM}} \\\n -d \"lines[0][quantity]\"=2\n```\n\nTo create a custom line item on the credit note, pass the invoice ID,\ndescription, quantity, and unit amount. You can (optionally) set a tax rate as\nwell. This example creates a custom line item on the credit note for 10 USD:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=custom_line_item \\\n -d \"lines[0][description]\"=\"Courtesy credit\" \\\n -d \"lines[0][quantity]\"=1 \\\n -d \"lines[0][unit_amount]\"=1000\n```\n\n## Credit notes for paid invoices\n\nWhen you create a credit note for a `paid` invoice, the amount due on the\ninvoice doesn’t change. Instead, the user can choose one or more of the\nfollowing options:\n\nActionDescriptionCreate a refundRefund the invoice’s charge back to the\ncustomer’s payment method.Link a refundLink an existing refund for the invoice’s\ncharge.Credit the customer credit balanceCredit the customer credit balance,\nwhich is automatically applied to their future invoices.Credit outside of\nStripeCredit the invoice for an amount made in an adjustment outside of Stripe.\nIn the following example, the credit note creates a refund:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{INVOICE_LINE_ITEM}} \\\n -d \"lines[0][quantity]\"=2 \\\n -d refund_amount=500\n```\n\nHere, the credit note creates a credit to the customer credit balance:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{INVOICE_LINE_ITEM}} \\\n -d \"lines[0][quantity]\"=2 \\\n -d credit_amount=500\n```\n\nYou can also combine multiple parameters. Funds that are left over after\nsubtracting the refund and credit amounts from the invoice `amount` results in a\ncredit outside of Stripe, usually with cash or a check:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{INVOICE_LINE_ITEM}} \\\n -d \"lines[0][quantity]\"=2 \\\n -d refund_amount=100 \\\n -d credit_amount=200 \\\n -d out_of_band_amount=200\n```\n\n## Voiding credit notes\n\nYou can void a credit note only if it’s on an open invoice. Voiding a credit\nnote reverses its adjustment, increasing the amount due on the invoice by the\namount of the credit note. To void a credit note:\n\n```\ncurl -X POST https://api.stripe.com/v1/credit_notes/{{CREDIT_NOTE_ID}}/void \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\"\n```\n\n## Crediting negative line items\n\nYou can credit a negative amount to a negative `invoice_line_item` using either\nthe `amount` or `quantity` parameters.\n\nFor example, if you have an `open` invoice with two line items:\n\n- a positive line item with `quantity=1` and `unit_amount=10000`\n- and a negative line item with `quantity=1` and `unit_amount=-5000`.\n\nThis example uses the `amount` parameter to credit the full amount of both line\nitems:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{POSITIVE_INVOICE_LINE_ITEM}} \\\n -d \"lines[0][amount]\"=10000 \\\n -d \"lines[1][type]\"=invoice_line_item \\\n -d \"lines[1][invoice_line_item]\"={{NEGATIVE_INVOICE_LINE_ITEM}} \\\n -d \"lines[1][amount]\"=-5000\n```\n\nThis example uses the `quantity` parameter to do the same:\n\n```\ncurl https://api.stripe.com/v1/credit_notes \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d invoice={{INVOICE_ID}} \\\n -d \"lines[0][type]\"=invoice_line_item \\\n -d \"lines[0][invoice_line_item]\"={{POSITIVE_INVOICE_LINE_ITEM}} \\\n -d \"lines[0][quantity]\"=1 \\\n -d \"lines[1][type]\"=invoice_line_item \\\n -d \"lines[1][invoice_line_item]\"={{NEGATIVE_INVOICE_LINE_ITEM}} \\\n -d \"lines[1][quantity]\"=1\n```\n\nThe following restrictions apply:\n\n- The total amount of the credit note must remain positive.\n- The total amount credited to a negative line item must be negative.\n- The total amount credited to a negative line item can’t be less than the line\nitem amount.\n\nYou also can’t credit a negative amount on a `custom_line_item`. We only support\nnegative amounts on `invoice_line_items`.\n\n## Links\n\n- [invoice](https://docs.stripe.com/api/invoices)\n- [credit note](https://docs.stripe.com/api/credit_notes)\n- [Issue credit notes](https://docs.stripe.com/invoicing/dashboard/credit-notes)",
  "metadata": {
    "title": "Generate credit notes programmatically | Stripe Documentation",
    "description": "Use the Invoicing API to adjust or refund finalized invoices with credit notes.",
    "sourceURL": "https://docs.stripe.com/invoicing/integration/programmatic-credit-notes"
  }
}