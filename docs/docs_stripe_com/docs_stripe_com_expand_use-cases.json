{
  "content": "# Use cases for expanding responses\n\n## Learn how the expand attribute helps you perform common tasks.\n\n## See the Stripe fee for a given payment\n\nYou can check the processing fees for a payment after the payment is processed\nand the balance transaction is created. Stripe automatically creates this\n[balance\ntransaction](https://docs.stripe.com/api/balance_transactions/object#balance_transaction_object-fee_details)\nin the background. The `charge.updated` event includes a reference to the\nbalance transaction through the `balance_transaction` property (for example,\n`txn_123`), indicating that the balance transaction has been created and is\nready for use.\n\nInstead of looking up the balance transaction separately, you can retrieve it in\na single call using `expand`. For example:\n\n```\ncurl https://api.stripe.com/v1/payment_intents/pi_1Gpl8kLHughnNhxyIb1RvRTu \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d \"expand[]\"=\"latest_charge.balance_transaction\" \\\n -G\n```\n\nUsers on API version [2022-08-01](https://docs.stripe.com/upgrades#2022-08-01)\nor older:\n\n```\ncurl https://api.stripe.com/v1/payment_intents/pi_1Gpl8kLHughnNhxyIb1RvRTu \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d \"expand[]\"=\"charges.data.balance_transaction\" \\\n -G\n```\n\n#### Note\n\nA payment intent must be\n[captured](https://docs.stripe.com/payments/place-a-hold-on-a-payment-method#capture-funds)\nand have a\n[status](https://docs.stripe.com/api/payment_intents/object#payment_intent_object-status)\nof `succeeded` for the Stripe fees to be available.\n\n## See the charges included in a payout\n\nEvery automatic [payout](https://docs.stripe.com/payouts) is tied to historical\nchanges to the balance of your Stripe account. The API records these historical\nchanges as [balance\ntransactions](https://docs.stripe.com/api/balance_transactions/object), which\nyou can retrieve using [List Balance\nTransactions](https://docs.stripe.com/api/balance_transactions/list). From a\nlist of balance transactions, you can expand the\n[source](https://docs.stripe.com/api/balance_transactions/object#balance_transaction_object-source)\nproperty to gather information on what triggered the change to the account\nbalance (Charge, Refund, Transfer, and so on). For example:\n\n```\ncurl https://api.stripe.com/v1/balance_transactions \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d payout=po_1Gl3ZLLHughnNhxyDrOia0vI \\\n -d type=charge \\\n -d \"expand[]\"=\"data.source\" \\\n -G\n```\n\n#### Note\n\nYou can only retrieve balance transaction history on *automatic* payouts. If you\nhave manual payouts enabled, you must track transaction history on your own.\n\nLearn more about [payout\nreconciliation](https://docs.stripe.com/payouts/reconciliation).\n\nIf you’re using [Connect](https://docs.stripe.com/connect) with destination\ncharges, you can retrieve the same information on behalf of your connected\naccounts. One difference is that destination charges involve both a transfer and\na linked payment (in the form of a Charge object) to move funds to a connected\naccount. So when listing the balance transactions bundled in your connected\naccount’s payouts, each balance transaction’s source is linked to the transfer’s\npayment rather than the originating Charge. To retrieve the originating Charge,\nyou need to expand a payment’s linked transfer through the\n[source_transfer](https://docs.stripe.com/api/charges/object#charge_object-source_transfer)\nproperty; and from there, expand the transfer’s\n[source_transaction](https://docs.stripe.com/api/transfers/object#transfer_object-source_transaction)\nproperty:\n\n```\ncurl https://api.stripe.com/v1/balance_transactions \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d payout=po_1G7bnaD2wdkPsFGzdVOqU44u \\\n -d type=payment \\\n -d \"expand[]\"=\"data.source.source_transfer.source_transaction\" \\\n -H \"Stripe-Account: acct_1G7PaoD2wdkPsFGz\" \\\n -G\n```\n\n## Links\n\n- [balance\ntransaction](https://docs.stripe.com/api/balance_transactions/object#balance_transaction_object-fee_details)\n- [2022-08-01](https://docs.stripe.com/upgrades#2022-08-01)\n-\n[captured](https://docs.stripe.com/payments/place-a-hold-on-a-payment-method#capture-funds)\n-\n[status](https://docs.stripe.com/api/payment_intents/object#payment_intent_object-status)\n- [payout](https://docs.stripe.com/payouts)\n- [balance\ntransactions](https://docs.stripe.com/api/balance_transactions/object)\n- [List Balance\nTransactions](https://docs.stripe.com/api/balance_transactions/list)\n-\n[source](https://docs.stripe.com/api/balance_transactions/object#balance_transaction_object-source)\n- [payout reconciliation](https://docs.stripe.com/payouts/reconciliation)\n- [Connect](https://docs.stripe.com/connect)\n-\n[source_transfer](https://docs.stripe.com/api/charges/object#charge_object-source_transfer)\n-\n[source_transaction](https://docs.stripe.com/api/transfers/object#transfer_object-source_transaction)",
  "metadata": {
    "title": "Use cases for expanding responses | Stripe Documentation",
    "description": "Learn how the expand attribute helps you perform common tasks.",
    "sourceURL": "https://docs.stripe.com/expand/use-cases"
  }
}