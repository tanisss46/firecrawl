{
  "content": "# Accept an Afterpay or Clearpay payment\n\n## Learn how to accept Afterpay (also known as Clearpay in the UK), a payment method in the US, CA, UK, AU, and NZ.\n\nWebMobileStripe-hosted pageDirect API\n#### Caution\n\nStripe automatically presents your customers payment method options by\nevaluating their currency, payment method restrictions, and other parameters. We\nrecommend that you configure your payment methods from the Stripe Dashboard\nusing the instructions in [Accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?platform=web&ui=stripe-hosted).\n\nIf you want to continue manually configuring the payment methods you present to\nyour customers with Checkout, use this guide. Otherwise, update your integration\nto [configure payment methods in the\nDashboard](https://docs.stripe.com/payments/dashboard-payment-methods).\n\nAfterpay is a [single\nuse](https://docs.stripe.com/payments/payment-methods#usage), [immediate\nnotification](https://docs.stripe.com/payments/payment-methods#payment-notification)\npayment method that requires customers to\n[authenticate](https://docs.stripe.com/payments/payment-methods#customer-actions)\ntheir payment. Customers are redirected to the Afterpay site, where they agree\nto the terms of an installment plan. When the customer accepts the terms,\nAfterpay guarantees that the funds are available to the customer and transfers\nthe funds to your Stripe account. The customer repays Afterpay directly over\ntime.\n\n#### Note\n\nBefore you start the integration, make sure your account is eligible for\nAfterpay by navigating to your [Payment methods\nsettings](https://dashboard.stripe.com/settings/payment_methods).\n\n[Determine\ncompatibility](https://docs.stripe.com/payments/afterpay-clearpay/accept-a-payment#compatibility)\nA Checkout Session must satisfy all of the following conditions to support\nAfterpay payments:\n\n- You can only use one-time line items (recurring\n[subscription](https://docs.stripe.com/billing/subscriptions/creating) plans are\nnot supported).\n- You must express [Prices](https://docs.stripe.com/api/prices) in your domestic\ncurrency.\n[Accept a\npayment](https://docs.stripe.com/payments/afterpay-clearpay/accept-a-payment#accept-a-payment)\n#### Note\n\nThis guide builds on the foundational [accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?ui=stripe-hosted)\nCheckout integration.\n\nUse this guide to learn how to enable Afterpay—it shows the differences between\naccepting a card payment and using Afterpay.\n\n### Enable Afterpay as a payment method\n\nWhen creating a new [Checkout\nSession](https://docs.stripe.com/api/checkout/sessions), you need to:\n\n- Add `afterpay_clearpay` to the list of `payment_method_types`.\n- Make sure all your `line_items` use your domestic currency.\n- We recommend collecting shipping addresses by adding your country to\n`shipping_address_collection[allowed_countries]`. If you don’t want to collect\nshipping addresses with Checkout, you can also provide the shipping address\nusing `payment_intent_data[shipping]`. Doing so helps with loan acceptance\nrates.\n\n```\nStripe::Checkout::Session.create({\n mode: 'payment',\n payment_method_types: ['card'],\n payment_method_types: ['card', 'afterpay_clearpay'],\n line_items: [{\n price_data: {\n currency: 'usd',\n product_data: {\n name: 'T-shirt',\n },\n# Make sure the total amount fits within Afterpay transaction amount limits:\n# https://stripe.com/docs/payments/afterpay-clearpay#collection-schedule\n unit_amount: 2000,\n },\n quantity: 1,\n }],\n shipping_address_collection: {\n # Shipping address is optional but recommended to pass in\n# Specify which shipping countries Checkout should provide as options for\nshipping locations\n allowed_countries: ['AU', 'CA', 'GB', 'NZ', 'US'],\n },\n# If you already have the shipping address, provide it in payment_intent_data:\n # payment_intent_data: {\n # shipping: {\n # name: 'Jenny Rosen',\n # address: {\n # line1: '1234 Main Street',\n # city: 'San Francisco',\n # state: 'CA',\n # country: 'US',\n # postal_code: '94111',\n # },\n # },\n # },\n success_url: 'https://example.com/success',\n cancel_url: 'https://example.com/cancel',\n })\n```\n\n### Fulfill your orders\n\n[Use a method such as\nwebhooks](https://docs.stripe.com/payments/payment-intents/verifying-status#webhooks)\nto handle order fulfillment, instead of relying on your customer to return to\nthe payment status page.\n\nThe following events are sent when the payment status changes:\n\nEvent NameDescriptionNext\nsteps[checkout.session.completed](https://docs.stripe.com/api/events/types#event_types-checkout.session.completed)The\ncustomer successfully authorized the payment by submitting the Checkout\nform.Wait for the payment to succeed or\nfail.[payment_intent.succeeded](https://docs.stripe.com/api/events/types#event_types-payment_intent.succeeded)The\ncustomer’s payment succeeded. The `PaymentIntent` transitions to\n`succeeded`.Fulfill the goods or services that the customer\npurchased.[payment_intent.payment_failed](https://docs.stripe.com/api/events/types#event_types-payment_intent.payment_failed)The\ncustomer’s payment was declined, or failed for some other reason. The\n`PaymentIntent` returns to the `requires_payment_method` status.Email the\ncustomer to request that they place a new order.\nLearn more about [fulfilling\norders](https://docs.stripe.com/checkout/fulfillment).\n\n[Test your\nintegration](https://docs.stripe.com/payments/afterpay-clearpay/accept-a-payment#test-integration)\nWhen testing your Checkout integration, select Afterpay as the payment method\nand click the **Pay** button.\n\nTest your Afterpay integration with your test API keys by viewing the redirect\npage. You can test the successful payment case by authenticating the payment on\nthe redirect page. The PaymentIntent will transition from `requires_action` to\n`succeeded`.\n\nTo test the case where the user fails to authenticate, use your test API keys\nand view the redirect page. On the redirect page, click **Fail test payment**.\nThe PaymentIntent will transition from `requires_action` to\n`requires_payment_method`.\n\nFor [manual\ncapture](https://docs.stripe.com/payments/afterpay-clearpay/accept-a-payment#manual-capture)\nPaymentIntents in testmode, the uncaptured PaymentIntent will auto-expire 10\nminutes after successful authorization.\n\n## Failed payments\n\nAfterpay takes into account multiple factors when deciding to accept or decline\na transaction (for example, length of time buyer has been using Afterpay,\noutstanding amount customer has to repay, value of the current order).\n\nYou should always present additional payment options such as `card` in your\ncheckout flow, as Afterpay payments have a higher rate of decline than many\npayment methods. In these cases, the\n[PaymentMethod](https://docs.stripe.com/api/payment_methods/object) is detached\nand the [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\nobject’s status automatically transitions to `requires_payment_method`.\n\nFor an Afterpay\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/object) with a\nstatus of `requires_action`, customers need to complete the payment within 3\nhours after you redirect them to the Afterpay site (this doesn’t apply to\ndeclined payments). If they take no action within 3 hours, the\n[PaymentMethod](https://docs.stripe.com/api/payment_methods/object) detaches and\nthe object status for the\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\nautomatically transitions to `requires_payment_method`.\n\nIn these cases, inform your customer to try again with a different payment\noption presented in your checkout flow.\n\n## Error codes\n\nThese are the common error codes and corresponding recommended actions:\n\nError codeRecommended action`payment_intent_payment_attempt_failed`A generic\nfailure indicating the Afterpay checkout failed. This can also be a decline\nwhich does not appear as a decline error\ncode.`payment_method_provider_decline`Afterpay declined the customer’s payment.\nAs a next step, the customer needs to contact Afterpay for more\ninformation.`payment_intent_payment_attempt_expired`The customer never completed\nthe payment on Afterpay’s checkout page, and the payment session has expired.\nStripe automatically expires Payment Intents that are not successfully\nauthorized 3 hours after initial checkout\ncreation.`payment_method_not_available`Afterpay experienced a service related\nerror and is unable to complete the request. Retry at a later\ntime.`amount_too_small`Enter an amount within Afterpay’s [default transactions\nlimits](https://docs.stripe.com/payments/afterpay-clearpay#collection-schedule)\nfor the country.`amount_too_large`Enter an amount within Afterpay’s [default\ntransactions\nlimits](https://docs.stripe.com/payments/afterpay-clearpay#collection-schedule)\nfor the country.\n## See also\n\n- [More about Afterpay](https://docs.stripe.com/payments/afterpay-clearpay)\n- [Checkout fulfillment](https://docs.stripe.com/checkout/fulfillment)\n- [Customizing\nCheckout](https://docs.stripe.com/payments/checkout/customization)\n\n## Links\n\n- [Accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?platform=web&ui=stripe-hosted)\n- [configure payment methods in the\nDashboard](https://docs.stripe.com/payments/dashboard-payment-methods)\n- [single use](https://docs.stripe.com/payments/payment-methods#usage)\n- [immediate\nnotification](https://docs.stripe.com/payments/payment-methods#payment-notification)\n-\n[authenticate](https://docs.stripe.com/payments/payment-methods#customer-actions)\n- [Payment methods\nsettings](https://dashboard.stripe.com/settings/payment_methods)\n- [subscription](https://docs.stripe.com/billing/subscriptions/creating)\n- [Prices](https://docs.stripe.com/api/prices)\n- [accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?ui=stripe-hosted)\n- [Checkout Session](https://docs.stripe.com/api/checkout/sessions)\n-\n[https://stripe.com/docs/payments/afterpay-clearpay#collection-schedule](https://stripe.com/docs/payments/afterpay-clearpay#collection-schedule)\n- [https://example.com/success](https://example.com/success)\n- [https://example.com/cancel](https://example.com/cancel)\n- [Use a method such as\nwebhooks](https://docs.stripe.com/payments/payment-intents/verifying-status#webhooks)\n-\n[checkout.session.completed](https://docs.stripe.com/api/events/types#event_types-checkout.session.completed)\n-\n[payment_intent.succeeded](https://docs.stripe.com/api/events/types#event_types-payment_intent.succeeded)\n-\n[payment_intent.payment_failed](https://docs.stripe.com/api/events/types#event_types-payment_intent.payment_failed)\n- [fulfilling orders](https://docs.stripe.com/checkout/fulfillment)\n- [PaymentMethod](https://docs.stripe.com/api/payment_methods/object)\n- [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\n- [default transactions\nlimits](https://docs.stripe.com/payments/afterpay-clearpay#collection-schedule)\n- [More about Afterpay](https://docs.stripe.com/payments/afterpay-clearpay)\n- [Customizing\nCheckout](https://docs.stripe.com/payments/checkout/customization)",
  "metadata": {
    "title": "Accept an Afterpay or Clearpay payment | Stripe Documentation",
    "description": "Learn how to accept Afterpay (also known as Clearpay in the UK), a payment method in the US, CA, UK, AU, and NZ.",
    "sourceURL": "https://docs.stripe.com/payments/afterpay-clearpay/accept-a-payment"
  }
}