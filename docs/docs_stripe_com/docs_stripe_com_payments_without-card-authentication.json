{
  "content": "# Card payments without bank authentication\n\n## Build a simpler integration with regional limitations.\n\nThis integration supports businesses accepting only US and Canadian cards. It’s\nsimpler up front, but does not scale to support a global customer base.\n\n### How does this integration work?\n\n### How does it compare to the global integration?\n\nGrowing or global businesses should use Stripe’s [global\nintegration](https://docs.stripe.com/payments/accept-a-payment) to support bank\nrequests for two-factor authentication and allow customers to pay with more\npayment methods.\n\nCustomer\n\nClient\n\nServer\n\nStripe\n\nProvides card details and clicks Pay button\n\nCalls `stripe.createPaymentMethod`\n\nReturns `PaymentMethod`\n\nFinalizes payment with order details and `PaymentMethod` ID\n\n`POST /v1/payment_intents confirm=true`\n\nAttempts payment\n\nIf no authentication required, returns new `PaymentIntent` with status\n“succeeded”\n\nAttempts payment\n\nIf authentication required, returns new Error with code\n“authentication_required”\n\nPayment flow you're integrating[Build a checkout\nformClient-side](https://docs.stripe.com/payments/without-card-authentication#web-collect-payment-details)\n[Elements](https://docs.stripe.com/payments/elements), part of Stripe.js,\nprovides drop-in UI components for collecting card information from customers.\nStripe hosts them and places them into your payment form as an iframe so your\ncustomer’s card details never touch your code.\n\nHTML + JSReact\nFirst, include the [Stripe.js](https://docs.stripe.com/js) script in the head of\nevery page on your site.\n\n```\n<script src=\"https://js.stripe.com/v3/\"></script>\n```\n\nIncluding the script on every page of your site lets you take advantage of\nStripe’s [advanced fraud functionality](https://docs.stripe.com/radar) and\nability to detect anomalous browsing behavior.\n\n### Security requirements\n\nThis script must always load directly from **js.stripe.com** to remain [PCI\ncompliant](https://docs.stripe.com/security/guide). You can’t include the script\nin a bundle or host a copy of it yourself.\n\nWhen you use Elements, all payment information is submitted over a secure HTTPS\nconnection.\n\nThe address of the page that contains Elements must also start with **https://**\nrather than **http://**. For more information about getting SSL certificates and\nintegrating them with your server to enable a secure HTTPS connection, see the\n[security](https://docs.stripe.com/security) documentation.\n\n### Add Elements to your page\n\nNext, you need a Stripe account. [Register\nnow](https://dashboard.stripe.com/register).\n\nCreate empty DOM elements (containers) with unique IDs within your payment form.\n\n```\n<form id=\"payment-form\">\n <div id=\"card-element\"><!-- placeholder for Elements --></div>\n <button id=\"card-button\">Submit Payment</button>\n<p id=\"payment-result\"><!-- we'll pass the response from the server here --></p>\n</form>\n```\n\nCreate an instance of the [Stripe\nobject](https://docs.stripe.com/js#stripe-function), providing your publishable\n[API key](https://docs.stripe.com/keys) as the first parameter. Afterwards,\ncreate an instance of the [Elements\nobject](https://docs.stripe.com/js#stripe-elements) and use it to\n[mount](https://docs.stripe.com/js#element-mount) a Card element in the empty\nDOM element container on the page.\n\n```\nconst stripe = Stripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\n\nconst elements = stripe.elements();\nconst cardElement = elements.create('card');\ncardElement.mount('#card-element');\n```\n\nUse\n[stripe.createPaymentMethod](https://docs.stripe.com/js/payment_methods/create_payment_method)\non your client to collect the card details and create a\n[PaymentMethod](https://docs.stripe.com/api/payment_methods) when the customer\nsubmits the payment form. Send the ID of the PaymentMethod to your server.\n\n```\nconst form = document.getElementById(\"payment-form\");\n\nvar resultContainer = document.getElementById('payment-result');\n\n// cardElement is defined in the previous step\ncardElement.on('change', function(event) {\n if (event.error) {\n resultContainer.textContent = event.error.message;\n } else {\n resultContainer.textContent = '';\n }\n});\n\nform.addEventListener('submit', async event => {\n event.preventDefault();\n resultContainer.textContent = '';\n const result = await stripe.createPaymentMethod({\n type: 'card',\n card: cardElement,\n });\n handlePaymentMethodResult(result);\n});\n\nconst handlePaymentMethodResult = async ({ paymentMethod, error }) => {\n if (error) {\n// An error happened when collecting card details, show error in payment form\n resultContainer.textContent = result.error.message;\n } else {\n // Send paymentMethod.id to your server (see Step 3)\n const response = await fetch(\"/pay\", {\n method: \"POST\",\n headers: { \"Content-Type\": \"application/json\" },\n body: JSON.stringify({ payment_method_id: paymentMethod.id })\n });\n\n const responseJson = await response.json();\n\n handleServerResponse(responseJson);\n }\n};\n\nconst handleServerResponse = async responseJson => {\n if (responseJson.error) {\n // An error happened when charging the card, show it in the payment form\n resultContainer.textContent = responseJson.error;\n } else {\n // Show a success message\n resultContainer.textContent = 'Success!';\n }\n};\n```\n\n[Set up\nStripeServer-side](https://docs.stripe.com/payments/without-card-authentication#web-setup)\nUse an official library to make requests to the Stripe API from your\napplication:\n\n```\n# Available as a gem\nsudo gem install stripe\n```\n\n```\n# If you use bundler, you can add this line to your Gemfile\ngem 'stripe'\n```\n\n[Make a\npaymentServer-side](https://docs.stripe.com/payments/without-card-authentication#web-create-payment-intent)\nSet up an endpoint on your server to receive the request from the client.\n\nStripe uses a [PaymentIntent](https://docs.stripe.com/api/payment_intents)\nobject to represent your intent to collect payment from a customer, tracking\ncharge attempts and payment state changes throughout the process.\n\nAlways decide how much to charge on the server, a trusted environment, as\nopposed to the client. This prevents malicious customers from being able to\nchoose their own prices.\n\nCreate an HTTP endpoint to respond to the AJAX request from step 1. In that\nendpoint, you should decide how much to charge the customer. To create a\npayment, create a PaymentIntent using the\n[PaymentMethod](https://docs.stripe.com/api/payment_methods) ID from step 1 with\nthe following code:\n\n```\n# Check the status of the PaymentIntent to make sure it succeeded\n\ncurl https://api.stripe.com/v1/payment_intents \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d amount=1099 \\\n -d currency=usd \\\n\n# A PaymentIntent can be confirmed some time after creation,\n# but here we want to confirm (collect payment) immediately.\n -d confirm=true \\\n -d payment_method=\"{{PAYMENT_METHOD_ID}}\" \\\n\n# If the payment requires any follow-up actions from the\n# customer, like two-factor authentication, Stripe will error\n# and you will need to prompt them for a new payment method.\n -d error_on_requires_action=true\n```\n\n#### Warning\n\nIf you set\n[error_on_requires_action](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-error_on_requires_action)\nto `true` when confirming a payment, Stripe automatically fails the payment if\nit requires two-factor authentication from the user.\n\n#### Payment Intents API response\n\nWhen you make a payment with the API, the response includes a status of the\nPaymentIntent. If the payment was successful, it will have a status of\n`succeeded`.\n\n```\n{\n \"id\": \"pi_0FdpcX589O8KAxCGR6tGNyWj\",\n \"object\": \"payment_intent\",\n \"amount\": 1099,\n \"charges\": {\n \"object\": \"list\",\n \"data\": [\n {\n \"id\": \"ch_GA9w4aF29fYajT\",\n \"object\": \"charge\",\n \"amount\": 1099,\n \"refunded\": false,\n \"status\": \"succeeded\",\n }\n ]\n },\n\"client_secret\": \"pi_0FdpcX589O8KAxCGR6tGNyWj_secret_e00tjcVrSv2tjjufYqPNZBKZc\",\n \"currency\": \"usd\",\n \"last_payment_error\": null,\n \"status\": \"succeeded\",\n}\n```\n\nIf the payment is declined, the response includes the error code and error\nmessage. Here’s an example of a payment that failed because two-factor\nauthentication was required for the card.\n\n```\n{\n \"error\": {\n \"code\": \"authentication_required\",\n \"decline_code\": \"authentication_not_handled\",\n \"doc_url\": \"https://docs.stripe.com/error-codes#authentication-required\",\n\"message\": \"This payment required an authentication action to complete, but\n`error_on_requires_action` was set. When you're ready, you can upgrade your\nintegration to handle actions at\nhttps://stripe.com/docs/payments/payment-intents/upgrade-to-handle-actions.\",\n \"payment_intent\": {\n \"id\": \"pi_1G8JtxDpqHItWkFAnB32FhtI\",\n \"object\": \"payment_intent\",\n \"amount\": 1099,\n \"status\": \"requires_payment_method\",\n \"last_payment_error\": {\n \"code\": \"authentication_required\",\n \"decline_code\": \"authentication_not_handled\",\n\"doc_url\": \"https://docs.stripe.com/error-codes#authentication-required\",\n\"message\": \"This payment required an authentication action to complete, but\n`error_on_requires_action` was set. When you're ready, you can upgrade your\nintegration to handle actions at\nhttps://stripe.com/docs/payments/payment-intents/upgrade-to-handle-actions.\",\n \"type\": \"card_error\"\n },\n },\n \"type\": \"card_error\"\n }\n}\n```\n\n[Test the\nintegration](https://docs.stripe.com/payments/without-card-authentication#web-test)\nThere are several test cards you can use in test mode to make sure this\nintegration is ready. Use them with any CVC, postal code, and future expiration\ndate.\n\nNumberDescription4242424242424242Succeeds and immediately processes the\npayment.4000000000009995Always fails with a decline code of\n`insufficient_funds`.4000002500003155Requires authentication, which in this\nintegration will fail with a decline code of `authentication_not_handled`.\nSee the full list of [test cards](https://docs.stripe.com/testing).\n\n[Upgrade your integration to handle card\nauthentication](https://docs.stripe.com/payments/without-card-authentication#web-upgrade-to-handle-card-authentication)\nCongratulations! You completed a payments integration for basic card payments.\nNote that this integration **declines cards that require authentication during\npayment**.\n\nIf you start seeing payments in the Dashboard listed as `Failed`, then it’s time\nto [upgrade your\nintegration](https://docs.stripe.com/payments/payment-intents/upgrade-to-handle-actions).\nStripe’s global integration handles these payments instead of automatically\ndeclining them.\n\n## Links\n\n- [global integration](https://docs.stripe.com/payments/accept-a-payment)\n- [Elements](https://docs.stripe.com/payments/elements)\n- [Stripe.js](https://docs.stripe.com/js)\n- [https://js.stripe.com/v3/](https://js.stripe.com/v3/)\n- [advanced fraud functionality](https://docs.stripe.com/radar)\n- [PCI compliant](https://docs.stripe.com/security/guide)\n- [security](https://docs.stripe.com/security)\n- [Register now](https://dashboard.stripe.com/register)\n- [Stripe object](https://docs.stripe.com/js#stripe-function)\n- [API key](https://docs.stripe.com/keys)\n- [Elements object](https://docs.stripe.com/js#stripe-elements)\n- [mount](https://docs.stripe.com/js#element-mount)\n-\n[stripe.createPaymentMethod](https://docs.stripe.com/js/payment_methods/create_payment_method)\n- [PaymentMethod](https://docs.stripe.com/api/payment_methods)\n- [PaymentIntent](https://docs.stripe.com/api/payment_intents)\n-\n[error_on_requires_action](https://docs.stripe.com/api/payment_intents/create#create_payment_intent-error_on_requires_action)\n-\n[https://docs.stripe.com/error-codes#authentication-required](https://docs.stripe.com/error-codes#authentication-required)\n-\n[https://stripe.com/docs/payments/payment-intents/upgrade-to-handle-actions.](https://stripe.com/docs/payments/payment-intents/upgrade-to-handle-actions)\n- [test cards](https://docs.stripe.com/testing)\n- [upgrade your\nintegration](https://docs.stripe.com/payments/payment-intents/upgrade-to-handle-actions)",
  "metadata": {
    "title": "Card payments without bank authentication | Stripe Documentation",
    "description": "Build a simpler integration with regional limitations.",
    "sourceURL": "https://docs.stripe.com/payments/without-card-authentication"
  }
}