{
  "content": "# Accept an Affirm payment\n\n## Learn how to accept Affirm, a buy now and pay later payment method.\n\nStripe-hosted pageDirect API\n#### Caution\n\nStripe automatically presents your customers payment method options by\nevaluating their currency, payment method restrictions, and other parameters. We\nrecommend that you configure your payment methods from the Stripe Dashboard\nusing the instructions in [Accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?platform=web&ui=stripe-hosted).\n\nIf you want to continue manually configuring the payment methods you present to\nyour customers with Checkout, use this guide. Otherwise, update your integration\nto [configure payment methods in the\nDashboard](https://docs.stripe.com/payments/dashboard-payment-methods).\n\nAffirm is a [single\nuse](https://docs.stripe.com/payments/payment-methods#usage), [immediate\nnotification](https://docs.stripe.com/payments/payment-methods#payment-notification)\npayment method that requires customers to\n[authenticate](https://docs.stripe.com/payments/payment-methods#customer-actions)\ntheir payment. Customers are redirected to the Affirm site, where they agree to\nthe terms of an installment plan. When the customer accepts the terms, funds are\nguaranteed and transferred to your Stripe account. The customer repays Affirm\ndirectly over time.\n\n#### Note\n\nBefore you start the integration, make sure your account is eligible for Affirm\nby navigating to your [Payment methods\nsettings](https://dashboard.stripe.com/settings/payment_methods).\n\n[Determine\ncompatibility](https://docs.stripe.com/payments/affirm/accept-a-payment#compatibility)\nA Checkout Session must satisfy all of the following conditions to support\nAffirm payments:\n\n- You can only use one-time line items. Affirm doesn’t support recurring\n[subscription](https://docs.stripe.com/billing/subscriptions/creating) plans.\n- Express all [Prices](https://docs.stripe.com/api/prices) in your domestic\ncurrency.\n[Accept a\npayment](https://docs.stripe.com/payments/affirm/accept-a-payment#accept-a-payment)\n#### Note\n\nThis guide builds on the foundational [accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?ui=stripe-hosted)\nCheckout integration.\n\nUse this guide to learn how to enable Affirm—it shows the differences between\naccepting a card payment and using Affirm.\n\n### Enable Affirm as a payment method\n\nWhen creating a new [Checkout\nSession](https://docs.stripe.com/api/checkout/sessions), you need to:\n\n- Add `affirm` to the list of `payment_method_types`.\n- Make sure all your `line_items` use your domestic currency.\n- We recommend collecting shipping addresses by adding your country to\n`shipping_address_collection[allowed_countries]`. If you don’t want to collect\nshipping addresses with Checkout, you can also provide the shipping address\nusing `payment_intent_data[shipping]`. Doing so helps with loan acceptance\nrates.\n\n```\nStripe::Checkout::Session.create({\n mode: 'payment',\n payment_method_types: ['card'],\n payment_method_types: ['card', 'affirm'],\n line_items: [{\n price_data: {\n currency: 'usd',\n product_data: {\n name: 'T-shirt',\n },\n# Make sure the total amount fits within Affirm's transaction amount limits\n unit_amount: 5000,\n },\n quantity: 1,\n }],\n shipping_address_collection: {\n # Shipping address is optional but recommended to pass in\n# Specify which shipping countries Checkout should provide as options for\nshipping locations\n allowed_countries: ['CA', 'US'],\n },\n# If you already have the shipping address, provide it in payment_intent_data:\n # payment_intent_data: {\n # shipping: {\n # name: 'Jenny Rosen',\n # address: {\n # line1: '1234 Main Street',\n # city: 'San Francisco',\n # state: 'CA',\n # country: 'US',\n # postal_code: '94111',\n # },\n # },\n # },\n success_url: 'https://example.com/success',\n cancel_url: 'https://example.com/cancel',\n })\n```\n\n### Fulfill your orders\n\n[Use a method such as\nwebhooks](https://docs.stripe.com/payments/payment-intents/verifying-status#webhooks)\nto handle order fulfillment, instead of relying on your customer to return to\nthe payment status page.\n\nThe following events are sent when the payment status changes:\n\nEvent NameDescriptionNext\nsteps[checkout.session.completed](https://docs.stripe.com/api/events/types#event_types-checkout.session.completed)The\ncustomer successfully authorized the payment by submitting the Checkout\nform.Wait for the payment to succeed or\nfail.[payment_intent.succeeded](https://docs.stripe.com/api/events/types#event_types-payment_intent.succeeded)The\ncustomer’s payment succeeded. The `PaymentIntent` transitions to\n`succeeded`.Fulfill the goods or services that the customer\npurchased.[payment_intent.payment_failed](https://docs.stripe.com/api/events/types#event_types-payment_intent.payment_failed)The\ncustomer’s payment was declined, or failed for some other reason. The\n`PaymentIntent` returns to the `requires_payment_method` status.Email the\ncustomer to request that they place a new order.\nLearn more about [fulfilling\norders](https://docs.stripe.com/checkout/fulfillment).\n\n[Test your\nintegration](https://docs.stripe.com/payments/affirm/accept-a-payment#test-integration)\nWhen testing your Checkout integration, select Affirm as the payment method and\nclick the **Pay** button.\n\nTest your Affirm integration with your test API keys by viewing the redirect\npage. You can test the successful payment case by authenticating the payment on\nthe redirect page. The PaymentIntent transitions from `requires_action` to\n`succeeded`.\n\nTo test the case where the user fails to authenticate, use your test API keys\nand view the redirect page. On the redirect page, close the Affirm modal window\nand verify that payment failed. The PaymentIntent transitions from\n`requires_action` to `requires_payment_method`.\n\nWhen redirected to the Affirm sandbox, Affirm may ask for the last four digits\nof your SSN. Affirm suggests using `'0000'` or `'5678'`.\n\nFor [manual\ncapture](https://docs.stripe.com/payments/affirm/accept-a-payment#manual-capture)\nPaymentIntents in testmode, the uncaptured PaymentIntent auto-expires 10 minutes\nafter successful authorization.\n\n## Failed payments\n\nAffirm takes into account multiple factors when deciding to accept or decline a\ntransaction (for example, the length of time buyer has used Affirm, the\noutstanding amount the customer has to repay, and the value of the current\norder).\n\nAlways present additional payment options such as `card` in your checkout flow,\nas Affirm payments have a higher rate of decline than many payment methods. In\nthese cases, the\n[PaymentMethod](https://docs.stripe.com/api/payment_methods/object) is detached\nand the [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\nobject’s status automatically transitions to `requires_payment_method`.\n\nOther than a payment being declined, for an Affirm\n[PaymentIntent](https://docs.stripe.com/api/payment_intents/object) with a\nstatus of `requires_action`, customers need to complete the payment within 12\nhours after you redirect them to the Affirm site. If the customer takes no\naction within 12 hours, the\n[PaymentMethod](https://docs.stripe.com/api/payment_methods/object) is detached\nand the [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\nobject’s status automatically transitions to `requires_payment_method`.\n\nIn these cases, inform your customer to try again with a different payment\noption presented in your checkout flow.\n\n## Error codes\n\nThese are the common error codes and corresponding recommended actions:\n\nError codeRecommended action`payment_intent_payment_attempt_failed`A generic\nfailure indicating the Affirm checkout failed. Additional information may be\navailable in the charge outcome reason.`payment_method_provider_decline`Affirm\ndeclined the customer’s payment. As a next step, the customer needs to contact\nAffirm for more information.`payment_intent_payment_attempt_expired`The customer\nnever completed the payment on Affirm’s checkout page, and the payment session\nhas expired. Stripe automatically expires PaymentIntents that are not\nsuccessfully authorized 12 hours after initial checkout\ncreation.`payment_method_not_available`Affirm experienced a service related\nerror and is unable to complete the request. Retry at a later\ntime.`amount_too_small`Enter an amount within Affirm’s [default transactions\nlimits](https://docs.stripe.com/payments/affirm#payment-options).`amount_too_large`Enter\nan amount within Affirm’s [default transactions\nlimits](https://docs.stripe.com/payments/affirm#payment-options).\nSome errors might have additional insight included in the charge outcome reason:\n\nOutcome ReasonWhat this means`generic_decline`The default outcome reason for a\npayment error. This usually indicates that the partner declined the payment (for\nexample, because of insufficient funds), the bank issuer declined the charge,\nthe transaction included a high-risk purchase, or a similar reason. Stripe may\nnot always receive a decline reason for these\ncases.`affirm_checkout_canceled`Either the customer has explicitly canceled the\nAffirm checkout or Affirm has rejected the customer’s loan eligibility. Stripe\ncan’t distinguish the difference between these two types of events.\n\n## Links\n\n- [Accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?platform=web&ui=stripe-hosted)\n- [configure payment methods in the\nDashboard](https://docs.stripe.com/payments/dashboard-payment-methods)\n- [single use](https://docs.stripe.com/payments/payment-methods#usage)\n- [immediate\nnotification](https://docs.stripe.com/payments/payment-methods#payment-notification)\n-\n[authenticate](https://docs.stripe.com/payments/payment-methods#customer-actions)\n- [Payment methods\nsettings](https://dashboard.stripe.com/settings/payment_methods)\n- [subscription](https://docs.stripe.com/billing/subscriptions/creating)\n- [Prices](https://docs.stripe.com/api/prices)\n- [accept a\npayment](https://docs.stripe.com/payments/accept-a-payment?ui=stripe-hosted)\n- [Checkout Session](https://docs.stripe.com/api/checkout/sessions)\n- [https://example.com/success](https://example.com/success)\n- [https://example.com/cancel](https://example.com/cancel)\n- [Use a method such as\nwebhooks](https://docs.stripe.com/payments/payment-intents/verifying-status#webhooks)\n-\n[checkout.session.completed](https://docs.stripe.com/api/events/types#event_types-checkout.session.completed)\n-\n[payment_intent.succeeded](https://docs.stripe.com/api/events/types#event_types-payment_intent.succeeded)\n-\n[payment_intent.payment_failed](https://docs.stripe.com/api/events/types#event_types-payment_intent.payment_failed)\n- [fulfilling orders](https://docs.stripe.com/checkout/fulfillment)\n- [PaymentMethod](https://docs.stripe.com/api/payment_methods/object)\n- [PaymentIntent](https://docs.stripe.com/api/payment_intents/object)\n- [default transactions\nlimits](https://docs.stripe.com/payments/affirm#payment-options)",
  "metadata": {
    "title": "Accept an Affirm payment | Stripe Documentation",
    "description": "Learn how to accept Affirm, a buy now and pay later payment method.",
    "sourceURL": "https://docs.stripe.com/payments/affirm/accept-a-payment"
  }
}