{
  "content": "# Migrate to Stripe Tax\n\n## Learn how to migrate existing subscriptions to Stripe Tax.\n\n[Stripe Tax](https://docs.stripe.com/tax) allows you to calculate the tax to\ncollect on your transactions. It computes the taxes and adds them to the payment\nautomatically, based on the product and the customer location.\n\nWhen you integrate with Stripe Tax, you need to update existing subscriptions to\nmake sure that tax is automatically calculated going forward. Stripe provides\ntooling to help you update your subscriptions. You can also manually update\nsubscriptions where you want more control over certain options.\n\n[Update existing subscriptions using automated\ntooling](https://docs.stripe.com/billing/taxes/migration#update-automated)\nFirst, you need to activate Stripe Tax. To learn how, read the [setup\nguide](https://docs.stripe.com/tax/set-up).\n\nTo use the tooling, follow these steps:\n\n- Go to the [Dashboard](https://dashboard.stripe.com/tax/migrations).\n- Review the subscriptions you need to update.\n- Review the recommended actions.\n- Make any necessary manual updates.\n\nStripe removes manual [tax\nrates](https://docs.stripe.com/billing/taxes/tax-rates) from the subscriptions,\nwhich can take up to 5 business days. When the process is complete, we notify\nyou by email.\n\n#### Note\n\nWe don’t prorate the tax changes. The updates take effect at the start of the\nnext billing cycle.\n\nYou can use the tooling to update subscriptions that meet the following\ncriteria:\n\n- Are active\n- Don’t automatically collect tax\n- Have sufficient [address\ninformation](https://docs.stripe.com/tax/customer-locations#address-hierarchy-other)\nto calculate tax\n\nYou need to update the following types of subscriptions:\n\n- Subscriptions with schedules. To learn more, see [the Update Subscriptions\nwith subscription schedules\nsection](https://docs.stripe.com/billing/taxes/migration#existing-subscription-schedules).\n- Subscriptions that use the [charge\ntypes](https://docs.stripe.com/connect/charges#types) destination charges or\nseparate charges and transfers.\n[Update existing subscriptions\nmanually](https://docs.stripe.com/billing/taxes/migration#update-manually)-\n[Review customer\nlocations](https://docs.stripe.com/billing/taxes/migration#customer-locations)\nand make any required updates.\n- [Update products and\nprices](https://docs.stripe.com/billing/taxes/migration#products_prices) with\ntax codes and tax behaviors.\n- [Update subscriptions](https://docs.stripe.com/billing/taxes/migration#subs)\nto automatically calculate taxes on future invoices.\n- [Confirm](https://docs.stripe.com/billing/taxes/migration#confirm) that you’ve\nupdated the subscriptions correctly.\n[Check customer\nlocations](https://docs.stripe.com/billing/taxes/migration#customer-locations)\nTo correctly calculate tax, we need to know the customer’s tax location status.\nYou can check it in the Dashboard or in exported data, or get the information\nusing the API.\n\nDashboardAPIDashboard Exports\nTo check a customer’s tax location status through the Dashboard, go to the\n[Customers page](https://dashboard.stripe.com/customers), select the customer,\nand expand their details. The tax location status (`automatic_tax`) has four\npossible values:\n\nStatusDescriptionPossible ActionValid (`supported`)Automatic tax fully\nsupported.No further action required.Unrecognized location\n(`unrecognized_location`)The address isn’t valid for determining a tax\nlocation.Ask the customer for an updated address and set\n[customer.address](https://docs.stripe.com/api/customers/update#update_customer-address)\nto the new value. You can update the value through the API or Dashboard by\nediting the customer’s details.Not registered (`not_collecting`)The address is\nrecognized and resolved to a location that you haven’t set up a collection\nlocation for.The action to take depends on your [tax\nobligations](https://docs.stripe.com/tax/monitoring). If you proceed, Stripe Tax\ndoesn’t assess any taxes. If you want it to assess tax, [add an active\nregistration](https://docs.stripe.com/tax/registering) for the jurisdiction the\ncustomer is based in.`failed`An [error](https://docs.stripe.com/error-codes)\noccurred with Stripe’s servers. This is rare.Try the request again or contact\nStripe support for additional assistance.\nIn case the `status=unrecognized_location` you need to update the customer\nlocation with [an address that Stripe Tax can\nuse](https://docs.stripe.com/tax/customer-locations). In the Dashboard, you can\ngo into the [Customers page](https://dashboard.stripe.com/customers), select the\ncustomer, and change its billing or shipping address under Details.\n\nFor more information on which customer address is valid, how they’re used, or\nhow to handle errors, see [Collect customer\naddresses](https://docs.stripe.com/tax/customer-locations).\n\n[Update products and\nprices](https://docs.stripe.com/billing/taxes/migration#products-prices)\nYour products and prices use the default tax behavior you assigned when\nactivating Stripe Tax. If you’d prefer to update active products and prices to\ncalculate tax independently, set a tax_code and tax_behavior. See the full list\nof [available tax codes](https://docs.stripe.com/tax/tax-codes) and the [guide\nfor setting\nup](https://docs.stripe.com/tax/products-prices-tax-codes-tax-behavior) tax\ncodes and tax behavior for more information. For more information about\n[products and\nprices](https://docs.stripe.com/billing/taxes/collect-taxes#product-and-price-setup),\nincluding how to decide whether a price should be inclusive or exclusive, see\nthe [Tax Setup FAQ](https://docs.stripe.com/tax/faq#set-up).\n\n### Update products\n\nFirst, update any existing products with a `tax_code`. If you don’t explicitly\ndefine a `tax_code` on your product, Stripe Tax uses the preset product tax code\nfrom your settings.\n\nDashboardAPI\nTo update a Product with a `tax_code` in the Dashboard, go to the [Products\npage](https://dashboard.stripe.com/products?active=true), select a product to\nedit and, in the product information page, choose the tax code from the\ndrop-down menu.\n\n### Update prices\n\nNext, update the tax behavior for your prices.\n\n#### Common mistake\n\nYou can’t change `tax_behavior` after it’s been set to one of `exclusive` or\n`inclusive`. If you want to change the tax behavior of a price, you need to\ncreate a new price with the desired behavior, and archive the old price.\n\nDashboardAPI\nTo update a price using the Dashboard:\n\n- Go to the [products page](https://dashboard.stripe.com/products).\n- Select the product with the price you want to update.\n- Select additional options in the price information section.\n- In the **Include tax in price** drop-down menu, select the behavior you want\nto associate with the price.\n[Update subscriptions](https://docs.stripe.com/billing/taxes/migration#subs)\nWith your customers, products, and prices updated, you’re ready to update\nexisting subscriptions.\n\nGet the list of subscriptions that need to be updated from the [subscriptions\npage in the Dashboard](https://dashboard.stripe.com/subscriptions). To display\nonly subscriptions that don’t have automatic tax enabled, click **Filter**,\ncheck **Automatic tax**, and select **Disabled**. Alternatively, you can export\nall filtered subscriptions to view them as a CSV file. To do this, click\n**Export** and select **All** as the **Date range**.\n\nHow you update the subscriptions depends on their state:\n\n- If your subscriptions [don’t have existing tax\nrates](https://docs.stripe.com/billing/taxes/migration#no-tax-rates), you only\nneed to enable automatic tax.\n- If your subscriptions have [existing tax\nrates](https://docs.stripe.com/billing/taxes/migration#existing-tax-rates) (at\neither the subscription or line-item level), you need to clear out any existing\ntax rates and enable automatic tax. To avoid creating prorated items, you can\nschedule this update.\n- If your subscriptions have [subscriptions\nschedules](https://docs.stripe.com/billing/taxes/migration#existing-subscription-schedules),\nyou need to remove instances of `automatic_tax[enabled]=false` in the\nsubscription schedule plans.\n\n### Update subscriptions with no existing tax rates\n\nDashboardAPI\nTo update subscriptions with no existing tax rates using the Dashboard, update\nthe subscription and turn on the **Calculate tax automatically** option.\n\n### Update subscriptions with existing tax rates\n\nDashboardAPI\nTo update subscriptions with [tax\nrates](https://docs.stripe.com/billing/taxes/tax-rates) through the Dashboard,\nedit the subscription, then enable the **calculate tax automatically** option.\nThe Dashboard removes any existing tax rates and automatically calculates tax\ngoing forward. If you haven’t updated your prices to set `tax_behavior`, the\nDashboard prompts you to update any missing details before you can update the\nsubscription.\n\n### Update Subscriptions with subscription schedules\n\nIf you need to collect tax, and any of your subscriptions include a subscription\nschedule that sets `automatic_tax[enabled]=false`, you must remove that\nparameter. To do so, update all phases of the subscription’s schedule by\nremoving `automatic_tax[enabled]=false` and setting\n`default_settings[automatic_tax][enabled]=true`.\n\nWhen you update a subscription schedule, you need to pass in all current and\nfuture phases. To do this, verify the set parameters, then enable Stripe Tax in\nthe subscription schedule.\n\n```\ncurl\nhttps://api.stripe.com/v1/subscription_schedules/{{SUBSCRIPTION_SCHEDULE_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\"\n```\n\nTo update the subscription schedule after you obtain it, remove the\n`automatic_tax[enabled]=false` parameter, and pass down the other phases and\nparameters:\n\n```\ncurl\nhttps://api.stripe.com/v1/subscription_schedules/{{SUBSCRIPTION_SCHEDULE_ID}} \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d \"phases[0][items][0][price]\"=price_1GqNdGAJVYItwOKqEHb \\\n -d \"phases[0][items][0][quantity]\"=1 \\\n -d \"phases[0][start_date]\"=1577865600 \\\n -d \"phases[0][end_date]\"=1578038400 \\\n -d \"phases[1][items][0][price]\"=price_1GqNdGAJVYItwOKqEHb \\\n -d \"phases[1][items][0][quantity]\"=2 \\\n -d \"phases[1][start_date]\"=1578038400 \\\n -d \"phases[1][end_date]\"=1580544000 \\\n -d \"default_settings[automatic_tax][enabled]\"=true\n```\n\n#### Schedule the update\n\nIf you want to avoid creating a prorated item, you can schedule the update to\noccur at the start of the next cycle.\n\nYou can currently only schedule subscription updates with the API:\n\n```\n# Set your secret key. Remember to switch to your live secret key in production.\n# See your keys here: https://dashboard.stripe.com/apikeys\nStripe.api_key = 'sk_test_BQokikJOvBiI2HlWgH4olfQ2'\n\nsubscription = Stripe::Subscription.retrieve(\n '{{SUBSCRIPTION_ID}}',\n)\nschedule = Stripe::SubscriptionSchedule.create({\n from_subscription: subscription.id\n})\nStripe::SubscriptionSchedule.update(\n schedule.id,\n {\n end_behavior: 'release',\n phases: [\n # The first phase contains items for the\n # latest subscription invoice\n {\n items: [\n # Prices and tax_rates for each item\n {\n price: '{{PRICE_ID}}',\n tax_rates: [\n '{{TAX_RATE_ID}}'\n ]\n }\n ],\n default_tax_rates: ['{{TAX_RATE_ID}}'],\n start_date: subscription.current_period_start,\n end_date: subscription.current_period_end\n },\n # The second phase removes manual tax rates and enables\n # automatic tax calculation\n {\n items: [\n # Prices for each item with tax_rates: ''\n {\n price: '{{PRICE_ID}}',\n tax_rates: ''\n }\n ],\n default_tax_rates: '',\n automatic_tax: {enabled: true},\n iterations: 1\n }\n ]\n }\n)\n```\n\n[Confirm updates](https://docs.stripe.com/billing/taxes/migration#confirm)\nTo confirm that you’ve properly updated your subscriptions, retrieve the\n[upcoming invoice](https://docs.stripe.com/api/invoices/upcoming) of each\nsubscription and inspect the results of its tax calculation.\n\nYou can retrieve the tax amounts from the\n[tax](https://docs.stripe.com/api/invoices/object#invoice_object-tax) and\n[total_tax_amounts](https://docs.stripe.com/api/invoices/object#invoice_object-total_tax_amounts)\nfields on the upcoming invoice, and from the per-line-item\n[tax_amounts](https://docs.stripe.com/api/invoices/line_item#invoice_line_item_object-tax_amounts)\nfields. The invoice has an\n[automatic_tax](https://docs.stripe.com/api/invoices/object#invoice_object-automatic_tax)\nfield showing the status of the calculation, with one of three possible\nstatuses:\n\nStatusDescriptionPossible Action`complete`Stripe Tax has successfully assessed\nthe taxes on the payment.You can retrieve the tax amounts from the tax and\n`total_tax_amounts` fields on the latest invoice, and from the per-line item\n`tax_amounts` fields.`requires_location_inputs`Stripe Tax was unable to assess\ntaxes because it didn’t have enough information to determine the customer’s\nlocation.Collect more information from a customer (such as a full street\naddress) and update the\n[customer.address](https://docs.stripe.com/api/invoices/object#invoice_object-customer_address)\nfield.`failed`Internal Stripe error.Try the request again or contact Stripe\nsupport for additional assistance.\n## See also\n\n- [Collect taxes for recurring\npayments](https://docs.stripe.com/billing/taxes/collect-taxes?tax-calculation=stripe-tax)\n- [Products, prices, tax codes, and tax\nbehavior](https://docs.stripe.com/tax/products-prices-tax-codes-tax-behavior)\n\n## Links\n\n- [Stripe Tax](https://docs.stripe.com/tax)\n- [setup guide](https://docs.stripe.com/tax/set-up)\n- [Dashboard](https://dashboard.stripe.com/tax/migrations)\n- [tax rates](https://docs.stripe.com/billing/taxes/tax-rates)\n- [address\ninformation](https://docs.stripe.com/tax/customer-locations#address-hierarchy-other)\n- [charge types](https://docs.stripe.com/connect/charges#types)\n- [Customers page](https://dashboard.stripe.com/customers)\n-\n[customer.address](https://docs.stripe.com/api/customers/update#update_customer-address)\n- [tax obligations](https://docs.stripe.com/tax/monitoring)\n- [add an active registration](https://docs.stripe.com/tax/registering)\n- [error](https://docs.stripe.com/error-codes)\n- [an address that Stripe Tax can\nuse](https://docs.stripe.com/tax/customer-locations)\n- [available tax codes](https://docs.stripe.com/tax/tax-codes)\n- [guide for setting\nup](https://docs.stripe.com/tax/products-prices-tax-codes-tax-behavior)\n- [products and\nprices](https://docs.stripe.com/billing/taxes/collect-taxes#product-and-price-setup)\n- [Tax Setup FAQ](https://docs.stripe.com/tax/faq#set-up)\n- [Products page](https://dashboard.stripe.com/products?active=true)\n- [products page](https://dashboard.stripe.com/products)\n- [subscriptions page in the\nDashboard](https://dashboard.stripe.com/subscriptions)\n- [https://dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)\n- [upcoming invoice](https://docs.stripe.com/api/invoices/upcoming)\n- [tax](https://docs.stripe.com/api/invoices/object#invoice_object-tax)\n-\n[total_tax_amounts](https://docs.stripe.com/api/invoices/object#invoice_object-total_tax_amounts)\n-\n[tax_amounts](https://docs.stripe.com/api/invoices/line_item#invoice_line_item_object-tax_amounts)\n-\n[automatic_tax](https://docs.stripe.com/api/invoices/object#invoice_object-automatic_tax)\n-\n[customer.address](https://docs.stripe.com/api/invoices/object#invoice_object-customer_address)\n- [Collect taxes for recurring\npayments](https://docs.stripe.com/billing/taxes/collect-taxes?tax-calculation=stripe-tax)",
  "metadata": {
    "title": "Migrate to Stripe Tax | Stripe Documentation",
    "description": "Learn how to migrate existing subscriptions to Stripe Tax.",
    "sourceURL": "https://docs.stripe.com/billing/taxes/migration"
  }
}