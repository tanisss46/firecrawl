{
  "content": "# Apple Pay merchant tokens\n\n## Learn how to use Apple Pay merchant tokens for recurring, deferred, and automatic reload payments.\n\nAn [Apple Pay merchant token\n(MPAN)](https://developer.apple.com/apple-pay/merchant-tokens/) ties together a\npayment card, a business, and a customer, and enables the wallet holder to\nmanage access to a card stored in their Apple wallet. Apple Payâ€™s latest\nguidelines recommend merchant tokens over device tokens (DPANs) because merchant\ntokens:\n\n- Allow for continuity across multiple devices\n- Enable recurring payments independent of a device\n- Keep payment information active in a new device even when its removed from a\nlost or stolen device\n- Come with lifecycle management features to monitor changes to a token or to\nsee if a token has been revoked\n\n## Merchant token types\n\nYou can use Apple Pay to request an MPAN in three ways. Each type of request has\ndifferent parameters that affect how the user is presented with Apple Wallet.\nAlmost all request types provide the option to supply a `managementURL`, which\nroutes customers to a webpage to manage their payment methods. If you request an\nMPAN and the issuer supports MPAN generation, you receive an MPAN. Otherwise,\nyou receive a DPAN.\n\nMPAN request type Use caseSupport Recurring\n[PKRecurringPaymentRequest](https://developer.apple.com/documentation/passkit/pkrecurringpaymentrequest)Issues\nan MPAN for use in a recurring payment such as a subscription.- [Apple Pay on\nthe Web](https://developer.apple.com/documentation/apple_pay_on_the_web)\n- iOS > v16.0\nAutomatic reload\n[PKAutomaticReloadPaymentRequest](https://developer.apple.com/documentation/passkit/pkautomaticreloadpaymentrequest)Issues\nan MPAN for use in a store card top-up or prepaid account. Supported\nparameters:- `automaticReloadBilling` shows billing details when you present\nApple Pay.\n- [Apple Pay on the\nWeb](https://developer.apple.com/documentation/apple_pay_on_the_web)\n- iOS > v16.0\nDeferred payment\n[PKDeferredPaymentRequest](https://developer.apple.com/documentation/passkit/pkdeferredpaymentrequest)Issues\nan MPAN for use in reservations such as hotels. Supported parameters:-\n`freeCancellationDate` shows the cancellation deadline when you present Apple\nPay.\n- `billingAgreement` shows the terms of service when you present Apple Pay.\n- [Apple Pay on the\nWeb](https://developer.apple.com/documentation/apple_pay_on_the_web)\n- Xcode 14.3\n- iOS > v16.4\n\n## Add Apple Pay merchant tokens\n\nYou can add a [merchant\ntoken](https://developer.apple.com/apple-pay/merchant-tokens/) when presenting\nApple Pay in the Express Checkout Element, web Payment Element, and mobile\nPayment Element. Stripe automatically handles merchant token requests in Stripe\nCheckout integrations.\n\nExpress Checkout ElementWeb Payment Element- Set up [Express Checkout Element\nintegration](https://docs.stripe.com/elements/express-checkout-element/accept-a-payment).\n- Pass the `applePay` object relevant to your MPAN use case (choose from the\ndrop-down to see use case code samples).\n- Include relevant parameters for your use case.\nMPAN use case:Recurring paymentsAutomatic reloadDeferred payment\n```\nelements.create('expressCheckout', {\n applePay: {\n recurringPaymentRequest: {\n paymentDescription: \"Standard Subscription\",\n regularBilling: {\n amount: 1000,\n label: \"Standard Package\",\n recurringPaymentStartDate: new Date(\"2023-03-31\"),\n recurringPaymentEndDate: new Date(\"2024-03-31\"),\n recurringPaymentIntervalUnit: \"year\",\n recurringPaymentIntervalCount: 1,\n },\n billingAgreement: \"billing agreement\",\n managementURL: \"https://stripe.com\",\n },\n },\n});\n```\n\n## Merchant token auth rate monitoring\n\nFor Sigma users, the `charges` table contains a `card_token_type` enum field to\nindicate the charge is using an `mpan` or `dpan` card. The following Sigma query\nexample calculates the MPAN auth rate:\n\n```\n-- deduplicated MPAN auth rate\nselect\n 100.0 * count(\n case\n when charge_outcome in ('authorized', 'manual_review') then 1\n end\n ) / count(*) as deduplicated_auth_rate_pct,\n count(*) as n_attempts\nfrom\n authentication_report_attempts a\n join charges c on c.id = a.charge_id\nwhere\n c.created >= date('2021-01-01')\n and c.card_tokenization_method = 'apple_pay'\n -- The new field added to charges table.\n and c.card_token_type = 'mpan'\n -- deduplicate multiple manual retries to a single representative charge\n and is_final_attempt\n```\n\n## Links\n\n- [Apple Pay merchant token\n(MPAN)](https://developer.apple.com/apple-pay/merchant-tokens/)\n-\n[PKRecurringPaymentRequest](https://developer.apple.com/documentation/passkit/pkrecurringpaymentrequest)\n- [Apple Pay on the\nWeb](https://developer.apple.com/documentation/apple_pay_on_the_web)\n-\n[PKAutomaticReloadPaymentRequest](https://developer.apple.com/documentation/passkit/pkautomaticreloadpaymentrequest)\n-\n[PKDeferredPaymentRequest](https://developer.apple.com/documentation/passkit/pkdeferredpaymentrequest)\n- [Payment Request\nButton](https://docs.stripe.com/stripe-js/elements/payment-request-button)\n-\n[comparison](https://docs.stripe.com/elements/express-checkout-element/comparison)\n- [Express Checkout Element\nintegration](https://docs.stripe.com/elements/express-checkout-element/accept-a-payment)\n- [https://stripe.com](https://stripe.com)",
  "metadata": {
    "title": "Apple Pay merchant tokens | Stripe Documentation",
    "description": "Learn how to use Apple Pay merchant tokens for recurring, deferred, and automatic reload payments.",
    "sourceURL": "https://docs.stripe.com/apple-pay/merchant-tokens"
  }
}