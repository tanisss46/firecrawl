{
  "content": "# Analyze your conversion funnel\n\n## Analyze your Stripe Checkout conversion funnel with Google Analytics 4.\n\nStripe-hosted pageEmbedded formEmbedded componentsPublic preview\nUse Google Analytics 4 (GA4) to track users as they progress through your Stripe\nCheckout purchase funnel. Before you begin, set up a [GA4\naccount](https://support.google.com/analytics/answer/9304153) and add a [GA4\nproperty](https://support.google.com/analytics/answer/9744165?hl=en#zippy=%2Cin-this-article).\n\n## Set up your site\n\n- Create a product page with a **Checkout** button:\n\n```\n<html>\n <head>\n <title>Buy cool new product</title>\n </head>\n <body>\n <script>\n window.addEventListener(\"load\", function () {\n document\n .getElementById(\"submit\")\n .addEventListener(\"click\", function (event) {\n event.preventDefault();\n fetch(\"/create-checkout-session\", {\n method: \"POST\",\n })\n .then((response) => response.json())\n .then((checkoutSession) => {\n window.location.href = checkoutSession.url;\n });\n });\n });\n </script>\n <form>\n <button id=\"submit\">Checkout</button>\n </form>\n </body>\n</html>\n```\n- Create a server-side endpoint that creates a Checkout Session and serves the\npages:\n\n```\n// This example sets up endpoints using the Express framework.\n// Watch this video to get started: https://youtu.be/rPR2aJ6XnAc.\n\nconst express = require(\"express\");\nrequire(\"dotenv\").config();\n\nconst app = express();\n\n// Set your secret key. Remember to switch to your live key in production!\n// See your keys here: https://dashboard.stripe.com/apikeys\n\nconst stripe = require('stripe')('sk_test_BQokikJOvBiI2HlWgH4olfQ2');\n\nconst request = require(\"request\");\n\napp.post(\n \"/create-checkout-session\",\n express.urlencoded({ extended: false }),\n async (req, res) => {\n const session = await stripe.checkout.sessions.create({\n payment_method_types: [\"card\"],\n line_items: [\n {\n price_data: {\n currency: \"usd\",\n product_data: {\n name: \"T-shirt\",\n },\n unit_amount: 2000,\n },\n quantity: 1,\n },\n ],\n mode: \"payment\",\n success_url: req.get(\"origin\") + \"/success\",\n cancel_url: req.get(\"origin\") + \"/cancel\",\n });\n\n res.json({ url: session.url });\n }\n);\n\napp.get(\"/product\", function (req, res) {\n res.sendFile(__dirname + \"/product.html\");\n});\n\napp.get(\"/success\", function (req, res) {\n res.sendFile(__dirname + \"/success.html\");\n});\n\napp.get(\"/cancel\", function (req, res) {\n res.sendFile(__dirname + \"/cancel.html\");\n});\n\napp.listen(4242, () => console.log(`Listening on port ${4242}!`));\n```\n- Create a success page:\n\n```\n<html>\n <head>\n <title>Thanks for your order!</title>\n </head>\n <body>\n <h1>Thanks for your order!</h1>\n <p>\n We appreciate your business! If you have any questions, please email\n <a href=\"mailto:orders@example.com\">orders@example.com</a>.\n </p>\n </body>\n</html>\n```\n- Create a canceled page:\n\n```\n<html>\n <head>\n <title>Order Canceled!</title>\n </head>\n <body>\n <p>\n <a href=\"/product\">Start another order</a>.\n </p>\n </body>\n</html>\n```\n\n## Instrumentation walkthrough\n\nIn the following example, we assume your customer has:\n\n- Viewed your product page.\n- Clicked the **Buy** button and was redirected to Stripe Checkout.\n- Completed the payment and was redirected to the success page.\n\n### Quick summary\n\n### Add instrumentation\n\n- Add `checkout.stripe.com` to your referral exclusion list.\n- Add Google Analytics tags to your product, success, and canceled pages. Tags\nautomatically fire an event on page load.\n\n```\n<html>\n <head>\n <!-- START GOOGLE ANALYTICS -->\n <script\n async\nsrc=\"https://www.googletagmanager.com/gtag/js?id=<GOOGLE_ANALYTICS_CLIENT_ID>\"\n ></script>\n <script>\n window.dataLayer = window.dataLayer || [];\n function gtag() {\n window.dataLayer.push(arguments);\n }\n gtag(\"js\", new Date());\n gtag(\"config\", \"<GOOGLE_ANALYTICS_CLIENT_ID>\");\n </script>\n <!-- END GOOGLE ANALYTICS -->\n <title>Buy cool new product</title>\n </head>\n <body>\n <script>\n window.addEventListener(\"load\", function () {\n document\n .getElementById(\"submit\")\n .addEventListener(\"click\", function (event) {\n event.preventDefault();\n fetch(\"/create-checkout-session\", {\n method: \"POST\",\n })\n .then((response) => response.json())\n .then((checkoutSession) => {\n window.location.href = checkoutSession.url;\n });\n });\n });\n </script>\n <form>\n <button id=\"submit\">Checkout</button>\n </form>\n </body>\n</html>\n```\n\n```\n<html>\n <head>\n <!-- START GOOGLE ANALYTICS -->\n <script\n async\nsrc=\"https://www.googletagmanager.com/gtag/js?id=<GOOGLE_ANALYTICS_CLIENT_ID>\"\n ></script>\n <script>\n window.dataLayer = window.dataLayer || [];\n function gtag() {\n window.dataLayer.push(arguments);\n }\n gtag(\"js\", new Date());\n gtag(\"config\", \"<GOOGLE_ANALYTICS_CLIENT_ID>\");\n </script>\n <!-- END GOOGLE ANALYTICS -->\n <title>Thanks for your order!</title>\n </head>\n <body>\n <h1>Thanks for your order!</h1>\n <p>\n We appreciate your business! If you have any questions, please email\n <a href=\"mailto:orders@example.com\">orders@example.com</a>.\n </p>\n </body>\n</html>\n```\n\n```\n<html>\n <head>\n <!-- START GOOGLE ANALYTICS -->\n <script\n async\nsrc=\"https://www.googletagmanager.com/gtag/js?id=<GOOGLE_ANALYTICS_CLIENT_ID>\"\n ></script>\n <script>\n window.dataLayer = window.dataLayer || [];\n function gtag() {\n window.dataLayer.push(arguments);\n }\n gtag(\"js\", new Date());\n gtag(\"config\", \"<GOOGLE_ANALYTICS_CLIENT_ID>\");\n </script>\n <!-- END GOOGLE ANALYTICS -->\n <title>Order Canceled!</title>\n </head>\n <body>\n <p>\n <a href=\"/product\">Start another order</a>.\n </p>\n </body>\n</html>\n```\n- Fire an event just before redirecting to Stripe Checkout:\n\n```\n<html>\n <head>\n <!-- START GOOGLE ANALYTICS -->\n <script\n async\nsrc=\"https://www.googletagmanager.com/gtag/js?id=<GOOGLE_ANALYTICS_CLIENT_ID>\"\n ></script>\n <script>\n window.dataLayer = window.dataLayer || [];\n function gtag() {\n window.dataLayer.push(arguments);\n }\n gtag(\"js\", new Date());\n gtag(\"config\", \"<GOOGLE_ANALYTICS_CLIENT_ID>\");\n </script>\n <!-- END GOOGLE ANALYTICS -->\n <title>Buy cool new product</title>\n </head>\n <body>\n <script>\n window.addEventListener(\"load\", function () {\n document\n .getElementById(\"submit\")\n .addEventListener(\"click\", function (event) {\n event.preventDefault();\n fetch(\"/create-checkout-session\", {\n method: \"POST\",\n })\n .then((response) => response.json())\n .then((checkoutSession) => {\n window.location.href = checkoutSession.url;\n gtag(\"event\", \"begin_checkout\", {\n event_callback: function () {\n window.location.href = checkoutSession.url;\n },\n });\n });\n });\n });\n </script>\n <form>\n <button id=\"submit\">Checkout</button>\n </form>\n </body>\n</html>\n```\n\n### Analyze your conversion funnel metrics\n\nAfter you add the proper instrumentation, you can see the metrics corresponding\nto each step defined in your conversion funnel:\n\n- **product page views:** The number of page visitors who viewed the product\npage.\n- **begin_checkout event count:** The number of page visitors who clicked the\n**Buy** button and were redirected to Stripe Checkout.\n- **success page views:** The number of page visitors who completed the purchase\nand were redirected to the success page.\n\nUsing these numbers, you can see where visitors are dropping off in your\nconversion funnel.\n\n[OptionalServer-side event\nrecording](https://docs.stripe.com/payments/checkout/analyze-conversion-funnel#server-side-event-recording)[OptionalLinking\nclient and server-side\nevents](https://docs.stripe.com/payments/checkout/analyze-conversion-funnel#link-client-and-server-side-events)[OptionalServer-side\nredirects](https://docs.stripe.com/payments/checkout/analyze-conversion-funnel#server-side-redirect)\n\n## Links\n\n- [GA4 account](https://support.google.com/analytics/answer/9304153)\n- [GA4\nproperty](https://support.google.com/analytics/answer/9744165?hl=en#zippy=%2Cin-this-article)\n- [https://youtu.be/rPR2aJ6XnAc.](https://youtu.be/rPR2aJ6XnAc)\n- [https://dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)\n-\n[https://www.googletagmanager.com/gtag/js?id=](https://www.googletagmanager.com/gtag/js?id=)",
  "metadata": {
    "title": "Analyze your conversion funnel | Stripe Documentation",
    "description": "Analyze your Stripe Checkout conversion funnel with Google Analytics 4.",
    "sourceURL": "https://docs.stripe.com/payments/checkout/analyze-conversion-funnel"
  }
}