{
  "content": "# Adding selfie checks\n\n## Learn how to add face similarity checks to prevent fraudsters from using stolen documents.\n\nWhile [document\nchecks](https://docs.stripe.com/identity/verification-checks?type=document)\nprovide a defense against the use of fraudulent identity documents, it’s\npossible for fraudsters to get access to legitimate stolen documents. To prevent\nthis, Stripe Identity can perform selfie checks on your users.\n\nSelfie checks look for distinguishing biological traits, such as face geometry,\nfrom a photo ID and a picture of your user’s face. Stripe then uses advanced\nmachine learning algorithms to ensure the face pictures belong to the same\nperson.\n\nTo add selfie checks to your application, first follow the guide to [collect and\nverify identity\ndocuments](https://docs.stripe.com/identity/verify-identity-documents).\n\n## Adding selfie checks to VerificationSessions\n\nWhen [creating a\nVerificationSession](https://docs.stripe.com/api/identity/verification_sessions/create),\nuse the\n[options.document.require_matching_selfie](https://docs.stripe.com/api/identity/verification_sessions/create#create_identity_verification_session-options-document-require_matching_selfie)\nparameter to enable selfie checks.\n\n```\ncurl https://api.stripe.com/v1/identity/verification_sessions \\\n -u \"sk_test_BQokikJOvBiI2HlWgH4olfQ2:\" \\\n -d type=document \\\n -d \"options[document][require_matching_selfie]\"=true\n```\n\nThis configures the verification flow to require a photo ID and a face picture\nfrom your user.\n\n## Accessing selfie check results\n\nAfter it’s submitted and processed, the VerificationSession\n[status](https://docs.stripe.com/identity/how-sessions-work) changes depending\non the result of the checks:\n\n- `verified` — Both the document and selfie checks were successful. The session\n[verified_outputs](https://docs.stripe.com/api/identity/verification_sessions/object#identity_verification_session_object-verified_outputs)\ncontains extracted information from the document.\n- `requires_input` — At least one of the document or the selfie checks failed.\n\nTo access the captured selfie and document images, you’ll need to retrieve the\nassociated\n[VerificationReport](https://docs.stripe.com/api/identity/verification_reports),\nyou can do this by [expanding](https://docs.stripe.com/api/expanding_objects)\nthe\n[last_verification_report](https://docs.stripe.com/api/identity/verification_sessions/object#identity_verification_session_object-last_verification_report)\nfield in the session:\n\n```\n// Set your secret key. Remember to switch to your live secret key in\nproduction.\n// See your keys here: https://dashboard.stripe.com/apikeys\nconst stripe = require('stripe')('sk_test_BQokikJOvBiI2HlWgH4olfQ2');\nconst verificationSession = await stripe.identity.verificationSessions.retrieve(\n '{{SESSION_ID}}',\n {\n expand: ['last_verification_report'],\n }\n);\nconst verificationReport = verificationSession.last_verification_report;\n```\n\nThe VerificationReport has\n[document](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-document)\nand\n[selfie](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-selfie)\nfields holding the results of the document and selfie checks. Here’s an example\nVerificationReport with successful document and selfie checks:\n\n```\n{\n \"id\": \"vr_\",\n \"object\": \"identity.verification_report\",\n \"type\": \"document\",\n \"verification_session\": \"vs_\",\n \"created\": 1611776872,\n \"livemode\": true,\n \"options\": {\n \"document\": {\n \"require_matching_selfie\": true\n }\n },\n \"document\": {\n \"status\": \"verified\",\n \"error\": null,\n \"first_name\": \"Jenny\",\n \"last_name\": \"Rosen\",\n \"address\": {\n \"line1\": \"1234 Main St.\",\n \"city\": \"San Francisco\",\n \"state\": \"CA\",\n \"postal_code\": \"94111\",\n \"country\": \"US\"\n },\n \"document_type\": \"id_card\",\n \"expiration_date\": {\n \"day\": 17,\n \"month\": 7,\n \"year\": 2024\n },\n \"files\": [\"file_\", \"file_\"],\n \"issued_date\": {\n \"day\": 4,\n \"month\": 27,\n \"year\": 2021\n },\n \"issuing_country\": \"US\"\n },\n \"selfie\": {\n \"status\": \"verified\",\n \"error\": null,\n \"document\": \"file_\",\n \"selfie\": \"file_\",\n }\n}\n```\n\nTo access the collected document and face images, see [Accessing verification\nresults](https://docs.stripe.com/identity/access-verification-results).\n\n## Understanding selfie check failures\n\nThe\n[document](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-document)\nand\n[selfie](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-selfie)\nVerificationReport fields contain the collected data as well as a `status` and\n`error` fields to help you understand whether the check is successful or not.\n\nThe `status` field tells you whether each check is successful or not. The\npossible values are:\n\n- `verified` - The verification check is successful and the collected data is\nverified.\n- `unverified` - The verification check failed. You can check the `error` hash\nfor more information.\n\nWhen the verification check fails, the `error` field contains `code` and\n`reason` values to explain the verification failure. The `error.code` field can\nbe used to programmatically handle verification failures. The `reason` field\ncontains a descriptive message explaining the failure reason and can be shown to\nyour user.\n\n### Document check failures\n\nFailure details are available in the report\n[document.error](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-document-error)\nfield.\n\nError codeDescription`document_expired`The provided identity document has\nexpired.`document_unverified_other`Stripe couldn’t verify the provided identity\ndocument. [See list of supported document\ntypes](https://docs.stripe.com/identity/verification-checks?type=document).`document_type_not_supported`The\nprovided identity document isn’t one of the session’s [allowed document\ntypes](https://docs.stripe.com/api/identity/verification_sessions/create#create_identity_verification_session-options-document-allow_document_types).\n### Selfie check failures\n\nFailure details are available in the report\n[selfie.error](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-selfie-error)\nfield.\n\nError codeDescription`selfie_document_missing_photo`The provided identity\ndocument did not contain a picture of a face.`selfie_face_mismatch`The captured\nface image did not match with the document’s\nface.`selfie_unverified_other`Stripe couldn’t verify the provided\nselfie.`selfie_manipulated`The captured face image was manipulated.\n## See also\n\n- [Verify your users’ identity\ndocuments](https://docs.stripe.com/identity/verify-identity-documents)\n- [The Verification Sessions\nAPI](https://docs.stripe.com/identity/verification-sessions#create)\n\n## Links\n\n- [document\nchecks](https://docs.stripe.com/identity/verification-checks?type=document)\n- [collect and verify identity\ndocuments](https://docs.stripe.com/identity/verify-identity-documents)\n- [creating a\nVerificationSession](https://docs.stripe.com/api/identity/verification_sessions/create)\n-\n[options.document.require_matching_selfie](https://docs.stripe.com/api/identity/verification_sessions/create#create_identity_verification_session-options-document-require_matching_selfie)\n- [status](https://docs.stripe.com/identity/how-sessions-work)\n-\n[verified_outputs](https://docs.stripe.com/api/identity/verification_sessions/object#identity_verification_session_object-verified_outputs)\n-\n[VerificationReport](https://docs.stripe.com/api/identity/verification_reports)\n- [expanding](https://docs.stripe.com/api/expanding_objects)\n-\n[last_verification_report](https://docs.stripe.com/api/identity/verification_sessions/object#identity_verification_session_object-last_verification_report)\n- [https://dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)\n-\n[document](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-document)\n-\n[selfie](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-selfie)\n- [Accessing verification\nresults](https://docs.stripe.com/identity/access-verification-results)\n-\n[document.error](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-document-error)\n- [allowed document\ntypes](https://docs.stripe.com/api/identity/verification_sessions/create#create_identity_verification_session-options-document-allow_document_types)\n-\n[selfie.error](https://docs.stripe.com/api/identity/verification_reports/object#identity_verification_report_object-selfie-error)\n- [The Verification Sessions\nAPI](https://docs.stripe.com/identity/verification-sessions#create)",
  "metadata": {
    "title": "Adding selfie checks | Stripe Documentation",
    "description": "Learn how to add face similarity checks to prevent fraudsters from using stolen documents.",
    "sourceURL": "https://docs.stripe.com/identity/selfie"
  }
}