{
  "content": "Download full appDon't code? Use Stripe’s [no-code\noptions](https://docs.stripe.com/no-code) or get help from [our\npartners](https://stripe.partners/).1 Set up the server\n### Install the Stripe Agent Toolkit\n\nInstall the package and import it into your code.\n\nnpmGitHub\nInstall the library:\n\n`npm install --save @stripe/agent-toolkit`Server\n### Create an endpoint to handle the request\n\nAdd an endpoint on your server that handles the new chat input.\n\nServer\n### Initialize the toolkit\n\nUsing your Stripe API key, create a new instance of the `StripeAgentToolkit`.\nThe toolkit allows you to insert billing middleware and also access Stripe\nfunctionality.\n\nServer\n### Provide the middleware to the model\n\nUsing middleware, you can report the prompt and completion token usage to Stripe\nthrough the Meter API. The `billing` configuration requires you to provide a\n[Customer](https://docs.stripe.com/api/customers/object) ID and input and output\n[Meter Events](https://docs.stripe.com/api/billing/meter-event/object).\n\nLearn how to [setup usage-based\nbilling](https://docs.stripe.com/billing/subscriptions/usage-based/implementation-guide).\n\nServer\n### Call the model\n\nUse Vercel’s AI SDK to call the model and stream back results to the client.\nYour request includes the existing message log and a system prompt to provide\ninitial instructions to the model.\n\nServer2Build your frontend\n### Create a chat interface\n\nUse Next.js and Vercel’s AI SDK to build a basic chat interface to call into the\nbackend you built.\n\nClient3Test your page\n### Set your environment variables\n\nAdd your publishable and secret keys to a `.env` file. Next.js automatically\nloads them into your application as [environment\nvariables](https://nextjs.org/docs/basic-features/environment-variables).\n\nServer\n### Run the application\n\nStart your app with `npm run dev` and navigate to\n[http://localhost:3000](http://localhost:3000/).\n\nClient\n### Testing\n\nTo test this functionality, send a message to the chat.\n\n### View usage in the Dashboard\n\nView your Meters in the [Stripe Dashboard](https://dashboard.stripe.com/meters)\nto confirm that events are sent successfully.\n\napp/api/chat/route.tsapp/page.tsx.envDownload\n```\nimport { StripeAgentToolkit } from '@stripe/agent-toolkit/ai-sdk';import {\nopenai } from '@ai-sdk/openai';import { convertToCoreMessages,\nexperimental_wrapLanguageModel as wrapLanguageModel, streamText} from 'ai';\n// Instantiate a new Stripe Agent Toolkit.const stripeAgentToolkit = new\nStripeAgentToolkit({ secretKey: process.env.STRIPE_SECRET_KEY!, configuration:\n{},});\nexport async function POST(req: Request) { const { messages } = await\nreq.json();\n// Wrap the language model and include the // billing middleware. const model =\nwrapLanguageModel({ model: openai('gpt-4o'), middleware:\nstripeAgentToolkit.middleware({ billing: { customer:\nprocess.env.STRIPE_CUSTOMER_ID!, meters: { input:\nprocess.env.STRIPE_METER_INPUT!, output: process.env.STRIPE_METER_OUTPUT!, }, },\n}), });\n// Call the model and stream back the results. const result = await streamText({\nmodel: model, system: SYSTEM_PROMPT, messages: convertToCoreMessages(messages),\n});\n return result.toDataStreamResponse();}\n```\n\n## Links\n\n- [text version of this\nguide](https://docs.stripe.com/payments/accept-a-payment)\n- [sandbox](https://docs.stripe.com/sandboxes)\n- [restricted API\nkeys](https://docs.stripe.com/keys#create-restricted-api-secret-key)\n- [no-code options](https://docs.stripe.com/no-code)\n- [our partners](https://stripe.partners)\n- [Customer](https://docs.stripe.com/api/customers/object)\n- [Meter Events](https://docs.stripe.com/api/billing/meter-event/object)\n- [setup usage-based\nbilling](https://docs.stripe.com/billing/subscriptions/usage-based/implementation-guide)\n- [environment\nvariables](https://nextjs.org/docs/basic-features/environment-variables)\n- [http://localhost:3000](http://localhost:3000)\n- [Stripe Dashboard](https://dashboard.stripe.com/meters)",
  "metadata": {
    "title": "Agent quickstart | Stripe Documentation",
    "description": "",
    "sourceURL": "https://docs.stripe.com/agents/quickstart"
  }
}