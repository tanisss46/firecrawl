{
  "content": "# Using OAuth with Express accountsDeprecated\n\n## Use the OAuth connection flow to allow an Express user to connect to your platform.\n\n#### Caution\n\nOAuth isn’t available for new [Connect](https://docs.stripe.com/connect)\nplatforms. For new accounts, use [Accounts API with\nExpress](https://docs.stripe.com/connect/express-accounts) instead.\n[Extensions](https://docs.stripe.com/building-extensions) shouldn’t use Express\nOAuth, as extensions can’t connect to existing Express accounts. If you need\naccess to OAuth for Express accounts, please [contact\nsupport](https://support.stripe.com/).\n\n## The OAuth connection flow\n\nA user connects to your platform using the following OAuth connection flow:\n\n- On a page on your site, you provide a\n[link](https://docs.stripe.com/connect/oauth-express-accounts#integrating-oauth)\nthat redirects your user to Stripe, passing along your platform’s `client_id`.\n- On Stripe’s website, the user provides the necessary information for\n[connecting](https://docs.stripe.com/connect/oauth-express-accounts#connect-users)\nto your platform.\n- Stripe\n[redirects](https://docs.stripe.com/connect/oauth-express-accounts#redirected)\nthe user to your site, along with an authorization code.\n- Your site then makes a request to Stripe’s [OAuth token\nendpoint](https://docs.stripe.com/connect/oauth-express-accounts#token-request)\nto complete the connection and fetch the user’s account ID.\n\nAfter these steps are complete, you can make API requests for the user with\ntheir [account\nID](https://docs.stripe.com/connect/authentication#stripe-account-header).\n\n## Step 1: You provide the OAuth link\n\nTo start your integration, go to your [platform\nsettings](https://dashboard.stripe.com/account/applications/settings) and:\n\n- Enable onboarding Express accounts with OAuth in the OAuth settings.\n- your `client_id`, a unique identifier for your platform that’s generated\nby Stripe.\n- Set your `redirect_uri`, the URL that your user is redirected to after\nconnecting their account. You must specify all redirect URLs in your platform\nsettings. If you don’t include the `redirect_uri` parameter in your request,\nStripe defaults to using the first address you’ve configured in your platform\nsettings.\n\nStripe also provides a development `client_id` to help with\n[testing](https://docs.stripe.com/connect/testing#using-oauth).\n\nWith these two pieces of information in hand, you’re ready to create the OAuth\nlink. We recommend showing a [Connect\nbutton](https://d37ugbyn3rpeym.cloudfront.net/docs/connect/Connect-with-Stripe-button.zip)\nthat sends users to our Express OAuth endpoint:\n\n```\n\nhttps://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}\n```\n\nTo prevent CSRF attacks, add the `state` parameter with the value set to a\nunique token. Stripe includes this `state` value in the redirect URL that sends\nthe user back to your site. Then, confirm that this `state` parameter has the\nsame value you originally provided.\n\nHere’s how you can present the example URL, along with our [Connect with Stripe\nbutton](https://d37ugbyn3rpeym.cloudfront.net/docs/connect/Connect-with-Stripe-button.zip):\n\n[Connect\nwith](https://connect.stripe.com/oauth/authorize?response_type=code&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&scope=read_write)\n### Customize Express with OAuth parameters\n\nYou can change the behavior of the Express onboarding flow by including\nadditional URL parameters in your OAuth link. A complete list of available\nparameters is available in the [OAuth\nreference](https://docs.stripe.com/connect/oauth-reference).\n\n#### Individual or company accounts\n\nYou can specify whether Stripe presents an Express onboarding form for\nindividuals or companies by setting the `stripe_user[business_type]` parameter\nto either `individual` or `company`.\n\nStripe collects the right information for each type of account. For example, to\nonboard a company:\n\n```\n\nhttps://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&stripe_user[business_type]=company\n```\n\n#### Prefill form fields\n\nYou can prefill some form fields on the user’s Stripe application by including\nthe relevant [URL parameters](https://docs.stripe.com/connect/oauth-reference)\nin your OAuth link.\n\nThis example prefills the user’s email address with `stripe_user[email]`:\n\n```\n\nhttps://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=https://connect.stripe.com/connect/default/oauth/test&state={STATE_VALUE}&stripe_user[email]=user@example.com\n```\n\n#### Specify capabilities for an account\n\nYou can change the capabilities for new connected accounts in the [Dashboard\nsettings for Express](https://dashboard.stripe.com/settings/connect/express).\nHowever, if you want to request different capabilities for each of your\nconnected accounts, you can include the `suggested_capabilities[]` parameter in\nyour OAuth link and override the Dashboard settings on the Express Configuration\npage.\n\nAn example with the `transfers` capability:\n\n```\n\nhttps://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&suggested_capabilities[]=transfers\n```\n\nStripe adds the suggested capability to this Express account, unless one of the\nfollowing conditions is met:\n\n- If the user is in a country that doesn’t support `transfers`, Stripe attempts\nto designate the account as `card_payments`.\n- If the user’s account doesn’t support `transfers` *or* `card_payments`, Stripe\nmarks the account as having no capabilities.\n\nYou can verify that Stripe added the suggested capability by using the\n`assert_capabilities[]` parameter. This step is optional.\n\n## Step 2: The user creates their account\n\nWhen the user clicks the link on your site, it takes them to Stripe’s website,\nwhich prompts them to provide contact and\n[payout](https://docs.stripe.com/payouts) information.\n\n![Stripe's website for a user to provide their contact and payout\ninformation](https://b.stripecdn.com/docs-statics-srv/assets/rocket-rides-express.33f3b71b60ed5244eef4ff3761e2c480.png)\n\nTo test the onboarding process, you can provide *(000) 000-0000* as a phone\nnumber. Instead of sending you an SMS message or email, Stripe lets you complete\nverification with the code *000-000*.\n\nExpress displays your branding in the onboarding flow and the Express Dashboard.\nYou can provide your platform name, logo, and optional brand color in the\n[Connect settings](https://dashboard.stripe.com/account/applications/settings)\nsection of the Stripe Dashboard.\n\n## Step 3: Stripe redirects the user to your site\n\nAfter the user completes the onboarding process, Stripe redirects them back to\nyour site using the URL defined as your platform’s `redirect_uri`.\n\nFor successful connections, the redirect URL includes the following values:\n\n- The `state` value, if provided.\n- An authorization code. The authorization code is short-lived, and can be used\nonly once, in the POST request described in the next step.\n\n```\nhttps://connect.stripe.com/connect/default/oauth/test?code={AUTHORIZATION_CODE}\n```\n\n## Step 4: You complete the Express account connection\n\nInclude the provided authorization `code` in a POST request to Stripe’s token\nendpoint to complete the connection and fetch the user’s account ID:\n\n```\ncurl https://connect.stripe.com/oauth/token \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d \"code\"=\"ac_123456789\" \\\n -d \"grant_type\"=\"authorization_code\"\n```\n\nStripe returns a response that includes the account ID (`stripe_user_id`) for\nthe user:\n\n```\n{\n \"livemode\": false,\n \"token_type\": \"bearer\",\n \"stripe_user_id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"scope\": \"express\",\n ...\n}\n```\n\nOr, if there’s a problem, Stripe returns a detailed error message:\n\n```\n{\n \"error\": \"invalid_grant\",\n \"error_description\": \"Authorization code does not exist: {AUTHORIZATION_CODE}\"\n}\n```\n\nThe user is now connected to your platform. The `stripe_user_id` is the Stripe\naccount ID for the new account. Store this value in your database and use it to\nauthenticate as the connected account by passing it into requests in the\n`Stripe-Account` header.\n\n#### Note\n\nStore `stripe_user_id`, which is the account’s ID. Platforms need this value\n(beginning with `acct_`) to transfer funds, create charges, and perform requests\non the user’s behalf.\n\n### Verify the account’s capability\n\nIf you provide the `suggested_capabilities[]` parameter, you can add the\n`assert_capabilities[]` parameter to verify that the connected account now has\nthe suggested capabilities. For instance, you can check this if you’re concerned\nabout URL security. This step is optional, however. Stripe handles any failure\nto apply a capability silently.\n\n```\ncurl https://connect.stripe.com/oauth/token \\\n -u sk_test_BQokikJOvBiI2HlWgH4olfQ2: \\\n -d \"code\"=\"ac_123456789\" \\\n -d \"grant_type\"=\"authorization_code\" \\\n -d \"assert_capabilities[]\"=\"transfers\"\n```\n\nA success response then looks like this:\n\n```\n{\n \"livemode\": false,\n \"token_type\": \"bearer\",\n \"stripe_user_id\": \"{{CONNECTED_ACCOUNT_ID}}\",\n \"scope\": \"express\",\n \"capabilities\": \"transfers\",\n ...\n}\n```\n\nIf the specified `capabilities[]` value doesn’t match, the error response looks\nlike this:\n\n```\n{\n \"error\": \"invalid_request\",\n \"error_description\": \"assert_capabilities expects capability: card_payments\"\n}\n```\n\nThe most common reason for this request failure is that the specified capability\nisn’t available in your user’s country. A less likely reason is a bad actor\nchanging the URL.\n\n## Webhooks\n\nAfter you create an account, you can get all account change notifications\ndelivered to your [webhooks](https://docs.stripe.com/connect/webhooks) as\n`account.updated` events. You set your Connect\n[webhook](https://docs.stripe.com/webhooks) URL in your [account\nsettings](https://dashboard.stripe.com/account/webhooks). These events let you\ntrack the onboarding and verification status of connected accounts, which you\ncan use to provide user support and display notices in your platform’s user\ninterface. Alternatively, you can let Stripe take your users through the steps\nof the onboarding and verification process and handle any issues that arise.\n\nIf you created an account in test mode using either a test mode API key or\n`client_id`, Stripe doesn’t send any emails while you build your Stripe\nintegration. (But when you’re live, we do.)\n\n## Links\n\n- [Connect](https://docs.stripe.com/connect)\n- [Accounts API with Express](https://docs.stripe.com/connect/express-accounts)\n- [Extensions](https://docs.stripe.com/building-extensions)\n- [contact support](https://support.stripe.com/)\n- [account\nID](https://docs.stripe.com/connect/authentication#stripe-account-header)\n- [through the\ndashboard](https://docs.stripe.com/connect/dashboard/managing-individual-accounts)\n- [platform\nsettings](https://dashboard.stripe.com/account/applications/settings)\n- [testing](https://docs.stripe.com/connect/testing#using-oauth)\n- [Connect\nbutton](https://d37ugbyn3rpeym.cloudfront.net/docs/connect/Connect-with-Stripe-button.zip)\n-\n[https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}](https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE})\n- [Connect\nwith](https://connect.stripe.com/oauth/authorize?response_type=code&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&scope=read_write)\n- [OAuth reference](https://docs.stripe.com/connect/oauth-reference)\n-\n[https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&stripe_user[business_type]=company](https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&stripe_user[business_type]=company)\n-\n[https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=https://connect.stripe.com/connect/default/oauth/test&state={STATE_VALUE}&stripe_user[email]=user@example.com](https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=https://connect.stripe.com/connect/default/oauth/test&state={STATE_VALUE}&stripe_user[email]=user@example.com)\n- [Dashboard settings for\nExpress](https://dashboard.stripe.com/settings/connect/express)\n-\n[https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&suggested_capabilities[]=transfers](https://connect.stripe.com/express/oauth/authorize?redirect_uri=https://connect.stripe.com/connect/default/oauth/test&client_id=ca_FkyHCg7X8mlvCUdMDao4mMxagUfhIwXb&state={STATE_VALUE}&suggested_capabilities[]=transfers)\n- [payout](https://docs.stripe.com/payouts)\n-\n[https://connect.stripe.com/connect/default/oauth/test?code={AUTHORIZATION_CODE}](https://connect.stripe.com/connect/default/oauth/test?code={AUTHORIZATION_CODE})\n- [webhooks](https://docs.stripe.com/connect/webhooks)\n- [webhook](https://docs.stripe.com/webhooks)\n- [account settings](https://dashboard.stripe.com/account/webhooks)",
  "metadata": {
    "title": "Using OAuth with Express accounts | Stripe Documentation",
    "description": "Use the OAuth connection flow to allow an Express user to connect to your platform.",
    "sourceURL": "https://docs.stripe.com/connect/oauth-express-accounts"
  }
}