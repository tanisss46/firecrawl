{
  "content": "# Collect customer addresses\n\n## Learn about collecting customer address information to calculate tax.\n\nStripe Tax requires your customer’s location to automatically calculate tax.\nThis requirement applies even if you don’t have an active registration. This\nguide helps you understand how to collect addresses from your customers.\n\n## Checkout and Payment Links\n\nCheckout handles the collection of customer addresses for you, including those\ncreated by Payment Links.\n\n## Invoicing, Subscriptions, and custom payment integrations\n\nIf you don’t use Payment Links or Checkout, you’re responsible for the\ncollection of customer addresses.\n\n- Collect and set both the\n[country](https://docs.stripe.com/api/customers/object#customer_object-address-country)\nand the\n[postal_code](https://docs.stripe.com/api/customers/object#customer_object-address-postal_code)\nfields on your customer objects.\n- Use two-letter country codes ([ISO 3166-1\nalpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)).\n- When [creating](https://docs.stripe.com/api/customers/create) or [updating a\ncustomer](https://docs.stripe.com/api/customers/update), set\n[tax[validate_location]=“immediately”](https://docs.stripe.com/api/customers/create#create_customer-tax-validate_location)\nto prevent\n[customer_tax_location_invalid](https://docs.stripe.com/error-codes#customer-tax-location-invalid)\nerrors later.\n- Listen for [subscription webhook\nevents](https://docs.stripe.com/billing/subscriptions/webhooks) as most activity\nhappens asynchronously.\n\n#### Regional considerationsUnited States\n\nIn the United States, sales tax rules and rates vary by state, with some states\nhaving hundreds of districts setting their own rates. We recommend collecting a\nfull address (including\n[line1](https://docs.stripe.com/api/customers/object#customer_object-address-line1),\n[city](https://docs.stripe.com/api/customers/object#customer_object-address-city),\nand\n[state](https://docs.stripe.com/api/customers/object#customer_object-address-state))\nfrom your customers in the US.\n\n### Invoice finalization errors\n\nFinalizing invoices with Stripe Tax requires a recognized customer location.\nLocation details might be missing or invalid if you update or remove a\ncustomer’s default payment method, or if you didn’t provide\n`tax[validate_location]=\"immediately\"` when creating or updating a customer.\n\nIf we don’t have a recognized customer location, invoices for a subscription\ncontinue to [finalize\nautomatically](https://docs.stripe.com/invoicing/integration/automatic-advancement-collection)\nbut without calculating taxes. This has the following effects:\n\n- The `automatic_tax[enabled]` parameter changes to `false` on the\n[subscription](https://docs.stripe.com/api/subscriptions/object#subscription_object-automatic_tax-enabled)\nand\n[invoice](https://docs.stripe.com/api/invoices/object#invoice_object-automatic_tax-enabled).\n- The `Invoice[automatic_tax][disabled_reason]` parameter changes to\n`finalization_requires_location_inputs`.\n- The `Subscription[automatic_tax][disabled_reason]` parameter changes to\n`requires_location_inputs`.\n- If the subscription has a\n[schedule](https://docs.stripe.com/billing/subscriptions/subscription-schedules),\nwe set `automatic_tax[enabled]` to `false` on the current phase and in\n`default_settings`. We set the `disabled_reason` in both to\n`requires_location_inputs`.\n- We send `invoice.updated` and `customer.subscription.updated`\n[events](https://docs.stripe.com/billing/subscriptions/webhooks#events) to\ninform your integration of these changes.- If there’s a schedule, we also send a\n`subscription_schedule.updated` webhook.\n- The invoice finalizes without calculating or collecting taxes. It won’t\ncontain any tax amounts.\n- We collect payment as usual according to the [collection\nmethod](https://docs.stripe.com/billing/collection-method) for the invoice.\n\nTo review subscriptions without automatic tax calculations in your Stripe\nDashboard, visit your Subscriptions page and filter the view by the **Automatic\ntax not enabled** option. To reactivate automatic tax for these subscriptions in\nthe future, make sure you have at least one valid customer location, and\nactivate automatic tax through the [Stripe Tax\nDashboard](https://dashboard.stripe.com/tax/migrations).\n\n#### Exceptions to automatically disabling tax\n\nStripe returns an error and leaves the invoice in a `draft` status when\nfinalizing with the [API](https://docs.stripe.com/api/invoices/finalize) or\nDashboard without a valid customer location. In the API, this returns an HTTP\n400 error with a `code` of `customer_tax_location_invalid`.\n\nSimilarly, for automatic finalization of standalone invoices without a\nsubscription, the invoice remains a draft if the customer location isn’t valid.\nWe send an\n[invoice.finalization_failed](https://docs.stripe.com/api/events/types#event_types-invoice.finalization_failed)\nevent with the invoice\n[last_finalization_error[code]](https://docs.stripe.com/api/invoices/object#invoice_object-last_finalization_error-code)\nbeing `customer_tax_location_invalid`.\n\nHow you recover from a `customer_tax_location_invalid` error depends on whether\nyou have or can collect a customer address.\n\n- If you have a customer address or can collect it, update the customer and\nfinalize the invoice manually.- [Update the\ncustomer](https://docs.stripe.com/api/customers/update) with\n[tax[validate_location]=“immediately”](https://docs.stripe.com/api/customers/create#create_customer-tax-validate_location)\nto make sure that the new address is valid.\n- [Finalize](https://docs.stripe.com/api/invoices/finalize) the invoice.\n- If you don’t have a customer address or can’t collect it, disable Stripe Tax\nfor the invoice and its subscription, and finalize the invoice manually.-\n[Update the affected\ninvoice](https://docs.stripe.com/api/invoices/update#update_invoice-automatic_tax)\nwith `automatic_tax[enabled]=false`.\n- [Update the affected\nsubscription](https://docs.stripe.com/api/subscriptions/update#update_subscription-automatic_tax-enabled)\nwith `automatic_tax[enabled]=false`.\n- [Finalize the invoice](https://docs.stripe.com/api/invoices/finalize).\n[OptionalWhich customer address we\nuse](https://docs.stripe.com/tax/customer-locations#address-hierarchy)[OptionalMinimal\naddress\ncollection](https://docs.stripe.com/tax/customer-locations#supported-formats)[OptionalRegional\nconsiderations](https://docs.stripe.com/tax/customer-locations#region-specific)\n## See also\n\n- [Understanding zero tax](https://docs.stripe.com/tax/zero-tax)\n- [Available tax codes](https://docs.stripe.com/tax/tax-codes)\n- [How tax is calculated](https://docs.stripe.com/tax/calculating)\n\n## Links\n\n-\n[country](https://docs.stripe.com/api/customers/object#customer_object-address-country)\n-\n[postal_code](https://docs.stripe.com/api/customers/object#customer_object-address-postal_code)\n- [ISO 3166-1 alpha-2](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2)\n- [creating](https://docs.stripe.com/api/customers/create)\n- [updating a customer](https://docs.stripe.com/api/customers/update)\n-\n[tax[validate_location]=“immediately”](https://docs.stripe.com/api/customers/create#create_customer-tax-validate_location)\n-\n[customer_tax_location_invalid](https://docs.stripe.com/error-codes#customer-tax-location-invalid)\n- [subscription webhook\nevents](https://docs.stripe.com/billing/subscriptions/webhooks)\n-\n[line1](https://docs.stripe.com/api/customers/object#customer_object-address-line1)\n-\n[city](https://docs.stripe.com/api/customers/object#customer_object-address-city)\n-\n[state](https://docs.stripe.com/api/customers/object#customer_object-address-state)\n- [finalize\nautomatically](https://docs.stripe.com/invoicing/integration/automatic-advancement-collection)\n-\n[subscription](https://docs.stripe.com/api/subscriptions/object#subscription_object-automatic_tax-enabled)\n-\n[invoice](https://docs.stripe.com/api/invoices/object#invoice_object-automatic_tax-enabled)\n-\n[schedule](https://docs.stripe.com/billing/subscriptions/subscription-schedules)\n- [events](https://docs.stripe.com/billing/subscriptions/webhooks#events)\n- [collection method](https://docs.stripe.com/billing/collection-method)\n- [Stripe Tax Dashboard](https://dashboard.stripe.com/tax/migrations)\n- [API](https://docs.stripe.com/api/invoices/finalize)\n-\n[invoice.finalization_failed](https://docs.stripe.com/api/events/types#event_types-invoice.finalization_failed)\n-\n[last_finalization_error[code]](https://docs.stripe.com/api/invoices/object#invoice_object-last_finalization_error-code)\n- [Update the affected\ninvoice](https://docs.stripe.com/api/invoices/update#update_invoice-automatic_tax)\n- [Update the affected\nsubscription](https://docs.stripe.com/api/subscriptions/update#update_subscription-automatic_tax-enabled)\n- [Understanding zero tax](https://docs.stripe.com/tax/zero-tax)\n- [Available tax codes](https://docs.stripe.com/tax/tax-codes)\n- [How tax is calculated](https://docs.stripe.com/tax/calculating)",
  "metadata": {
    "title": "Collect customer addresses | Stripe Documentation",
    "description": "Collect customer address information to enable accurate tax calculations with Stripe Tax. Learn about guidelines for different regions and how to handle address-related errors.",
    "sourceURL": "https://docs.stripe.com/tax/customer-locations"
  }
}